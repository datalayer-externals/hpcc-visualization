"function"==typeof define&&define.amd&&define("css",[],function(){return{load:function(t,e,i){i()}}}),function(t,e){"function"==typeof define&&define.amd?define("react/Orb.js",["d3","../common/HTMLWidget","../common/Utility","../common/PropertyExt","css!orb","css!./Orb"],e):t.template_Orb=e(t.d3,t.common_HTMLWidget,t.common_Utility,t.common_PropertyExt,t.React)}(this,function(t,e,i,o){function s(t){o.call(this),this._owner=t}function r(t){e.call(this),this.orbFields=[],this.savedField=[],this.rowFields=[],this.dataFields=[],this.columnFields=[],this.removeFields=[],this.prevOrbConfig=""}s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype._class+=" react_Orb.Mapping",s.prototype.publish("addField","","set","Show Toolbox or not",function(){return this._owner?this._owner.columns():[]},{optional:!0}),s.prototype.publish("location",!0,"set","Data Location",["row","column","data","remove"],{tags:["basic"]}),s.prototype.publish("aggregateFunc","","set","Aggregate Function type",["sum","count","min","max","avg","prod","var","varp","stdev","stdevp"],{optional:!0}),s.prototype.publish("formatFunction","","string","Format function");var n=null;return r.prototype._OrbTypes=[{id:"PIVOT",display:"Pivot Table",widgetClass:"react_Orb"}],r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype._class+=" react_Orb",r.prototype.Mapping=s,r.prototype.publish("stringProp","defaultValue","string","Sample Property"),r.prototype.publish("width","2000","string","Table width",null,{tags:["basic"]}),r.prototype.publish("height","711","string","Table height",null,{tags:["basic"]}),r.prototype.publish("toolbar",!0,"boolean","Show Toolbox or not",null,{tags:["basic"]}),r.prototype.publish("themeColor","blue","set","Theme color",["blue","red","black","green"],{tags:["basic"]}),r.prototype.publish("newField",[],"propertyArray","Source Columns",null,{autoExpand:s}),r.prototype.publish("columnGrandTotal",!0,"boolean","Show Grand total or not"),r.prototype.publish("rowGrandTotal",!0,"boolean","Show Grand total or not"),r.prototype.orbConfig=function(t,e,i,o,s){var r={dataSource:t,canMoveFields:!1,dataHeadersLocation:"columns",width:this.width(),height:this.height(),theme:this.themeColor(),toolbar:{visible:this.toolbar()},grandTotal:{rowsvisible:this.rowGrandTotal(),columnsvisible:this.columnGrandTotal()},subTotal:{visible:!0,collapsed:!1,collapsible:!0},rowSettings:{subTotal:{visible:!0,collapsed:!1,collapsible:!0}},columnSettings:{subTotal:{visible:!0,collapsed:!1,collapsible:!0}},fields:e,rows:this.rowFields,columns:this.columnFields,data:this.dataFields};return r},r.prototype.enter=function(t,i){e.prototype.enter.apply(this,arguments),this._orbDiv=i.append("div"),this._orb=new n.pgridwidget(this.orbConfig()),this._orb.render(this._orbDiv.node())},r.prototype.deleteField=function(t){var e=this.savedField.indexOf(t);e>-1&&this.savedField.splice(e),e=this.rowFields.indexOf(t),e>-1&&this.rowFields.splice(e),e=this.columnFields.indexOf(t),e>-1&&this.columnFields.splice(e),e=this.dataFields.indexOf(t),e>-1&&this.dataFields.splice(e),this.orbFields.forEach(function(e,i,o){e.caption===t&&o.splice(i,1)})},r.prototype.update=function(i,o){function s(e){return function(i){return t.format(e)(i)}}e.prototype.update.apply(this,arguments);for(var r=this.data(),l=this.columns(),a=0;a<this.orbFields.length;a++)-1===this.savedField.indexOf(this.orbFields[a].caption)&&this.savedField.push(this.orbFields[a].caption);this.newField().forEach(function(t,e){var i=t.__prop_addField;if(-1===this.savedField.indexOf(i)){var o=l.indexOf(i);-1!==o&&this.orbFields.push({name:o.toString(),caption:i})}},this),this.newField().forEach(function(t,e){var i=t.__prop_addField,o=this.columnFields.indexOf(i),s=this.dataFields.indexOf(i),r=this.rowFields.indexOf(i),n=this.removeFields.indexOf(i);if(null!==i)switch(t.__prop_location){case"row":-1===r&&(this.rowFields.push(i),o>-1&&this.columnFields.splice(o,1),s>-1&&this.dataFields.splice(s,1),n>-1&&this.removeFields.splice(n,1));break;case"column":-1===o&&(this.columnFields.push(i),r>-1&&this.rowFields.splice(o,1),s>-1&&this.dataFields.splice(s,1),n>-1&&this.removeFields.splice(n,1));break;case"data":-1===s&&(this.dataFields.push(i),r>-1&&this.rowFields.splice(o,1),o>-1&&this.columnFields.splice(s,1),n>-1&&this.removeFields.splice(n,1));break;case"remove":-1===n&&(this.removeFields.push(i),this.deleteField(i))}},this),this.newField().forEach(function(t,e){for(var i=t.__prop_addField,o=0;o<this.orbFields.length;o++)if(this.orbFields[o].caption===i){var r=t.formatFunction();this.orbFields[o].dataSettings={aggregateFunc:t.aggregateFunc(),formatFunc:s(r)}}},this);var d=this.orbConfig(r,this.orbFields,this.rowFields,this.columnFields,this.dataFields);if(this.prevOrbConfig!==JSON.stringify(d)){var p=React;p.unmountComponentAtNode(this._orbDiv.node()),this.prevOrbConfig=d}this._orbDiv=o.append("div"),this._orb=new n.pgridwidget(d),this._orb.render(this._orbDiv.node()),this._orb.refreshData(this.data())},r.prototype.exit=function(t,i){this._orbDiv.remove(),e.prototype.exit.apply(this,arguments)},r.prototype.render=function(t,i){if(n)e.prototype.render.apply(this,arguments);else{var o=this,s=arguments;require(["orb-react"],function(t){window.React=window.React||t,require(["orb"],function(t){n=t,e.prototype.render.apply(o,s)})})}},r});