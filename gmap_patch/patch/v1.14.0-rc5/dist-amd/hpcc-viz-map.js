// (c) 2008 David Troy

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("topojson",["exports"],e):e(t.topojson={})}(this,function(t){"use strict";function e(){}function o(t){if(!t)return e;var o,r,a=t.scale[0],n=t.scale[1],i=t.translate[0],s=t.translate[1];return function(t,e){e||(o=r=0),t[0]=(o+=t[0])*a+i,t[1]=(r+=t[1])*n+s}}function r(t){if(!t)return e;var o,r,a=t.scale[0],n=t.scale[1],i=t.translate[0],s=t.translate[1];return function(t,e){e||(o=r=0);var p=(t[0]-i)/a|0,l=(t[1]-s)/n|0;t[0]=p-o,t[1]=l-r,o=p,r=l}}function a(t,e){for(var o,r=t.length,a=r-e;a<--r;)o=t[a],t[a++]=t[r],t[r]=o}function n(t,e){for(var o=0,r=t.length;r>o;){var a=o+r>>>1;t[a]<e?o=a+1:r=a}return o}function i(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return s(t,e)})}:s(t,e)}function s(t,e){var o={type:"Feature",id:e.id,properties:e.properties||{},geometry:p(t,e)};return null==e.id&&delete o.id,o}function p(t,e){function r(t,e){e.length&&e.pop();for(var o,r=c[0>t?~t:t],n=0,i=r.length;i>n;++n)e.push(o=r[n].slice()),h(o,n);0>t&&a(e,i)}function n(t){return t=t.slice(),h(t,0),t}function i(t){for(var e=[],o=0,a=t.length;a>o;++o)r(t[o],e);return e.length<2&&e.push(e[0].slice()),e}function s(t){for(var e=i(t);e.length<4;)e.push(e[0].slice());return e}function p(t){return t.map(s)}function l(t){var e=t.type;return"GeometryCollection"===e?{type:e,geometries:t.geometries.map(l)}:e in u?{type:e,coordinates:u[e](t)}:null}var h=o(t.transform),c=t.arcs,u={Point:function(t){return n(t.coordinates)},MultiPoint:function(t){return t.coordinates.map(n)},LineString:function(t){return i(t.arcs)},MultiLineString:function(t){return t.arcs.map(i)},Polygon:function(t){return p(t.arcs)},MultiPolygon:function(t){return t.arcs.map(p)}};return l(e)}function l(t,e){function o(e){var o,r=t.arcs[0>e?~e:e],a=r[0];return t.transform?(o=[0,0],r.forEach(function(t){o[0]+=t[0],o[1]+=t[1]})):o=r[r.length-1],0>e?[o,a]:[a,o]}function r(t,e){for(var o in t){var r=t[o];delete e[r.start],delete r.start,delete r.end,r.forEach(function(t){a[0>t?~t:t]=1}),s.push(r)}}var a={},n={},i={},s=[],p=-1;return e.forEach(function(o,r){var a,n=t.arcs[0>o?~o:o];n.length<3&&!n[1][0]&&!n[1][1]&&(a=e[++p],e[p]=o,e[r]=a)}),e.forEach(function(t){var e,r,a=o(t),s=a[0],p=a[1];if(e=i[s])if(delete i[e.end],e.push(t),e.end=p,r=n[p]){delete n[r.start];var l=r===e?e:e.concat(r);n[l.start=e.start]=i[l.end=r.end]=l}else n[e.start]=i[e.end]=e;else if(e=n[p])if(delete n[e.start],e.unshift(t),e.start=s,r=i[s]){delete i[r.end];var h=r===e?e:r.concat(e);n[h.start=r.start]=i[h.end=e.end]=h}else n[e.start]=i[e.end]=e;else e=[t],n[e.start=s]=i[e.end=p]=e}),r(i,n),r(n,i),e.forEach(function(t){a[0>t?~t:t]||s.push([t])}),s}function h(t){return p(t,c.apply(this,arguments))}function c(t,e,o){function r(t){var e=0>t?~t:t;(h[e]||(h[e]=[])).push({i:t,g:p})}function a(t){t.forEach(r)}function n(t){t.forEach(a)}function i(t){"GeometryCollection"===t.type?t.geometries.forEach(i):t.type in c&&(p=t,c[t.type](t.arcs))}var s=[];if(arguments.length>1){var p,h=[],c={LineString:a,MultiLineString:n,Polygon:n,MultiPolygon:function(t){t.forEach(n)}};i(e),h.forEach(arguments.length<3?function(t){s.push(t[0].i)}:function(t){o(t[0].g,t[t.length-1].g)&&s.push(t[0].i)})}else for(var u=0,d=t.arcs.length;d>u;++u)s.push(u);return{type:"MultiLineString",arcs:l(t,s)}}function u(t){var e=t[0],o=t[1],r=t[2];return Math.abs((e[0]-r[0])*(o[1]-e[1])-(e[0]-o[0])*(r[1]-e[1]))}function d(t){for(var e,o=-1,r=t.length,a=t[r-1],n=0;++o<r;)e=a,a=t[o],n+=e[0]*a[1]-e[1]*a[0];return n/2}function y(t){return p(t,f.apply(this,arguments))}function f(t,e){function o(t){t.forEach(function(e){e.forEach(function(e){(a[e=0>e?~e:e]||(a[e]=[])).push(t)})}),n.push(t)}function r(e){return d(p(t,{type:"Polygon",arcs:[e]}).coordinates[0])>0}var a={},n=[],i=[];return e.forEach(function(t){"Polygon"===t.type?o(t.arcs):"MultiPolygon"===t.type&&t.arcs.forEach(o)}),n.forEach(function(t){if(!t._){var e=[],o=[t];for(t._=1,i.push(e);t=o.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){a[0>t?~t:t].forEach(function(t){t._||(t._=1,o.push(t))})})})}}),n.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:i.map(function(e){var o,n=[];if(e.forEach(function(t){t.forEach(function(t){t.forEach(function(t){a[0>t?~t:t].length<2&&n.push(t)})})}),n=l(t,n),(o=n.length)>1)for(var i,s=r(e[0][0]),p=0;o>p;++p)if(s===r(n[p])){i=n[0],n[0]=n[p],n[p]=i;break}return n})}}function m(t){function e(t,e){t.forEach(function(t){0>t&&(t=~t);var o=a[t];o?o.push(e):a[t]=[e]})}function o(t,o){t.forEach(function(t){e(t,o)})}function r(t,e){"GeometryCollection"===t.type?t.geometries.forEach(function(t){r(t,e)}):t.type in s&&s[t.type](t.arcs,e)}var a={},i=t.map(function(){return[]}),s={LineString:e,MultiLineString:o,Polygon:o,MultiPolygon:function(t,e){t.forEach(function(t){o(t,e)})}};t.forEach(r);for(var p in a)for(var l=a[p],h=l.length,c=0;h>c;++c)for(var u=c+1;h>u;++u){var d,y=l[c],f=l[u];(d=i[y])[p=n(d,f)]!==f&&d.splice(p,0,f),(d=i[f])[p=n(d,y)]!==y&&d.splice(p,0,y)}return i}function g(t,e){return t[1][2]-e[1][2]}function _(){function t(t,e){for(;e>0;){var o=(e+1>>1)-1,a=r[o];if(g(t,a)>=0)break;r[a._=e]=a,r[t._=e=o]=t}}function e(t,e){for(;;){var o=e+1<<1,n=o-1,i=e,s=r[i];if(a>n&&g(r[n],s)<0&&(s=r[i=n]),a>o&&g(r[o],s)<0&&(s=r[i=o]),i===e)break;r[s._=e]=s,r[t._=e=i]=t}}var o={},r=[],a=0;return o.push=function(e){return t(r[e._=a]=e,a++),a},o.pop=function(){if(!(0>=a)){var t,o=r[0];return--a>0&&(t=r[a],e(r[t._=0]=t,0)),o}},o.remove=function(o){var n,i=o._;if(r[i]===o)return i!==--a&&(n=r[a],(g(n,o)<0?t:e)(r[n._=i]=n,i)),i},o}function v(t,e){function a(t){s.remove(t),t[1][2]=e(t),s.push(t)}var n=o(t.transform),i=r(t.transform),s=_();return e||(e=u),t.arcs.forEach(function(t){var o,r,p,l,h=[],c=0;for(r=0,p=t.length;p>r;++r)l=t[r],n(t[r]=[l[0],l[1],1/0],r);for(r=1,p=t.length-1;p>r;++r)o=t.slice(r-1,r+2),o[1][2]=e(o),h.push(o),s.push(o);for(r=0,p=h.length;p>r;++r)o=h[r],o.previous=h[r-1],o.next=h[r+1];for(;o=s.pop();){var u=o.previous,d=o.next;o[1][2]<c?o[1][2]=c:c=o[1][2],u&&(u.next=d,u[2]=o[2],a(u)),d&&(d.previous=u,d[0]=o[0],a(d))}t.forEach(i)}),t}var M="1.6.24";t.version=M,t.mesh=h,t.meshArcs=c,t.merge=y,t.mergeArcs=f,t.feature=i,t.neighbors=m,t.presimplify=v}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Utility",["d3"],e):t.map_Utility=e(t.d3)}(this,function(t){function e(){}e.prototype.constructor=e,e.prototype._class+=" map_Geohash",e.prototype.base32="0123456789bcdefghjkmnpqrstuvwxyz",e.prototype.encode=function(t,e,o){if("undefined"==typeof o){for(var r=1;12>=r;r++){var a=this.encode(t,e,r),n=this.decode(a);if(n.lat===t&&n.lon===e)return a}o=12}if(t=Number(t),e=Number(e),o=Number(o),isNaN(t)||isNaN(e)||isNaN(o))throw new Error("Invalid geohash");for(var i=0,s=0,p=!0,l="",h=-90,c=90,u=-180,d=180;l.length<o;){if(p){var y=(u+d)/2;e>y?(i=2*i+1,u=y):(i=2*i,d=y)}else{var f=(h+c)/2;t>f?(i=2*i+1,h=f):(i=2*i,c=f)}p=!p,5===++s&&(l+=this.base32.charAt(i),s=0,i=0)}return l},e.prototype.decode=function(t){var e=this.bounds(t),o=e.sw.lat,r=e.sw.lon,a=e.ne.lat,n=e.ne.lon,i=(o+a)/2,s=(r+n)/2;return i=i.toFixed(Math.floor(2-Math.log(a-o)/Math.LN10)),s=s.toFixed(Math.floor(2-Math.log(n-r)/Math.LN10)),{lat:Number(i),lon:Number(s)}},e.prototype.bounds=function(t){if(0===t.length)throw new Error("Invalid geohash");t=t.toLowerCase();for(var e=!0,o=-90,r=90,a=-180,n=180,i=0;i<t.length;i++){var s=t.charAt(i),p=this.base32.indexOf(s);if(-1===p)throw new Error("Invalid geohash");for(var l=4;l>=0;l--){var h=p>>l&1;if(e){var c=(a+n)/2;1===h?a=c:n=c}else{var u=(o+r)/2;1===h?o=u:r=u}e=!e}}var d={sw:{lat:o,lon:a},ne:{lat:r,lon:n}};return d},e.prototype.adjacent=function(t,e){if(t=t.toLowerCase(),e=e.toLowerCase(),0===t.length)throw new Error("Invalid geohash");if(-1==="nsew".indexOf(e))throw new Error("Invalid direction");var o={n:["p0r21436x8zb9dcf5h7kjnmqesgutwvy","bc01fg45238967deuvhjyznpkmstqrwx"],s:["14365h7k9dcfesgujnmqp0r2twvyx8zb","238967debc01fg45kmstqrwxuvhjyznp"],e:["bc01fg45238967deuvhjyznpkmstqrwx","p0r21436x8zb9dcf5h7kjnmqesgutwvy"],w:["238967debc01fg45kmstqrwxuvhjyznp","14365h7k9dcfesgujnmqp0r2twvyx8zb"]},r={n:["prxz","bcfguvyz"],s:["028b","0145hjnp"],e:["bcfguvyz","prxz"],w:["0145hjnp","028b"]},a=t.slice(-1),n=t.slice(0,-1),i=t.length%2;return-1!==r[e][i].indexOf(a)&&""!==n&&(n=this.adjacent(n,e)),n+this.base32.charAt(o[e][i].indexOf(a))},e.prototype.neighbours=function(t){return{n:this.adjacent(t,"n"),ne:this.adjacent(this.adjacent(t,"n"),"e"),e:this.adjacent(t,"e"),se:this.adjacent(this.adjacent(t,"s"),"e"),s:this.adjacent(t,"s"),sw:this.adjacent(this.adjacent(t,"s"),"w"),w:this.adjacent(t,"w"),nw:this.adjacent(this.adjacent(t,"n"),"w")}},e.prototype.contained=function(t,e,o,r,a){(isNaN(e)||e>=90)&&(e=89),(isNaN(o)||o>180)&&(o=180),(isNaN(r)||-90>=r)&&(r=-89),(isNaN(t)||-180>t)&&(t=-180),a=a||1;for(var n=this.encode(e,t,a),i=this.encode(e,o,a),s=this.encode(r,o,a),p=n,l=0,h=-1,c=[n,s],u=this.adjacent(n,"e");u!==s;)c.push(u),++l,u===i||h===l?(h=l+1,l=0,u=this.adjacent(p,"s"),p=u):u=this.adjacent(u,"e");return c},e.prototype.calculateWidthDegrees=function(t){var e;e=t%2===0?-1:-.5;var o=180/Math.pow(2,2.5*t+e);return o},e.prototype.width=function(t){var e=t%2;return 180/(2^(5*t+e)/2-1)};var o=function(){function e(){var e=Math.max(Math.log(r)/Math.LN2-8,0),i=Math.round(e+n),s=Math.pow(2,e-i+8),p=[(a[0]-r/2)/s,(a[1]-r/2)/s],l=[],h=t.range(Math.max(0,Math.floor(-p[0])),Math.max(0,Math.ceil(o[0]/s-p[0]))),c=t.range(Math.max(0,Math.floor(-p[1])),Math.max(0,Math.ceil(o[1]/s-p[1])));return c.forEach(function(t){h.forEach(function(e){l.push([e,t,i])})}),l.translate=p,l.scale=s,l}var o=[960,500],r=256,a=[o[0]/2,o[1]/2],n=0;return e.size=function(t){return arguments.length?(o=t,e):o},e.scale=function(t){return arguments.length?(r=t,e):r},e.translate=function(t){return arguments.length?(a=t,e):a},e.zoomDelta=function(t){return arguments.length?(n=+t,e):n},e},r=function(){function e(t){var e=t[0],s=t[1];return o=null,r(e,s),o||(a(e,s),o)||(n(e,s),o)||(i(e,s),o),o}var o,r,a,n,i,s=1e-6,p=t.geo.albers(),l=t.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),h=t.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c=t.geo.conicEqualArea().rotate([66,0]).center([0,18]).parallels([8,18]),u={point:function(t,e){o=[t,e]}};return e.invert=function(t){var e=p.scale(),o=p.translate(),r=(t[0]-o[0])/e,a=(t[1]-o[1])/e;return(a>=.12&&.234>a&&r>=-.425&&-.214>r?l:a>=.166&&.234>a&&r>=-.214&&-.115>r?h:a>=.204&&.234>a&&r>=.32&&.38>r?c:p).invert(t)},e.stream=function(t){var e=p.stream(t),o=l.stream(t),r=h.stream(t),a=c.stream(t);return{point:function(t,n){e.point(t,n),o.point(t,n),r.point(t,n),a.point(t,n)},sphere:function(){e.sphere(),o.sphere(),r.sphere(),a.sphere()},lineStart:function(){e.lineStart(),o.lineStart(),r.lineStart(),a.lineStart()},lineEnd:function(){e.lineEnd(),o.lineEnd(),r.lineEnd(),a.lineEnd()},polygonStart:function(){e.polygonStart(),o.polygonStart(),r.polygonStart(),a.polygonStart()},polygonEnd:function(){e.polygonEnd(),o.polygonEnd(),r.polygonEnd(),a.polygonEnd()}}},e.precision=function(t){return arguments.length?(p.precision(t),l.precision(t),h.precision(t),c.precision(t),e):p.precision()},e.scale=function(t){return arguments.length?(p.scale(t),l.scale(.35*t),h.scale(t),c.scale(t),e.translate(p.translate())):p.scale()},e.translate=function(t){if(!arguments.length)return p.translate();var o=p.scale(),d=+t[0],y=+t[1];return r=p.translate(t).clipExtent([[d-.455*o,y-.238*o],[d+.455*o,y+.238*o]]).stream(u).point,a=l.translate([d-.307*o,y+.201*o]).clipExtent([[d-.425*o+s,y+.12*o+s],[d-.214*o-s,y+.234*o-s]]).stream(u).point,n=h.translate([d-.205*o,y+.212*o]).clipExtent([[d-.214*o+s,y+.166*o+s],[d-.115*o-s,y+.234*o-s]]).stream(u).point,i=c.translate([d+.35*o,y+.224*o]).clipExtent([[d+.32*o,y+.204*o],[d+.38*o,y+.234*o]]).stream(u).point,e},e.scale(1070)};return t.geo.albersUsaPr||(t.geo.albersUsaPr=r),{Geohash:e,Tile:o,albersUsaPr:r}}),define("css!src/map/Layered",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Layered",["d3","topojson","../common/SVGWidget","./Utility","css!./Layered"],e):t.map_Layered=e(t.d3,t.topojson,t.common_SVGWidget,t.map_Utility)}(this,function(t,e,o,r){function a(){o.call(this),this._drawStartPos="origin",this._layers=[],this.projection("mercator")}var n=.25,i=2048/Math.PI;return a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype._class+=" map_Layered",a.prototype.publish("projection",null,"set","Map projection type",["albersUsa","albersUsaPr","azimuthalEqualArea","azimuthalEquidistant","conicEqualArea","conicConformal","conicEquidistant","equirectangular","gnomonic","mercator","orthographic","stereographic","transverseMercator"]),a.prototype.publish("centerLat",0,"number","Center Latitude",null,{tags:["Basic"]}),a.prototype.publish("centerLong",0,"number","Center Longtitude",null,{tags:["Basic"]}),a.prototype.publish("zoom",1,"number","Zoom Level",null,{tags:["Basic"]}),a.prototype.publish("autoScaleMode","all","set","Auto Scale",["none","all"],{tags:["Basic"]}),a.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);return arguments.length&&(this._autoScaleOnNextRender=!0),e},a.prototype.projection_orig=a.prototype.projection,a.prototype.projection=function(e){var o=a.prototype.projection_orig.apply(this,arguments);if(arguments.length){switch(this._d3GeoProjection=t.geo[e]().scale(i).translate([0,0]),e){case"orthographic":this._d3GeoProjection.clipAngle(90).rotate([0,0])}this._d3GeoPath=t.geo.path().projection(this._d3GeoProjection),this._autoScaleOnNextRender=!0}return o},a.prototype.layers=function(t){return arguments.length?(this._layers=t,this):this._layers},a.prototype.size=function(t){var e=o.prototype.size.apply(this,arguments);return arguments.length&&(delete this._prevCenterLat,delete this._prevCenterLong),e},a.prototype.enter=function(e,r){o.prototype.enter.apply(this,arguments);var a=this;this._zoom=t.behavior.zoom().scaleExtent([.25*n,131072*n]).on("zoomstart",function(t){a._zoomstart_translate=a._zoom.translate(),a._zoomstart_scale=a._zoom.scale()}).on("zoom",function(){if(t.event&&t.event.sourceEvent&&t.event.sourceEvent.ctrlKey&&"mousemove"===t.event.sourceEvent.type)return void a.render();a.zoomed();var e=a.width()/2,o=a.height()/2,r=a.invert(e,o);a.centerLong(r[0]),a.centerLat(r[1]),a.zoom(a._zoom.scale()/n),a._prevCenterLong=a.centerLong(),a._prevCenterLat=a.centerLat(),a._prevZoom=a.zoom()}).on("zoomend",function(){}),this._zoomGrab=r.append("rect").attr("class","background"),this._layersTarget=r.append("g"),r.call(this._zoom)},a.prototype.update=function(e,r){if(o.prototype.update.apply(this,arguments),this._prevCenterLat!==this.centerLat()||this._prevCenterLong!==this.centerLong()||this._prevZoom!==this.zoom()){var a=t.geo[this.projection()]().scale(this.zoom()*n*i).translate([this.width()/2,this.height()/2]),s=a([this.centerLong(),this.centerLat()])||[this.width()/2,this.height()/2];this._zoom.scale(this.zoom()*n).translate([this.width()-s[0],this.height()-s[1]]),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong(),this._prevZoom=this.zoom()}this._zoomGrab.attr("width",this.width()).attr("height",this.height());var p=this._layersTarget.selectAll(".layerContainer").data(this.layers().filter(function(t){return t.visible()}),function(t){return t.id()}),l=this;p.enter().append("g").attr("class","layerContainer").each(function(e){e._svgElement=t.select(this),e._domElement=l._parentOverlay.append("div"),e.layerEnter(l,e._svgElement,e._domElement)}),p.each(function(t){t.layerUpdate(l)}),p.exit().each(function(t){t.layerExit(l),t._domElement.remove()}).remove(),p.order(),this.zoomed()},a.prototype.exit=function(t,e){o.prototype.enter.apply(this,arguments)},a.prototype.zoomed=function(){var t=this._layersTarget.selectAll(".layerContainer"),e=this;t.each(function(t){t.layerZoomed(e)})},a.prototype.render=function(t){var e=this,r=o.prototype.render.call(this,function(o){e._renderCount&&e._autoScaleOnNextRender||e._prevAutoScaleMode!==e.autoScaleMode()?(e._prevAutoScaleMode=e.autoScaleMode(),e._autoScaleOnNextRender=!1,setTimeout(function(){e.autoScale(),e.autoScale(),t&&t(o)},0)):t&&t(o)});return r},a.prototype.project=function(t,e){t>=90?t=89:-90>=t&&(t=-89);var o=this._d3GeoProjection([e,t]);return o&&(o[0]*=this._zoom.scale(),o[1]*=this._zoom.scale(),o[0]+=this._zoom.translate()[0],o[1]+=this._zoom.translate()[1]),o},a.prototype.invert=function(t,e){return t-=this._zoom.translate()[0],e-=this._zoom.translate()[1],t/=this._zoom.scale(),e/=this._zoom.scale(),this._d3GeoProjection.invert([t,e])},a.prototype.getBounds=function(){var t=this._layersTarget.node().getBBox();return{x:t.x,y:t.y,width:t.width,height:t.height}},a.prototype.autoScale=function(){switch(this.autoScaleMode()){case"none":return;case"all":this.shrinkToFit(this.getBounds())}},a.prototype.shrinkToFit=function(t){var e=this.width(),o=this.height(),r=this._zoom.translate(),a=this._zoom.scale();t.x+=t.width/2,t.y+=t.height/2,r[0]-=t.x-e/2,r[1]-=t.y-o/2;var n=a*Math.min(e/t.width,o/t.height);this._zoom.translate(r).scale(n).event(this._layersTarget)},a}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Layer",["./Layered","../api/ITooltip"],e):t.map_Layer=e(t.map_Layered,t.api_ITooltip)}(this,function(t,e){function o(o){t.call(this),e.call(this)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype._class+=" map_Layer",o.prototype["implements"](e.prototype),o.prototype.layerEnter=function(t,e,o){this._parentOverlay=t._parentOverlay},o.prototype.enter=function(e,o){t.prototype.enter.apply(this,arguments),this._svgElement=this._layersTarget.append("g"),this._domElement=this._parentOverlay.append("div"),this.layerEnter(this,this._svgElement,this._domElement)},o.prototype.layerUpdate=function(t){},o.prototype.update=function(e,o){t.prototype.update.apply(this,arguments),this.layerUpdate(this)},o.prototype.layerExit=function(t){},o.prototype.exit=function(e,o){this.layerExit(this),this._svgElement.remove(),this._domElement.remove(),t.prototype.exit.apply(this,arguments)},o.prototype.layerZoomed=function(t){},o.prototype.zoomed=function(){t.prototype.zoomed.apply(this,arguments),this.layerZoomed(this)},o}),define("css!src/map/Choropleth",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Choropleth",["d3","topojson","./Layer","../common/Palette","css!./Choropleth"],e):t.map_Choropleth=e(t.d3,t.topojson,t.map_Layer,t.common_Palette)}(this,function(t,e,o,r){function a(){o.call(this),this._dataMap={},this._path=t.select(null)}return a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype._class+=" map_Choropleth",a.prototype._palette=r.rainbow("default"),a.prototype.publish("paletteID","YlOrRd","set","Palette ID",a.prototype._palette["switch"](),{tags:["Basic","Shared"]}),a.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),a.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),a.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),a.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),a.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),a.prototype.publish("internalOnly",!1,"boolean","Internal mesh only"),a.prototype.publish("autoScaleMode","mesh","set","Auto Scale",["none","mesh","data"],{tags:["Basic"],override:!0}),a.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);if(arguments.length){this._dataMap={},this._dataMinWeight=null,this._dataMaxWeight=null;var r=this;this.data().forEach(function(t){r._dataMap[t[0]]=t,(!r._dataMinWeight||t[1]<r._dataMinWeight)&&(r._dataMinWeight=t[1]),(!r._dataMaxWeight||t[1]>r._dataMaxWeight)&&(r._dataMaxWeight=t[1])})}return e},a.prototype.getDataBounds=function(){var t=this._choroplethData.node().getBBox(),e={x:t.x,y:t.y,width:t.width,height:t.height},o=this._zoom.scale();e.x*=o,e.y*=o,e.width*=o,e.height*=o;var r=this._zoom.translate();return e.x+=r[0],e.y+=r[1],e},a.prototype.autoScale=function(){switch(this.autoScaleMode()){case"none":return;case"mesh":this.shrinkToFit(this.getBounds());break;case"data":this.shrinkToFit(this.getDataBounds())}},a.prototype.layerEnter=function(t,e,r){o.prototype.layerEnter.apply(this,arguments),this._choroplethTransform=e,this._choroplethData=this._choroplethTransform.append("g"),this._choropleth=this._choroplethTransform.append("path").attr("class","mesh")},a.prototype.layerUpdate=function(t,r){return o.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this.visible()&&this.meshVisible()?((r||this._prevProjection!==t.projection()||this._prevInternalOnly!==this.internalOnly())&&(this._choropleth.attr("d",t._d3GeoPath(e.mesh(this._choroTopology,this._choroTopologyObjects,this.internalOnly()?function(t,e){return t!==e}:function(t,e){return!0}))),this._prevProjection=t.projection(),this._prevInternalOnly=this.internalOnly()),void this._choroplethTransform.style("opacity",this.opacity()).style("stroke",this.meshColor())):(this._choropleth.attr("d",""),void delete this._prevProjection)},a.prototype.layerExit=function(t){delete this._prevProjection,delete this._prevInternalOnly},a.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this._choroplethTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/t._zoom.scale()+"px")},a.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},a}),function(t,e){"function"==typeof define&&define.amd?define("src/map/ChoroplethContinents",["d3","topojson","./Choropleth","./countries","../common/Utility"],e):t.map_ChoroplethContinents=e(t.d3,t.topojson,t.map_Choropleth,t.map_countries,t.common_Utility)}(this,function(t,e,o,r,a){function n(){o.call(this),this._choroTopology=r.topology,this._choroTopologyObjects=r.topology.objects.land}return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_ChoroplethContinents",n}),function(t,e){"function"==typeof define&&define.amd?define("src/map/ChoroplethCounties",["d3","topojson","./Choropleth","./us-counties","../common/Utility"],e):t.map_ChoroplethCounties=e(t.d3,t.topojson,t.map_Choropleth,t.map_usCounties,t.common_Utility)}(this,function(t,e,o,r,a){function n(){o.call(this),this.projection("albersUsaPr"),this._choroTopology=r.topology,this._choroTopologyObjects=r.topology.objects.counties}var i=e.feature(r.topology,r.topology.objects.counties).features,s={};for(var p in i)i[p].id&&(s[i[p].id]=i[p]);var l=t.format("05d");return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_ChoroplethCounties",n.prototype.publish("onClickFormatFIPS",!1,"boolean","format FIPS code as a String on Click"),n.prototype.layerEnter=function(e,n,i){o.prototype.layerEnter.apply(this,arguments),this._selection=new a.SimpleSelection(this._choroplethData),this.choroPaths=t.select(null);var s=this;this.tooltipHTML(function(t){return s.tooltipFormat({label:r.countyNames[t[0]],value:s._dataMap[t[0]]?s._dataMap[t[0]][1]:"N/A"})})},n.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var e=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){if(e._dataMap[t[0]]){var o=e.onClickFormatFIPS()?e._dataMap[t[0]].map(function(t,o){return e.onClickFormatFIPS()&&0===o?l(t):t}):e._dataMap[t[0]];e.click(e.rowToObj(o),"weight",e._selection.selected(this))}}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(e){var o=t._d3GeoPath(s[e[0]]);return o||console.log("Unknown US County:  "+e),o}).style("fill",function(t){var o=e._palette(t[1],e._dataMinWeight,e._dataMaxWeight);return o}),this.choroPaths.exit().remove()},n}),function(t,e){"function"==typeof define&&define.amd?define("src/map/ChoroplethCountries",["d3","topojson","./Choropleth","./countries","../common/Utility"],e):t.map_ChoroplethCountries=e(t.d3,t.topojson,t.map_Choropleth,t.map_countries,t.common_Utility)}(this,function(t,e,o,r,a){function n(){o.call(this),this._choroTopology=r.topology,this._choroTopologyObjects=r.topology.objects.countries}var i=e.feature(r.topology,r.topology.objects.countries).features,s={};for(var p in i)i[p].id&&r.countryNames[i[p].id]&&(s[r.countryNames[i[p].id].name]=i[p]);return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_ChoroplethCountries",n.prototype.layerEnter=function(e,r,n){o.prototype.layerEnter.apply(this,arguments),this._selection=new a.SimpleSelection(this._choroplethData),this.choroPaths=t.select(null);var i=this;this.tooltipHTML(function(t){return i.tooltipFormat({label:t[0],value:t[1]})})},n.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var e=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){e._dataMap[t[0]]&&e.click(e.rowToObj(e._dataMap[t[0]]),"weight",e._selection.selected(this))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(e){var o=t._d3GeoPath(s[e[0]]);return o||console.log("Unknown Country:  "+e),o}).style("fill",function(t){var o=e._palette(t[1],e._dataMinWeight,e._dataMaxWeight);return o}),this.choroPaths.exit().remove()},n}),function(t,e){"function"==typeof define&&define.amd?define("src/map/ChoroplethStates",["d3","topojson","./Choropleth","./us-states","../common/Utility"],e):t.map_ChoroplethStates=e(t.d3,t.topojson,t.map_Choropleth,t.map_usStates,t.common_Utility)}(this,function(t,e,o,r,a){function n(){o.call(this),this.projection("albersUsaPr"),this._choroTopology=r.topology,this._choroTopologyObjects=r.topology.objects.states}var i=e.feature(r.topology,r.topology.objects.states).features,s={};for(var p in i)i[p].id&&(s[r.stateNames[i[p].id].code]=i[p]);return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_ChoroplethStates",n.prototype.layerEnter=function(e,n,i){o.prototype.layerEnter.apply(this,arguments),this._selection=new a.SimpleSelection(this._choroplethData),this.choroPaths=t.select(null);var p=this;this.tooltipHTML(function(t){var e=s[t[0]].id;return p.tooltipFormat({label:r.stateNames[e].name,value:t[1]})})},n.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var e=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){e.click(e.rowToObj(t),"weight",e._selection.selected(this))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(e){var o=t._d3GeoPath(s[e[0]]);return o||console.log("Unknown US State:  "+e),o}).style("fill",function(t){var o=e._palette(t[1],e._dataMinWeight,e._dataMaxWeight);return o}),this.choroPaths.exit().remove()},n}),function(t,e){"function"==typeof define&&define.amd?define("src/map/ChoroplethStatesHeat",["../layout/Layered"],e):t.map_ChoroplethStatesHeat=e(t.layout_Layered)}(this,function(t){function e(e){t.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype._class+=" map_ChoroplethStatesHeat",e}),define("css!src/map/GeoHash",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/GeoHash",["d3","topojson","./Layer","./Utility","../common/Palette","../common/Utility","css!./GeoHash"],e):t.map_GeoHash=e(t.d3,t.topojson,t.map_Layer,t.map_Utility,t.common_Palette,t.common_Utility)}(this,function(t,e,o,r,a,n){function i(){o.call(this)}return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._class+=" map_GeoHash",i.prototype._palette=a.rainbow("default"),i.prototype.publish("paletteID","YlOrRd","set","Palette ID",i.prototype._palette["switch"](),{tags:["Basic","Shared"]}),i.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),i.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),i.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),i.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),i.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),i.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);return arguments.length&&(this._dataMinWeight=null,this._dataMaxWeight=null,this.data().forEach(function(t){(!this._dataMinWeight||t[1]<this._dataMinWeight)&&(this._dataMinWeight=t[1]),(!this._dataMaxWeight||t[1]>this._dataMaxWeight)&&(this._dataMaxWeight=t[1])},this)),e},i.prototype.layerEnter=function(e,a,i){o.prototype.layerEnter.apply(this,arguments),this.geohash=new r.Geohash,this._geoHashTransform=a.append("g"),this._selection=new n.SimpleSelection(this._geoHashTransform),this.geoHashPaths=t.select(null)},i.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this._geoHashTransform.style("opacity",this.opacity()),this.geoHashPaths=this._geoHashTransform.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var e=this;this.geoHashPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){e.click(e.rowToObj(t),"weight",e._selection.selected(this))}),this.geoHashPaths.attr("d",function(o){var r=e.geohash.bounds(o[0]),a={type:"LineString",coordinates:[[r.sw.lon,r.ne.lat],[r.ne.lon,r.ne.lat],[r.ne.lon,r.sw.lat],[r.sw.lon,r.sw.lat]]};return t._d3GeoPath(a)}).style("fill",function(t){var o=e._palette(t[1],e._dataMinWeight,e._dataMaxWeight);return o}),this.geoHashPaths.exit().remove()},i.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this._geoHashTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").attr("stroke-width",1.5/t._zoom.scale()+"px")},i.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},i}),define("css!src/map/GMap",[],function(){}),function(t,e){if("function"==typeof define&&define.amd){var o="https:"===window.location.protocol?"https:":"http:";define("src/map/GMap",["d3","../common/HTMLWidget","../layout/AbsoluteSurface","async!"+o+"//maps.google.com/maps/api/js","css!./GMap"],e)}else t.map_GMap=e(t.d3,t.common_HTMLWidget,t.layout_AbsoluteSurface)}(this,function(t,e,o){function r(t,e,o){google.maps.OverlayView.call(this),this._div=null,this._worldSurface=e,this._viewportSurface=o,this._map=t,this.setMap(t);var r=this;google.maps.event.addListener(t,"bounds_changed",function(){r.draw()}),google.maps.event.addListener(t,"projection_changed",function(){r.draw()}),this._prevWorldMin={x:0,y:0},this._prevWorldMax={x:0,y:0},this._prevMin={x:0,y:0},this._prevMax={x:0,y:0}}function a(){function t(t,e,o){var a=r._overlay.getProjection(),n=a.fromLatLngToDivPixel(new google.maps.LatLng(e,o)),i=a.getWorldWidth(),s=parseFloat(t.widgetX()),p=parseFloat(t.widgetY()),l=parseFloat(t.widgetWidth());
for(n.x-=s,n.y-=p;n.x<0;)n.x+=i;for(;n.x>l;)n.x-=i;return n}e.call(this),this._tag="div";var r=this;this._worldSurface=new o,this._worldSurface.project=function(e,o){return t(this,e,o)},this._viewportSurface=new o,this._viewportSurface.project=function(e,o){return t(this,e,o)}}return r.prototype=google.maps.OverlayView.prototype,r.prototype.onAdd=function(){this.div=document.createElement("div"),this._viewportSurface.target(this.div).units("pixels");var t=this.getPanes();t.overlayMouseTarget.appendChild(this.div)},r.prototype.draw=function(){var t=this.getProjection();if(t){for(var e=this._map.getBounds(),o=t.fromLatLngToDivPixel(e.getCenter()),r=t.fromLatLngToDivPixel(e.getSouthWest()),a=t.fromLatLngToDivPixel(e.getNorthEast()),n={x:r.x,y:a.y},i={x:a.x,y:r.y},s=t.getWorldWidth();i.x<n.x+100;)i.x+=s;for(;n.x>o.x;)n.x-=s,i.x-=s;(n.x!==this._prevMin.x||n.y!==this._prevMin.y||i.x!==this._prevMax.x||i.y!==this._prevMax.y)&&(this._viewportSurface.widgetX(n.x).widgetY(n.y).widgetWidth(i.x-n.x).widgetHeight(i.y-n.y).render(),this._prevMin=n,this._prevMax=i);for(var p=t.fromLatLngToDivPixel(new google.maps.LatLng(85,-179.9)),l=t.fromLatLngToDivPixel(new google.maps.LatLng(-85,179.9));l.x<p.x+100;)l.x+=s;for(;p.x>o.x;)p.x-=s,l.x-=s;(p.x!==this._prevWorldMin.x||p.y!==this._prevWorldMin.y||l.x!==this._prevWorldMax.x||l.y!==this._prevWorldMax.y)&&(this._worldSurface.widgetX(p.x).widgetY(p.y).widgetWidth(l.x-p.x).widgetHeight(l.y-p.y).render(),this._prevWorldMin=l,this._prevWorldMax=l)}},r.prototype.onRemove=function(){this._viewportSurface.target(null),this._div.parentNode.removeChild(this._div),this._div=null},a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.prototype._class+=" map_GMap",a.prototype.publish("type","road","set","Map Type",["terrain","road","satellite","hybrid"],{tags:["Basic"]}),a.prototype.publish("centerLat",42.877742,"number","Center Latitude",null,{tags:["Basic"]}),a.prototype.publish("centerLong",-97.380979,"number","Center Longtitude",null,{tags:["Basic"]}),a.prototype.publish("zoom",4,"number","Zoom Level",null,{tags:["Basic"]}),a.prototype.publish("panControl",!0,"boolean","Pan Controls",null,{tags:["Basic"]}),a.prototype.publish("zoomControl",!0,"boolean","Pan Controls",null,{tags:["Basic"]}),a.prototype.publish("mapTypeControl",!1,"boolean","Pan Controls",null,{tags:["Basic"]}),a.prototype.publish("scaleControl",!0,"boolean","Pan Controls",null,{tags:["Basic"]}),a.prototype.publish("streetViewControl",!1,"boolean","Pan Controls",null,{tags:["Basic"]}),a.prototype.publish("overviewMapControl",!1,"boolean","Pan Controls",null,{tags:["Basic"]}),a.prototype.data=function(t){var o=e.prototype.data.apply(this,arguments);return o},a.prototype.getMapType=function(){switch(this.type()){case"terrain":return google.maps.MapTypeId.TERRAIN;case"road":return google.maps.MapTypeId.ROADMAP;case"satellite":return google.maps.MapTypeId.SATELLITE;case"hybrid":return google.maps.MapTypeId.HYBRID;default:return google.maps.MapTypeId.ROADMAP}},a.prototype.getMapOptions=function(){return{panControl:this.panControl(),zoomControl:this.zoomControl(),mapTypeControl:this.mapTypeControl(),scaleControl:this.scaleControl(),streetViewControl:this.streetViewControl(),overviewMapControl:this.overviewMapControl(),overviewMapControlOptions:{opened:!0}}},a.prototype.size=function(t){var o=e.prototype.size.apply(this,arguments);return arguments.length&&this._googleMapNode&&(this._googleMapNode.style({width:t.width+"px",height:t.height+"px"}),google.maps.event.trigger(this._googleMap,"resize")),o},a.prototype.enter=function(o,a){e.prototype.enter.apply(this,arguments),this._googleMapNode=a.append("div").style({width:this.width()+"px",height:this.height()+"px"}),this._googleMap=new google.maps.Map(this._googleMapNode.node(),{zoom:this.zoom(),center:new google.maps.LatLng(this.centerLat(),this.centerLong()),mapTypeId:this.getMapType(),disableDefaultUI:!0}),this._overlay=new r(this._googleMap,this._worldSurface,this._viewportSurface),this._circleMap=t.map([]),this._pinMap=t.map([]),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong(),this._prevZoom=this.zoom()},a.prototype.update=function(t,e){this._googleMap.setMapTypeId(this.getMapType()),this._googleMap.setOptions(this.getMapOptions()),(this._prevCenterLat!==this.centerLat()||this._prevCenterLong!==this.centerLong())&&(this._googleMap.setCenter(new google.maps.LatLng(this.centerLat(),this.centerLong())),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong()),this._prevZoom!==this.zoom()&&(this._googleMap.setZoom(this.zoom()),this._prevZoom=this.zoom()),this.updateCircles(),this.updatePins()},a.prototype.updateCircles=function(){function e(t){return t[0]+"_"+t[1]}var o=[],r=[],a=t.map(this._circleMap.keys(),function(t){return t});this.data().forEach(function(t){a.remove(e(t)),t[3]&&!this._circleMap.has(e(t))?o.push(t):t[3]&&this._circleMap.has(e(t))?r.push(t):!t[3]&&this._circleMap.has(e(t))&&a.set(e(t),!0)},this),o.forEach(function(t){var o=this.createCircle(t[0],t[1],t[3],"");this._circleMap.set(e(t),o)},this),r.forEach(function(t){},this);var n=this;a.forEach(function(t){n._circleMap.get(t).setMap(null),n._circleMap.remove(t)})},a.prototype.updatePins=function(){function e(t){return t[0]+"_"+t[1]}var o=[],r=[],a=t.map(this._pinMap.keys(),function(t){return t});this.data().forEach(function(t){a.remove(e(t)),t[2]&&!this._pinMap.has(e(t))?o.push(t):t[2]&&this._pinMap.has(e(t))?r.push(t):!t[2]&&this._pinMap.has(e(t))&&a.set(e(t),!0)},this),o.forEach(function(t){var o=this.createMarker(t[0],t[1],t[2],"");this._pinMap.set(e(t),o)},this),r.forEach(function(t){this._pinMap.get(e(t)).setIcon(this.createIcon(t[2]))},this);var n=this;a.forEach(function(t){n._pinMap.get(t).setMap(null),n._pinMap.remove(t)})},a.prototype.createIcon=function(t){return{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z M -2,-30",fillColor:t.fillColor,fillOpacity:t.fillOpacity||.8,scale:.5,strokeColor:t.strokeColor||"black",strokeWeight:.25}},a.prototype.createMarker=function(t,e,o){return new google.maps.Marker({position:new google.maps.LatLng(t,e),animation:google.maps.Animation.DROP,title:o.title||"",icon:this.createIcon(o),map:this._googleMap})},a.prototype.createCircle=function(t,e,o){return new google.maps.Circle({center:new google.maps.LatLng(t,e),radius:16093*o.radius/10,fillColor:o.fillColor||"red",strokeColor:o.strokeColor||o.fillColor||"black",strokeWeight:.5,map:this._googleMap})},a.prototype.zoomTo=function(t){var e=0,o=new google.maps.LatLngBounds;return t.forEach(function(t){var r=new google.maps.LatLng(t[0],t[1]);o.extend(r),++e}),e&&(this._googleMap.setCenter(o.getCenter()),this._googleMap.fitBounds(o),this._googleMap.getZoom()>12&&this._googleMap.setZoom(12)),this},a.prototype.zoomToFit=function(){return this.zoomTo(this.data())},a}),function(t,e){"function"==typeof define&&define.amd?define("src/map/GMapGraph",["./GMap","../graph/Graph","../graph/Edge","../common/Shape"],e):t.map_GMapGraph=e(t.map_GMap,t.graph_Graph,t.graph_Edge,t.common_Shape)}(this,function(t,e,o,r){function a(){t.call(this)}return a.prototype=Object.create(t.prototype),a.prototype.constructor=a,a.prototype._class+=" map_GMapGraph",a.prototype.enter=function(){t.prototype.enter.apply(this,arguments);var a=(new e).layout("None"),n=a.render,i=this;a.render=function(){var t=[],e=[],a=null;i.data().forEach(function(n){var s=i._viewportSurface.project(n[0],n[1]),p=(new r).shape("circle").radius(3).data(n).pos(s);t.push(p),a&&e.push((new o).sourceVertex(a).targetVertex(p).targetMarker("arrowHead")),a=p}),this.data({vertices:t,edges:e}),n.apply(this,arguments),this.graphData.nodeValues().forEach(function(t){var e=i._viewportSurface.project(t.data()[0],t.data()[1]);e.x-=i.width()/2,e.y-=i.height()/2,t.move(e)}),this.graphData.edgeValues().forEach(function(t){t.points([])})},this._viewportSurface.widget(a)},a}),function(t,e){"function"==typeof define&&define.amd?define("src/map/GMapHeat",["./GMap","../other/HeatMap"],e):t.map_GMapHeat=e(t.map_GMap,t.other_HeatMap)}(this,function(t,e){function o(){t.call(this)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype._class+=" map_GMapHeat",o.prototype.enter=function(){t.prototype.enter.apply(this,arguments);var o=new e,r=o.render,a=this;o.render=function(){this.data(a.data().map(function(t){var e=a._viewportSurface.project(t[0],t[1]);return[e.x,e.y,t[4]]})),r.apply(this,arguments)},this._viewportSurface.widget(o)},o}),function(t,e){"function"==typeof define&&define.amd?define("src/map/GMapLayered",["d3","./GMap","../common/SVGWidget"],e):t.map_GMapLayered=e(t.d3,t.map_GMap,t.common_SVGWidget)}(this,function(t,e,o){function r(){o.call(this),this._drawStartPos="origin"}function a(){e.call(this),this._layers=[]}var n=1/16,i=4096;return r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype._class+=" map_Layered",r.prototype.enter=function(e,r){o.prototype.enter.apply(this,arguments),this._zoom=t.behavior.zoom().translate([0,0]).scale(1),this._d3GeoProjection=t.geo.mercator().scale(i/2/Math.PI).translate([0,0]),this._d3GeoPath=t.geo.path().projection(this._d3GeoProjection)},r.prototype.update=function(t,e){o.prototype.update.apply(this,arguments),this._hasZoomed=!0,this._hasRendered?this.zoomed():this.fullRender()},r.prototype.fullRender=function(){if(this._hasZoomed){this._hasRendered=!0,this.size(this.gmap.size());var e=this._element.selectAll(".layerContainer").data(this.gmap.layers(),function(t){return t.id()}),o=this;e.enter().append("g").attr("class","layerContainer").each(function(e){var r=t.select(this),a=o._parentOverlay.append("div");e.layerEnter(o,r,a)}),e.each(function(t){t.layerUpdate(o)}),e.exit().each(function(t){t.layerExit(o)}).remove(),this.zoomed()}},r.prototype.zoomed=function(){var t=this.gmap._overlay.getProjection();if(t){var e=new google.maps.LatLng(0,0),o=t.fromLatLngToDivPixel(e),r=parseFloat(this.surface.widgetX()),a=parseFloat(this.surface.widgetY()),i=[o.x-r,o.y-a],s=this.gmap._googleMap.getZoom();this._zoom.scale(n*(1<<s)).translate(i);var p=this._element.selectAll(".layerContainer"),l=this;p.each(function(t){t.layerZoomed(l)})}},r.prototype.projection=function(){return"mercator"},r.prototype.project=function(t,e){var o=this.surface.project(t,e);return[o.x,o.y]},a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.prototype._class+=" map_GMapLayered",a.prototype.layers=function(t){return arguments.length?(this._layers=t,this):this._layers},a.prototype.enter=function(){e.prototype.enter.apply(this,arguments),this.layered=new r,this.layered.gmap=this,this.layered.surface=this._viewportSurface,this.layered.surface.widget(this.layered).render()},a.prototype.render=function(t){var o=e.prototype.render.apply(this,arguments);return this.layered.fullRender(),o},a}),define("css!src/map/Pins",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Pins",["d3","topojson","./Layer","./Utility","../common/Palette","../common/Utility","css!./Pins"],e):t.map_Pins=e(t.d3,t.topojson,t.map_Layer,t.map_Utility,t.common_Palette,t.common_Utility)}(this,function(t,e,o,r,a,n){function i(){o.call(this)}return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._class+=" map_Pins",i.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),i.prototype.publish("pinColor","#006ccc","html-color","Pin Color",null,{optional:!0}),i.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),i.prototype.layerEnter=function(e,r,a){o.prototype.layerEnter.apply(this,arguments),this._pinsTransform=r,this._selection=new n.SimpleSelection(this._pinsTransform),this.pinsPaths=t.select(null)},i.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this._pinsTransform.style("opacity",this.opacity()),this.pinsPaths=this._pinsTransform.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var e=this;this.pinsPaths.enter().append("path").attr("class","data").attr("d",function(t){return"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z M -2,-30"}).call(this._selection.enter.bind(this._selection)).on("click",function(t){e.click(e.rowToObj(t),"weight",e._selection.selected(this))}),this.pinsPaths.attr("stroke-width","1.5px").style("display",function(e){var o=t.project(e[0],e[1]);return o?null:"none"}).style("fill",function(t){return t[2]&&t[2].fillColor?t[2].fillColor:e.pinColor()}),this.pinsPaths.exit().remove()},i.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this.pinsPaths.attr("transform",function(e){var o=t.project(e[0],e[1]);return o||(o=[0,0]),"translate("+o[0]+", "+o[1]+")scale(0.5)"})},i.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},i}),define("css!src/map/Graph",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Graph",["d3","topojson","./Pins","../graph/Graph","../graph/Edge","../common/Shape","css!./Graph"],e):t.map_Graph=e(t.d3,t.topojson,t.map_Pins,t.graph_Graph,t.graph_Edge,t.common_Shape)}(this,function(t,e,o,r,a,n){function i(){o.call(this)}return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._class+=" map_Graph",i.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);if(arguments.length){this.dataEdges=[];var r=null;t.forEach(function(t){r&&this.dataEdges.push({type:"LineString",coordinates:[[r[1],r[0]],[t[1],t[0]]]}),r=t},this)}return e},i.prototype.layerEnter=function(e,r,a){o.prototype.layerEnter.apply(this,arguments),r.append("defs").append("marker").attr("class","marker").attr("id",this._id+"_arrowHead").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",16).attr("markerHeight",16).attr("markerUnits","strokeWidth").attr("orient","auto").append("polyline").attr("points","0,0 10,5 0,10 1,5"),this._edgesTransform=r.append("g"),this.edgesPaths=t.select(null)},i.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this._edgesTransform.style("opacity",this.opacity()),this.edgesPaths=this._edgesTransform.selectAll(".dataEdge").data(this.visible()?this.dataEdges:[]),this.edgesPaths.enter().append("path").attr("class","dataEdge").attr("marker-end","url(#"+this._id+"_arrowHead)"),this.edgesPaths.attr("d",t._d3GeoPath),this.edgesPaths.exit().remove()},i.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this._edgesTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",.5/t._zoom.scale()+"px")},i}),define("css!src/map/Graticule",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Graticule",["d3","topojson","./Layer","../common/Palette","css!./Graticule"],e):t.map_Graticule=e(t.d3,t.topojson,t.map_Layer,t.common_Palette)}(this,function(t,e,o,r){function a(){o.call(this),this._dataMap={},this._path=t.select(null)}return a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype._class+=" map_Graticule",a.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),a.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),a.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),a.prototype.layerEnter=function(e,r,a){o.prototype.layerEnter.apply(this,arguments),this._graticule=t.geo.graticule(),this._graticulePath=r.append("path").datum(this._graticule).attr("class","graticule"),this._graticuleOutlinePath=r.append("path").datum(this._graticule.outline).attr("class","graticuleOutline")},a.prototype.layerUpdate=function(t){return this.visible()?(this._prevProjection!==t.projection()&&(this._graticulePath.attr("d",t._d3GeoPath),this._graticuleOutlinePath.attr("d",t._d3GeoPath),this._prevProjection=t.projection()),this._graticulePath.style("stroke",this.meshColor()),void this._graticuleOutlinePath.style("stroke",this.meshColor())):(this._graticulePath.attr("d",""),this._graticuleOutlinePath.attr("d",""),void delete this._prevProjection)},a.prototype.layerExit=function(t){delete this._prevProjection},a.prototype.layerZoomed=function(t){this._graticulePath.style("opacity",this.opacity()).attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/t._zoom.scale()+"px"),this._graticuleOutlinePath.style("opacity",this.opacity()).attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/t._zoom.scale()+"px")},a}),define("css!src/map/Heat",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/Heat",["d3","topojson","./Layer","../other/HeatMap","../common/Palette","css!./Heat"],e):t.map_Heat=e(t.d3,t.topojson,t.map_Layer,t.other_HeatMap,t.common_Palette)}(this,function(t,e,o,r,a){function n(){o.call(this)}return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_Heat",n.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),n.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),n.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),n.prototype.layerEnter=function(t,e,a){o.prototype.layerEnter.apply(this,arguments),this._parentOverlay.style("pointer-events","none"),this._heatTransform=a.style("pointer-events","none").append("div").attr("class",this.classID()).style("width",t.width()+"px").style("height",t.height()+"px"),this.heat=(new r).target(this._heatTransform.node())},n.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this._heatTransform.style("opacity",this.opacity()).style("width",t.width()+"px").style("height",t.height()+"px"),this.heat.resize(t.size()),this.heat.columns(this.columns()).data(this.data().map(function(e){var o=t.project(e[0],e[1]);return[o[0],o[1],e[4]]})).render()},n.prototype.layerExit=function(t){delete this._prevProjection,this.heat.target(null),delete this.heat},n.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this.heat.columns(this.columns()).data(this.visible()?this.data().map(function(e){var o=t.project(e[0],e[1]);return[o[0],o[1],e[4]]}):[]).render()},n}),function(t,e){"function"==typeof define&&define.amd?define("src/map/IChoropleth",["../common/Palette"],e):t.map_IChoropleth=e(t.common_Palette,t.usStates,t.usCounties)}(this,function(t,e,o){function r(){}return r.prototype._palette=t.rainbow("default"),r.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},r}),define("css!src/map/OpenStreet",[],function(){}),function(t,e){"function"==typeof define&&define.amd?define("src/map/OpenStreet",["d3","topojson","./Layer","./Utility","css!./OpenStreet"],e):t.map_OpenStreet=e(t.d3,t.topojson,t.map_Layer,t.map_Utility)}(this,function(t,e,o,r){function a(){o.call(this)}return a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype._class+=" map_OpenStreet",a.prototype._copyrightText="© OpenStreetMap contributors",a.prototype.publish("tileProvider","OpenStreetMap","set","Tile Provider",["OpenStreetMap","OpenStreetMap Hot","MapQuest","MapQuest Sat","Stamen Watercolor","OpenCycleMap"],{tags:["Basic","Shared"]}),a.prototype.layerEnter=function(t,e,a){o.prototype.layerEnter.apply(this,arguments),this._tile=r.Tile(),this._openStreetTransform=e.append("g"),this._openStreet=this._openStreetTransform.append("g"),this._copyright=e.append("text").attr("x",-100).attr("y",-100).style("opacity",.5).text(this._copyrightText),this._copyrightBBox=this._copyright.node().getBBox()},a.prototype.layerUpdate=function(t){this.visible()?this._copyright.attr("x",t.width()-this._copyrightBBox.width-this._copyrightBBox.height/2).attr("y",t.height()-this._copyrightBBox.height/2).text(this._copyrightText):this._copyright.text("")},a.prototype.layerZoomed=function(t){var e=[];if(this.visible()){var o=t.project(-85,180);(!o||o[0]<=0||o[1]<=0)&&(o=[t.width(),t.height()]),this._tile.size([Math.min(t.width(),o[0]),Math.min(t.height(),o[1])]).scale(4096*t._zoom.scale()).translate(t._zoom.translate()),e=this._tile(),this._openStreetTransform.attr("transform","scale("+e.scale+")translate("+e.translate+")")}this._prevTileProvider!==this.tileProvider()&&(this._openStreet.selectAll("image").remove(),this._prevTileProvider=this.tileProvider());var r=this,a=this._openStreet.selectAll("image").data(e,function(t){return t[2]+"/"+t[0]+"/"+t[1]});a.enter().append("image").attr("xlink:href",function(t){switch(r.tileProvider()){case"OpenStreetMap Hot":return"http://"+["a","b","c"][3*Math.random()|0]+".tile.openstreetmap.fr/hot/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"MapQuest":return"http://otile"+["1","2","3","4"][4*Math.random()|0]+".mqcdn.com/tiles/1.0.0/osm/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"MapQuest Sat":return"http://otile"+["1","2","3","4"][4*Math.random()|0]+".mqcdn.com/tiles/1.0.0/sat/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"Stamen Watercolor":return"http://"+["a","b","c"][3*Math.random()|0]+".tile.stamen.com/watercolor/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"OpenCycleMap":return"http://"+["a","b"][2*Math.random()|0]+".tile.opencyclemap.org/cycle/"+t[2]+"/"+t[0]+"/"+t[1]+".png";default:return"http://"+["a","b","c"][3*Math.random()|0]+".tile.openstreetmap.org/"+t[2]+"/"+t[0]+"/"+t[1]+".png"}}).attr("width",1).attr("height",1).attr("x",function(t){return t[0]}).attr("y",function(t){return t[1]}).style("opacity",0).transition().duration(500).style("opacity",1),a.exit().remove()},a}),function(t,e){"function"==typeof define&&define.amd?define("src/map/TestHeatMap",["../layout/Layered","../layout/AbsoluteSurface","./ChoroplethStates","../other/HeatMap"],e):t.map_TestHeatMap=e(t.layout_Layered,t.layout_AbsoluteSurface,t.map_ChoroplethStates,t.other_HeatMap)}(this,function(t,e,o,r){function a(e){t.call(this)}return a.prototype=Object.create(t.prototype),a.prototype.constructor=a,a.prototype._class+=" map_TestHeatMap",a}),function(t,e){"function"==typeof define&&define.amd?define("src/map/TopoJSONChoropleth",["d3","topojson","./Choropleth","../common/Utility","require"],e):t.map_TopoJSONChoropleth=e(t.d3,t.topojson,t.map_Choropleth,t.common_Utility,t.require)}(this,function(t,e,o,r,a){function n(){o.call(this),this.projection("mercator")}return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_TopoJSONChoropleth",n.prototype.publish("region","GB","set","Region Data",["AT","BE","BG","CHLI","CY","CZ","DE","DK","EE","ES","FI","FR","GB","GE","GR","HR","HU","IE","IS","IT","KS","LT","LU","LV","MD","MK","MT","ND","NL","NO","PL","PT","RO","RS","SE","SI","SK","UA"]),n.prototype.layerEnter=function(e,a,n){o.prototype.layerEnter.apply(this,arguments),this._selection=new r.SimpleSelection(this._choroplethData),this.choroPaths=t.select(null)},n.prototype.layerUpdate=function(t){var r=this;return new Promise(function(n,i){r._prevRegion!==r.region()?(r._prevRegion=r.region(),a(["json!src/map/TopoJSON/"+r.region()+".json"],function(i){function s(e){r._choroTopologyIndex=e,o.prototype.layerUpdate.call(r,t,!0),n()}r._choroTopology=i,r._choroTopologyObjects=i.objects.PolbndA,r._choroTopologyFeatures=e.feature(r._choroTopology,r._choroTopologyObjects).features,a(["json!src/map/TopoJSON/"+r.region()+"_idx.json"],s,function(t){s({})})})):(o.prototype.layerUpdate.call(r,t),n())}).then(function(){var e=[];r.data().forEach(function(t){if(isNaN(t[0]))for(var o in r._choroTopologyIndex)for(var a in r._choroTopologyIndex[o])a===t[0]&&r._choroTopologyIndex[o][a].forEach(function(o){e.push([o].concat(t.filter(function(t,e){return e>0})))});else e.push(t)}),r.choroPaths=r._choroplethData.selectAll(".data").data(r.visible()?e:[],function(t){return t[0]}),r.choroPaths.enter().append("path").attr("class","data").call(r._selection.enter.bind(r._selection)).on("click",function(t){r._dataMap[t[0]]&&r.click(r.rowToObj(r._dataMap[t[0]]),"weight",r._selection.selected(r))}).on("mouseover.tooltip",function(t){r.tooltipShow([t[0],t[1]],r.columns(),1)}).on("mouseout.tooltip",function(t){r.tooltipShow()}).on("mousemove.tooltip",function(t){r.tooltipShow([t[0],t[1]],r.columns(),1)}),r.choroPaths.attr("d",function(e){var o=t._d3GeoPath(r._choroTopologyFeatures[e[0]]);return o||console.log("Unknown Country:  "+e),o}).style("fill",function(t){var e=r._palette(t[1],r._dataMinWeight,r._dataMaxWeight);return e}),r.choroPaths.exit().remove()})},n}),function(t){var e=document,o="appendChild",r="styleSheet",a=e.createElement("style");a.type="text/css",e.getElementsByTagName("head")[0][o](a),a[r]?a[r].cssText=t:a[o](e.createTextNode(t))}(".map_Layered .background{fill:#fff}.map_Layered .raster image{fill:#b5d0d0}.map_Layered .hash path{fill:none;stroke:red;stroke-linejoin:round}.map_Layered .checkerFill{fill:red;stroke:red;opacity:.5}.map_Layered .checkerNoFill{fill:none;stroke:none;opacity:.5}.map_Layered .mesh{fill:none;stroke:#6d6e71}.map_Layered .data.selected{stroke-width:1.25px;stroke:red}.map_Layered .data.selected.over{stroke:red}.map_GMap .marker{fill:#656565;stroke:none;stroke-width:1px}.map_GMap .map_Layered{pointer-events:auto;cursor:auto}.gm-style img{max-width:none}.gm-style label{width:auto;display:inline}.map_Layered .data{stroke:none}.map_Layered .data.over{stroke:orange}.map_Layered .marker{fill:#656565;stroke:none;stroke-width:1px}.map_Layered .dataEdge{stroke:#000;fill:none}.map_Layered .graticule,.map_Layered .graticuleOutline{fill:none;stroke:#a9a9a9;stroke-linejoin:round}.map_Layered .graticuleOutline{stroke:#000}.map_Heat{//pointer-events:none}.map_Heat canvas{pointer-events:none}.map_OpenStreet .background{fill:#fff}.map_OpenStreet .graticule{fill:none;stroke:#777;stroke-width:.5px;stroke-opacity:.5}.map_Layered .vector{fill:none;stroke:navy;stroke-linejoin:round}"),define("hpcc-viz-map",function(){});