// (c) 2008 David Troy

!function(t,e){"function"==typeof define&&define.amd?define("map/Utility.js",["d3"],e):t.map_Utility=e(t.d3)}(this,function(t){function e(){}e.prototype.constructor=e,e.prototype._class+=" map_Geohash",e.prototype.base32="0123456789bcdefghjkmnpqrstuvwxyz",e.prototype.encode=function(t,e,o){if("undefined"==typeof o){for(var r=1;12>=r;r++){var i=this.encode(t,e,r),n=this.decode(i);if(n.lat===t&&n.lon===e)return i}o=12}if(t=Number(t),e=Number(e),o=Number(o),isNaN(t)||isNaN(e)||isNaN(o))throw new Error("Invalid geohash");for(var a=0,s=0,p=!0,l="",h=-90,c=90,u=-180,d=180;l.length<o;){if(p){var y=(u+d)/2;e>y?(a=2*a+1,u=y):(a=2*a,d=y)}else{var m=(h+c)/2;t>m?(a=2*a+1,h=m):(a=2*a,c=m)}p=!p,5===++s&&(l+=this.base32.charAt(a),s=0,a=0)}return l},e.prototype.decode=function(t){var e=this.bounds(t),o=e.sw.lat,r=e.sw.lon,i=e.ne.lat,n=e.ne.lon,a=(o+i)/2,s=(r+n)/2;return a=a.toFixed(Math.floor(2-Math.log(i-o)/Math.LN10)),s=s.toFixed(Math.floor(2-Math.log(n-r)/Math.LN10)),{lat:Number(a),lon:Number(s)}},e.prototype.bounds=function(t){if(0===t.length)throw new Error("Invalid geohash");t=t.toLowerCase();for(var e=!0,o=-90,r=90,i=-180,n=180,a=0;a<t.length;a++){var s=t.charAt(a),p=this.base32.indexOf(s);if(-1===p)throw new Error("Invalid geohash");for(var l=4;l>=0;l--){var h=p>>l&1;if(e){var c=(i+n)/2;1===h?i=c:n=c}else{var u=(o+r)/2;1===h?o=u:r=u}e=!e}}var d={sw:{lat:o,lon:i},ne:{lat:r,lon:n}};return d},e.prototype.adjacent=function(t,e){if(t=t.toLowerCase(),e=e.toLowerCase(),0===t.length)throw new Error("Invalid geohash");if(-1==="nsew".indexOf(e))throw new Error("Invalid direction");var o={n:["p0r21436x8zb9dcf5h7kjnmqesgutwvy","bc01fg45238967deuvhjyznpkmstqrwx"],s:["14365h7k9dcfesgujnmqp0r2twvyx8zb","238967debc01fg45kmstqrwxuvhjyznp"],e:["bc01fg45238967deuvhjyznpkmstqrwx","p0r21436x8zb9dcf5h7kjnmqesgutwvy"],w:["238967debc01fg45kmstqrwxuvhjyznp","14365h7k9dcfesgujnmqp0r2twvyx8zb"]},r={n:["prxz","bcfguvyz"],s:["028b","0145hjnp"],e:["bcfguvyz","prxz"],w:["0145hjnp","028b"]},i=t.slice(-1),n=t.slice(0,-1),a=t.length%2;return-1!==r[e][a].indexOf(i)&&""!==n&&(n=this.adjacent(n,e)),n+this.base32.charAt(o[e][a].indexOf(i))},e.prototype.neighbours=function(t){return{n:this.adjacent(t,"n"),ne:this.adjacent(this.adjacent(t,"n"),"e"),e:this.adjacent(t,"e"),se:this.adjacent(this.adjacent(t,"s"),"e"),s:this.adjacent(t,"s"),sw:this.adjacent(this.adjacent(t,"s"),"w"),w:this.adjacent(t,"w"),nw:this.adjacent(this.adjacent(t,"n"),"w")}},e.prototype.contained=function(t,e,o,r,i){(isNaN(e)||e>=90)&&(e=89),(isNaN(o)||o>180)&&(o=180),(isNaN(r)||-90>=r)&&(r=-89),(isNaN(t)||-180>t)&&(t=-180),i=i||1;for(var n=this.encode(e,t,i),a=this.encode(e,o,i),s=this.encode(r,o,i),p=n,l=0,h=-1,c=[n,s],u=this.adjacent(n,"e");u!==s;)c.push(u),++l,u===a||h===l?(h=l+1,l=0,u=this.adjacent(p,"s"),p=u):u=this.adjacent(u,"e");return c},e.prototype.calculateWidthDegrees=function(t){var e;e=t%2===0?-1:-.5;var o=180/Math.pow(2,2.5*t+e);return o},e.prototype.width=function(t){var e=t%2;return 180/(2^(5*t+e)/2-1)};var o=function(){function e(){var e=Math.max(Math.log(r)/Math.LN2-8,0),a=Math.round(e+n),s=Math.pow(2,e-a+8),p=[(i[0]-r/2)/s,(i[1]-r/2)/s],l=[],h=t.range(Math.max(0,Math.floor(-p[0])),Math.max(0,Math.ceil(o[0]/s-p[0]))),c=t.range(Math.max(0,Math.floor(-p[1])),Math.max(0,Math.ceil(o[1]/s-p[1])));return c.forEach(function(t){h.forEach(function(e){l.push([e,t,a])})}),l.translate=p,l.scale=s,l}var o=[960,500],r=256,i=[o[0]/2,o[1]/2],n=0;return e.size=function(t){return arguments.length?(o=t,e):o},e.scale=function(t){return arguments.length?(r=t,e):r},e.translate=function(t){return arguments.length?(i=t,e):i},e.zoomDelta=function(t){return arguments.length?(n=+t,e):n},e},r=function(){function e(t){var e=t[0],s=t[1];return o=null,r(e,s),o||(i(e,s),o)||(n(e,s),o)||(a(e,s),o),o}var o,r,i,n,a,s=1e-6,p=t.geo.albers(),l=t.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),h=t.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c=t.geo.conicEqualArea().rotate([66,0]).center([0,18]).parallels([8,18]),u={point:function(t,e){o=[t,e]}};return e.invert=function(t){var e=p.scale(),o=p.translate(),r=(t[0]-o[0])/e,i=(t[1]-o[1])/e;return(i>=.12&&.234>i&&r>=-.425&&-.214>r?l:i>=.166&&.234>i&&r>=-.214&&-.115>r?h:i>=.204&&.234>i&&r>=.32&&.38>r?c:p).invert(t)},e.stream=function(t){var e=p.stream(t),o=l.stream(t),r=h.stream(t),i=c.stream(t);return{point:function(t,n){e.point(t,n),o.point(t,n),r.point(t,n),i.point(t,n)},sphere:function(){e.sphere(),o.sphere(),r.sphere(),i.sphere()},lineStart:function(){e.lineStart(),o.lineStart(),r.lineStart(),i.lineStart()},lineEnd:function(){e.lineEnd(),o.lineEnd(),r.lineEnd(),i.lineEnd()},polygonStart:function(){e.polygonStart(),o.polygonStart(),r.polygonStart(),i.polygonStart()},polygonEnd:function(){e.polygonEnd(),o.polygonEnd(),r.polygonEnd(),i.polygonEnd()}}},e.precision=function(t){return arguments.length?(p.precision(t),l.precision(t),h.precision(t),c.precision(t),e):p.precision()},e.scale=function(t){return arguments.length?(p.scale(t),l.scale(.35*t),h.scale(t),c.scale(t),e.translate(p.translate())):p.scale()},e.translate=function(t){if(!arguments.length)return p.translate();var o=p.scale(),d=+t[0],y=+t[1];return r=p.translate(t).clipExtent([[d-.455*o,y-.238*o],[d+.455*o,y+.238*o]]).stream(u).point,i=l.translate([d-.307*o,y+.201*o]).clipExtent([[d-.425*o+s,y+.12*o+s],[d-.214*o-s,y+.234*o-s]]).stream(u).point,n=h.translate([d-.205*o,y+.212*o]).clipExtent([[d-.214*o+s,y+.166*o+s],[d-.115*o-s,y+.234*o-s]]).stream(u).point,a=c.translate([d+.35*o,y+.224*o]).clipExtent([[d+.32*o,y+.204*o],[d+.38*o,y+.234*o]]).stream(u).point,e},e.scale(1070)};return t.geo.albersUsaPr||(t.geo.albersUsaPr=r),{Geohash:e,Tile:o,albersUsaPr:r}}),"function"==typeof define&&define.amd&&define("css",[],function(){return{load:function(t,e,o){o()}}}),function(t,e){"function"==typeof define&&define.amd?define("map/Layered.js",["d3","topojson","../common/SVGWidget","./Utility","css!./Layered"],e):t.map_Layered=e(t.d3,t.topojson,t.common_SVGWidget,t.map_Utility)}(this,function(t,e,o,r){function i(){o.call(this),this._drawStartPos="origin",this.projection("mercator");var e=this;this._zoom=t.behavior.zoom().scaleExtent([.25*n,131072*n]).on("zoomstart",function(t){e._zoomstart_translate=e._zoom.translate(),e._zoomstart_scale=e._zoom.scale()}).on("zoom",function(){if(t.event&&t.event.sourceEvent&&t.event.sourceEvent.ctrlKey&&"mousemove"===t.event.sourceEvent.type)return void e.render();e.zoomed();var o=e.width()/2,r=e.height()/2,i=e.invert(o,r);e.centerLong(i[0]),e.centerLat(i[1]),e.zoom(e._zoom.scale()/n),e._prevCenterLong=e.centerLong(),e._prevCenterLat=e.centerLat(),e._prevZoom=e.zoom()}).on("zoomend",function(){})}var n=.25,a=2048/Math.PI;return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._class+=" map_Layered",i.prototype.publish("projection",null,"set","Map projection type",["albersUsa","albersUsaPr","azimuthalEqualArea","azimuthalEquidistant","conicEqualArea","conicConformal","conicEquidistant","equirectangular","gnomonic","mercator","orthographic","stereographic","transverseMercator"]),i.prototype.publish("centerLat",0,"number","Center Latitude",null,{tags:["Basic"]}),i.prototype.publish("centerLong",0,"number","Center Longtitude",null,{tags:["Basic"]}),i.prototype.publish("zoom",1,"number","Zoom Level",null,{tags:["Basic"]}),i.prototype.publish("autoScaleMode","all","set","Auto Scale",["none","all"],{tags:["Basic"]}),i.prototype.publish("layers",[],"widgetArray","Layers",null,{render:!1}),i.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);return arguments.length&&(this._autoScaleOnNextRender=!0),e},i.prototype.projection_orig=i.prototype.projection,i.prototype.projection=function(e){var o=i.prototype.projection_orig.apply(this,arguments);if(arguments.length){switch(this._d3GeoProjection=t.geo[e]().scale(a).translate([0,0]),e){case"orthographic":this._d3GeoProjection.clipAngle(90).rotate([0,0])}this._d3GeoPath=t.geo.path().projection(this._d3GeoProjection),this._autoScaleOnNextRender=!0}return o},i.prototype.size=function(t){var e=o.prototype.size.apply(this,arguments);return arguments.length&&(delete this._prevCenterLat,delete this._prevCenterLong),e},i.prototype.enter=function(t,e){o.prototype.enter.apply(this,arguments),this._zoomGrab=e.append("rect").attr("class","background"),this._layersTarget=e.append("g").attr("class","layersTarget"),e.call(this._zoom)},i.prototype.update=function(e,r){if(o.prototype.update.apply(this,arguments),this._prevCenterLat!==this.centerLat()||this._prevCenterLong!==this.centerLong()||this._prevZoom!==this.zoom()){var i=t.geo[this.projection()]().scale(this.zoom()*n*a).translate([this.width()/2,this.height()/2]),s=i([this.centerLong(),this.centerLat()])||[this.width()/2,this.height()/2];this._zoom.scale(this.zoom()*n).translate([this.width()-s[0],this.height()-s[1]]),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong(),this._prevZoom=this.zoom()}this._zoomGrab.attr("width",this.width()).attr("height",this.height());var p=this._layersTarget.selectAll(".layerContainer").data(this.layers().filter(function(t){return t.visible()}),function(t){return t.id()}),l=this;p.enter().append("g").attr("id",function(t){return t.id()}).attr("class","layerContainer").each(function(e){e._svgElement=t.select(this),e._domElement=l._parentOverlay.append("div"),e.layerEnter(l,e._svgElement,e._domElement)}),p.each(function(t){t.layerUpdate(l)}),p.exit().each(function(t){t.layerExit(l),t._domElement.remove()}).remove(),p.order(),this.zoomed()},i.prototype.exit=function(t,e){o.prototype.exit.apply(this,arguments)},i.prototype.zoomed=function(){var t=this._layersTarget.selectAll(".layerContainer"),e=this;t.each(function(t){t.layerZoomed(e)})},i.prototype.preRender=function(t){return Promise.all(this.layers().filter(function(t){return t.visible()}).map(function(t){return t.layerPreRender()}))},i.prototype.render=function(t){var e=this;return this.preRender().then(function(){o.prototype.render.call(e,function(o){e._layersTarget&&(e._renderCount&&e._autoScaleOnNextRender||e._prevAutoScaleMode!==e.autoScaleMode())?(e._prevAutoScaleMode=e.autoScaleMode(),e._autoScaleOnNextRender=!1,setTimeout(function(){e.autoScale(),e.autoScale(),t&&t(o)},0)):t&&t(o)})}),this},i.prototype.project=function(t,e){t>=90?t=89:-90>=t&&(t=-89);var o=this._d3GeoProjection([e,t]);return o&&(o[0]*=this._zoom.scale(),o[1]*=this._zoom.scale(),o[0]+=this._zoom.translate()[0],o[1]+=this._zoom.translate()[1]),o},i.prototype.invert=function(t,e){return t-=this._zoom.translate()[0],e-=this._zoom.translate()[1],t/=this._zoom.scale(),e/=this._zoom.scale(),this._d3GeoProjection.invert([t,e])},i.prototype.getBounds=function(){var t=this._layersTarget.node().getBBox();return{x:t.x,y:t.y,width:t.width,height:t.height}},i.prototype.autoScale=function(){switch(this.autoScaleMode()){case"none":return;case"all":this.shrinkToFit(this.getBounds())}},i.prototype.shrinkToFit=function(t){if(t.width&&t.height){var e=this.width(),o=this.height(),r=this._zoom.translate(),i=this._zoom.scale();t.x+=t.width/2,t.y+=t.height/2,r[0]-=t.x-e/2,r[1]-=t.y-o/2;var n=i*Math.min(e/t.width,o/t.height);this._zoom.translate(r).scale(n).event(this._layersTarget)}else console.log("Layered.prototype.shrinkToFit - invalid rect:  "+t)},i}),function(t,e){"function"==typeof define&&define.amd?define("map/Layer.js",["./Layered","../api/ITooltip"],e):t.map_Layer=e(t.map_Layered,t.api_ITooltip)}(this,function(t,e){function o(o){t.call(this),e.call(this)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype._class+=" map_Layer",o.prototype["implements"](e.prototype),o.prototype.layerEnter=function(t,e,o){this._parentOverlay=t._parentOverlay},o.prototype.enter=function(e,o){t.prototype.enter.apply(this,arguments),this._svgElement=this._layersTarget.append("g"),this._domElement=this._parentOverlay.append("div"),this.layerEnter(this,this._svgElement,this._domElement)},o.prototype.layerUpdate=function(t){},o.prototype.update=function(e,o){t.prototype.update.apply(this,arguments),this.layerUpdate(this)},o.prototype.layerExit=function(t){},o.prototype.exit=function(e,o){this.layerExit(this),this._svgElement.remove(),this._domElement.remove(),t.prototype.exit.apply(this,arguments)},o.prototype.layerPreRender=function(t){return Promise.resolve()},o.prototype.render=function(e){var o=this,r=arguments;return this.layerPreRender().then(function(){t.prototype.render.apply(o,r)}),this},o.prototype.layerZoomed=function(t){},o.prototype.zoomed=function(){t.prototype.zoomed.apply(this,arguments),this.layerZoomed(this)},o}),function(t,e){"function"==typeof define&&define.amd?define("map/Choropleth",["d3","topojson","./Layer","../common/Palette","../common/Utility","css!./Choropleth"],e):t.map_Choropleth=e(t.d3,t.topojson,t.map_Layer,t.common_Palette,t.common_Utility)}(this,function(t,e,o,r,i){function n(){o.call(this),i.SimpleSelectionMixin.call(this),this._dataMap={},this._path=t.select(null)}return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_Choropleth",n.prototype.mixin(i.SimpleSelectionMixin),n.prototype._palette=r.rainbow("default"),n.prototype.publish("paletteID","YlOrRd","set","Palette ID",n.prototype._palette["switch"](),{tags:["Basic","Shared"]}),n.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),n.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),n.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),n.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),n.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),n.prototype.publish("internalOnly",!1,"boolean","Internal mesh only"),n.prototype.publish("autoScaleMode","mesh","set","Auto Scale",["none","mesh","data"],{tags:["Basic"],override:!0}),n.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);if(arguments.length){this._dataMap={},this._dataMinWeight=null,this._dataMaxWeight=null;var r=this;this.data().forEach(function(t){r._dataMap[t[0]]=t,(!r._dataMinWeight||t[1]<r._dataMinWeight)&&(r._dataMinWeight=t[1]),(!r._dataMaxWeight||t[1]>r._dataMaxWeight)&&(r._dataMaxWeight=t[1])})}return e},n.prototype.getDataBounds=function(){var t=this._choroplethData.node().getBBox(),e={x:t.x,y:t.y,width:t.width,height:t.height},o=this._zoom.scale();e.x*=o,e.y*=o,e.width*=o,e.height*=o;var r=this._zoom.translate();return e.x+=r[0],e.y+=r[1],e},n.prototype.autoScale=function(){switch(this.autoScaleMode()){case"none":return;case"mesh":this.shrinkToFit(this.getBounds());break;case"data":this.shrinkToFit(this.getDataBounds())}},n.prototype.layerEnter=function(t,e,r){o.prototype.layerEnter.apply(this,arguments),this._choroplethTransform=e,this._choroplethData=this._choroplethTransform.append("g"),this._choropleth=this._choroplethTransform.append("path").attr("class","mesh")},n.prototype.layerUpdate=function(t,r){return o.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this.visible()&&this.meshVisible()?((r||this._prevProjection!==t.projection()||this._prevInternalOnly!==this.internalOnly())&&(this._choropleth.attr("d",t._d3GeoPath(e.mesh(this._choroTopology,this._choroTopologyObjects,this.internalOnly()?function(t,e){return t!==e}:function(t,e){return!0}))),this._prevProjection=t.projection(),this._prevInternalOnly=this.internalOnly()),void this._choroplethTransform.style("opacity",this.opacity()).style("stroke",this.meshColor())):(this._choropleth.attr("d",""),void delete this._prevProjection)},n.prototype.layerExit=function(t){delete this._prevProjection,delete this._prevInternalOnly},n.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this._choroplethTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/t._zoom.scale()+"px")},n.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},n.prototype.dblclick=function(t,e,o){console.log("Double click:  "+JSON.stringify(t)+", "+e+", "+o)},n}),function(t,e){"function"==typeof define&&define.amd?define("map/ChoroplethCountries.js",["d3","topojson","./Choropleth","require"],e):t.map_ChoroplethCountries=e(t.d3,t.topojson,t.map_Choropleth,t.require)}(this,function(t,e,o,r){function i(){o.call(this)}var n=null,a=null,s=null;return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._class+=" map_ChoroplethCountries",i.prototype.layerEnter=function(e,r,i){o.prototype.layerEnter.apply(this,arguments),this._choroTopology=n.topology,this._choroTopologyObjectsCountries=n.topology.objects.countries,this._choroTopologyObjectsLand=n.topology.objects.land,this._choroTopologyObjects=this._choroTopologyObjectsCountries,this._selection.widgetElement(this._choroplethData),this.choroPaths=t.select(null);var a=this;this.tooltipHTML(function(t){return a.tooltipFormat({label:t[0],value:t[1]})})},i.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var e=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){e._dataMap[t[0]]&&e.click(e.rowToObj(e._dataMap[t[0]]),"weight",e._selection.selected(this))}).on("dblclick",function(t){e._dataMap[t[0]]&&e.dblclick(e.rowToObj(e._dataMap[t[0]]),"weight",e._selection.selected(this))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(e){var o=t._d3GeoPath(s[e[0]]);return o||console.log("Unknown Country:  "+e),o}).style("fill",function(t){var o=e._palette(t[1],e._dataMinWeight,e._dataMaxWeight);return o}),this.choroPaths.exit().remove()},i.prototype.layerPreRender=function(){return this._topoJsonPromise||(this._topoJsonPromise=new Promise(function(t,o){n&&t(),r(["json!src/map/TopoJSON/countries.json"],function(o){n=o,a=e.feature(n.topology,n.topology.objects.countries).features,s={};for(var r in a)a[r].id&&n.countryNames[a[r].id]&&(s[n.countryNames[a[r].id].name]=a[r]);t()})})),this._topoJsonPromise},i}),function(t,e){"function"==typeof define&&define.amd?define("map/ChoroplethContinents.js",["d3","topojson","./ChoroplethCountries"],e):t.map_ChoroplethContinents=e(t.d3,t.topojson,t.map_ChoroplethCountries)}(this,function(t,e,o){function r(){o.call(this)}return r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype._class+=" map_ChoroplethContinents",r.prototype.layerEnter=function(t,e,r){o.prototype.layerEnter.apply(this,arguments),this._choroTopologyObjects=this._choroTopologyObjectsLand},r}),function(t,e){"function"==typeof define&&define.amd?define("map/ChoroplethCounties.js",["d3","topojson","./Choropleth","require"],e):t.map_ChoroplethCounties=e(t.d3,t.topojson,t.map_Choropleth,t.require)}(this,function(t,e,o,r){function i(){o.call(this),this.projection("albersUsaPr")}var n=null,a=null,s=null,p=t.format("05d");return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._class+=" map_ChoroplethCounties",i.prototype.publish("onClickFormatFIPS",!1,"boolean","format FIPS code as a String on Click"),i.prototype.layerEnter=function(e,r,i){o.prototype.layerEnter.apply(this,arguments),this._choroTopology=n.topology,this._choroTopologyObjects=n.topology.objects.counties,this._selection.widgetElement(this._choroplethData),this.choroPaths=t.select(null);var a=this;this.tooltipHTML(function(t){return a.tooltipFormat({label:n.countyNames[t[0]],value:a._dataMap[t[0]]?a._dataMap[t[0]][1]:"N/A"})})},i.prototype.layerUpdate=function(t){function e(t){return r.onClickFormatFIPS()?r._dataMap[t[0]].map(function(t,e){return r.onClickFormatFIPS()&&0===e?p(t):t}):r._dataMap[t[0]]}o.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var r=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){r._dataMap[t[0]]&&r.click(r.rowToObj(e(t)),"weight",r._selection.selected(this))}).on("dblclick",function(t){r._dataMap[t[0]]&&r.dblclick(r.rowToObj(e(t)),"weight",r._selection.selected(this))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(e){var o=t._d3GeoPath(s[e[0]]);return o||console.log("Unknown US County:  "+e),o}).style("fill",function(t){var e=r._palette(t[1],r._dataMinWeight,r._dataMaxWeight);return e}),this.choroPaths.exit().remove()},i.prototype.layerPreRender=function(){return this._topoJsonPromise||(this._topoJsonPromise=new Promise(function(t,o){n&&t(),r(["json!src/map/TopoJSON/us-counties.json"],function(o){n=o,a=e.feature(n.topology,n.topology.objects.counties).features,s={};for(var r in a)a[r].id&&(s[a[r].id]=a[r]);t()})})),this._topoJsonPromise},i}),function(t,e){"function"==typeof define&&define.amd?define("map/ChoroplethStates",["d3","topojson","./Choropleth","require"],e):t.map_ChoroplethStates=e(t.d3,t.topojson,t.map_Choropleth,t.require)}(this,function(t,e,o,r){function i(){o.call(this),this.projection("albersUsaPr")}var n=null,a=null,s=null;return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._class+=" map_ChoroplethStates",i.prototype.layerEnter=function(e,r,i){o.prototype.layerEnter.apply(this,arguments),this._choroTopology=n.topology,this._choroTopologyObjects=n.topology.objects.states,this._selection.widgetElement(this._choroplethData),this.choroPaths=t.select(null);var a=this;this.tooltipHTML(function(t){var e=s[t[0]].id;return a.tooltipFormat({label:n.stateNames[e].name,value:t[1]})})},i.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var e=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){e.click(e.rowToObj(t),"weight",e._selection.selected(this))}).on("dblclick",function(t){e.dblclick(e.rowToObj(t),"weight",e._selection.selected(this))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(e){var o=t._d3GeoPath(s[e[0]]);return o||console.log("Unknown US State:  "+e),o}).style("fill",function(t){var o=e._palette(t[1],e._dataMinWeight,e._dataMaxWeight);return o}),this.choroPaths.exit().remove()},i.prototype.layerPreRender=function(){return this._topoJsonPromise||(this._topoJsonPromise=new Promise(function(t,o){n&&t(),r(["json!src/map/TopoJSON/us-states.json"],function(o){n=o,a=e.feature(n.topology,n.topology.objects.states).features,s={};for(var r in a)a[r].id&&(s[n.stateNames[a[r].id].code]=a[r]);t()})})),this._topoJsonPromise},i}),function(t,e){"function"==typeof define&&define.amd?define("map/ChoroplethStatesHeat.js",["../layout/Layered"],e):t.map_ChoroplethStatesHeat=e(t.layout_Layered)}(this,function(t){function e(e){t.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype._class+=" map_ChoroplethStatesHeat",e}),function(t,e){"function"==typeof define&&define.amd?define("map/GeoHash.js",["d3","topojson","./Layer","./Utility","../common/Palette","../common/Utility","css!./GeoHash"],e):t.map_GeoHash=e(t.d3,t.topojson,t.map_Layer,t.map_Utility,t.common_Palette,t.common_Utility)}(this,function(t,e,o,r,i,n){function a(){o.call(this)}return a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype._class+=" map_GeoHash",a.prototype._palette=i.rainbow("default"),a.prototype.publish("paletteID","YlOrRd","set","Palette ID",a.prototype._palette["switch"](),{tags:["Basic","Shared"]}),a.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),a.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),a.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),a.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),a.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),a.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);return arguments.length&&(this._dataMinWeight=null,this._dataMaxWeight=null,this.data().forEach(function(t){(!this._dataMinWeight||t[1]<this._dataMinWeight)&&(this._dataMinWeight=t[1]),(!this._dataMaxWeight||t[1]>this._dataMaxWeight)&&(this._dataMaxWeight=t[1])},this)),e},a.prototype.layerEnter=function(e,i,a){o.prototype.layerEnter.apply(this,arguments),this.geohash=new r.Geohash,this._geoHashTransform=i.append("g"),this._selection=new n.SimpleSelection(this._geoHashTransform),this.geoHashPaths=t.select(null)},a.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this._geoHashTransform.style("opacity",this.opacity()),this.geoHashPaths=this._geoHashTransform.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var e=this;this.geoHashPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){e.click(e.rowToObj(t),"weight",e._selection.selected(this))}).on("dblclick",function(t){e.dblclick(e.rowToObj(t),"weight",e._selection.selected(this))}),this.geoHashPaths.attr("d",function(o){var r=e.geohash.bounds(o[0]),i={type:"LineString",coordinates:[[r.sw.lon,r.ne.lat],[r.ne.lon,r.ne.lat],[r.ne.lon,r.sw.lat],[r.sw.lon,r.sw.lat]]};return t._d3GeoPath(i)}).style("fill",function(t){var o=e._palette(t[1],e._dataMinWeight,e._dataMaxWeight);return o}),this.geoHashPaths.exit().remove()},a.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this._geoHashTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").attr("stroke-width",1.5/t._zoom.scale()+"px")},a.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},a.prototype.dblclick=function(t,e,o){console.log("Double click:  "+JSON.stringify(t)+", "+e+", "+o)},a}),function(t,e){"function"==typeof define&&define.amd?define("map/GMap",["d3","../common/HTMLWidget","../layout/AbsoluteSurface","css!./GMap"],e):t.map_GMap=e(t.d3,t.common_HTMLWidget,t.layout_AbsoluteSurface)}(this,function(t,e,o){function r(t,e,o){function r(t,e,o){google.maps.OverlayView.call(this),this._div=null,this._worldSurface=e,this._viewportSurface=o,this._map=t,this.setMap(t);var r=this;google.maps.event.addListener(t,"bounds_changed",function(){r.draw()}),google.maps.event.addListener(t,"projection_changed",function(){r.draw()}),this._prevWorldMin={x:0,y:0},this._prevWorldMax={x:0,y:0},this._prevMin={x:0,y:0},this._prevMax={x:0,y:0}}return r.prototype=google.maps.OverlayView.prototype,r.prototype.onAdd=function(){this.div=document.createElement("div"),this._viewportSurface.target(this.div).units("pixels");var t=this.getPanes();t.overlayMouseTarget.appendChild(this.div)},r.prototype.draw=function(){var t=this.getProjection();if(t){for(var e=this._map.getBounds(),o=t.fromLatLngToDivPixel(e.getCenter()),r=t.fromLatLngToDivPixel(e.getSouthWest()),i=t.fromLatLngToDivPixel(e.getNorthEast()),n={x:r.x,y:i.y},a={x:i.x,y:r.y},s=t.getWorldWidth();a.x<n.x+100;)a.x+=s;for(;n.x>o.x;)n.x-=s,a.x-=s;(n.x!==this._prevMin.x||n.y!==this._prevMin.y||a.x!==this._prevMax.x||a.y!==this._prevMax.y)&&(this._viewportSurface.widgetX(n.x).widgetY(n.y).widgetWidth(a.x-n.x).widgetHeight(a.y-n.y),this._viewportSurface._renderCount?(this._viewportSurface.render(),this._prevMin=n,this._prevMax=a):this._viewportSurface.lazyRender());for(var p=t.fromLatLngToDivPixel(new google.maps.LatLng(85,-179.9)),l=t.fromLatLngToDivPixel(new google.maps.LatLng(-85,179.9));l.x<p.x+100;)l.x+=s;for(;p.x>o.x;)p.x-=s,l.x-=s;(p.x!==this._prevWorldMin.x||p.y!==this._prevWorldMin.y||l.x!==this._prevWorldMax.x||l.y!==this._prevWorldMax.y)&&(this._worldSurface.widgetX(p.x).widgetY(p.y).widgetWidth(l.x-p.x).widgetHeight(l.y-p.y).render(),this._prevWorldMin=l,this._prevWorldMax=l)}},r.prototype.onRemove=function(){this._viewportSurface.target(null),this._div.parentNode.removeChild(this._div),this._div=null},new r(t,e,o)}function i(){function t(t,e,o){var i=r._overlay.getProjection(),n=i.fromLatLngToDivPixel(new google.maps.LatLng(e,o)),a=i.getWorldWidth(),s=parseFloat(t.widgetX()),p=parseFloat(t.widgetY()),l=parseFloat(t.widgetWidth());for(n.x-=s,n.y-=p;n.x<0;)n.x+=a;for(;n.x>l;)n.x-=a;return n}e.call(this),this._tag="div";var r=this;this._worldSurface=new o,this._worldSurface.project=function(e,o){return t(this,e,o)},this._viewportSurface=new o,this._viewportSurface.project=function(e,o){return t(this,e,o)}}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._class+=" map_GMap",i.prototype.publish("type","road","set","Map Type",["terrain","road","satellite","hybrid"],{tags:["Basic"]}),i.prototype.publish("centerLat",42.877742,"number","Center Latitude",null,{tags:["Basic"]}),i.prototype.publish("centerLong",-97.380979,"number","Center Longtitude",null,{tags:["Basic"]}),i.prototype.publish("centerAddress",null,"string","Address to center map on",null,{tags:["Basic"],optional:!0}),i.prototype.publish("zoom",4,"number","Zoom Level",null,{tags:["Basic"]}),i.prototype.publish("panControl",!0,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("zoomControl",!0,"boolean","Zoom Controls",null,{tags:["Basic"]}),i.prototype.publish("scaleControl",!0,"boolean","Scale Controls",null,{tags:["Basic"]}),i.prototype.publish("mapTypeControl",!1,"boolean","Map Type Controls",null,{tags:["Basic"]}),i.prototype.publish("fullscreenControl",!1,"boolean","Fullscreen Controls",null,{tags:["Basic"]}),i.prototype.publish("streetViewControl",!1,"boolean","StreetView Controls",null,{tags:["Basic"]}),i.prototype.publish("overviewMapControl",!1,"boolean","OverviewMap Controls",null,{tags:["Basic"]}),i.prototype.publish("streetView",!1,"boolean","Streetview",null,{tags:["Basic"]}),i.prototype.publish("googleMapStyles",{},"object","Styling for map colors etc",null,{tags:["Basic"]}),i.prototype.data=function(t){var o=e.prototype.data.apply(this,arguments);return o},i.prototype.getMapType=function(){switch(this.type()){case"terrain":return google.maps.MapTypeId.TERRAIN;case"road":return google.maps.MapTypeId.ROADMAP;case"satellite":return google.maps.MapTypeId.SATELLITE;case"hybrid":return google.maps.MapTypeId.HYBRID;default:return google.maps.MapTypeId.ROADMAP}},i.prototype.getMapOptions=function(){return{panControl:this.panControl(),zoomControl:this.zoomControl(),fullscreenControl:this.fullscreenControl(),mapTypeControl:this.mapTypeControl(),scaleControl:this.scaleControl(),streetViewControl:this.streetViewControl(),overviewMapControl:this.overviewMapControl(),overviewMapControlOptions:{opened:!0},styles:this.googleMapStyles()}},i.prototype.size=function(t){var o=e.prototype.size.apply(this,arguments);return arguments.length&&this._googleMapNode&&(this._googleMapNode.style({width:t.width+"px",height:t.height+"px"}),google.maps.event.trigger(this._googleMap,"resize")),o},i.prototype.enter=function(o,i){e.prototype.enter.apply(this,arguments);var n=this;this._googleGeocoder=new google.maps.Geocoder,this._googleMapNode=i.append("div").style({width:this.width()+"px",height:this.height()+"px"}),this._googleMap=new google.maps.Map(this._googleMapNode.node(),{zoom:this.zoom(),center:new google.maps.LatLng(this.centerLat(),this.centerLong()),
mapTypeId:this.getMapType(),disableDefaultUI:!0}),this._overlay=r(this._googleMap,this._worldSurface,this._viewportSurface),this._googleMap.addListener("center_changed",function(){n.centerLat(n._googleMap.center.lat()),n._prevCenterLat=n.centerLat(),n.centerLong(n._googleMap.center.lng()),n._prevCenterLong=n.centerLong(),n._googleMapPanorama.setPosition({lat:n.centerLat(),lng:n.centerLong()}),n.zoom(n._googleMap.getZoom()),n._prevZoom=n.zoom()}),this._googleMap.addListener("zoom_changed",function(){n.zoom(n._googleMap.zoom),n._prevZoom=n.zoom()}),this._googleMapPanorama=this._googleMap.getStreetView(),this._googleMapPanorama.addListener("visible_changed",function(){n.streetView(n._googleMapPanorama.getVisible()),n._prevStreetView=n.streetView()}),this._circleMap=t.map([]),this._pinMap=t.map([]),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong(),this._prevZoom=this.zoom()},i.prototype.update=function(t,e){var o=this;this._googleMap.setMapTypeId(this.getMapType()),this._googleMap.setOptions(this.getMapOptions()),this.centerAddress_exists()&&this._prevCenterAddress!==this.centerAddress()&&(this._prevCenterAddress=this.centerAddress(),this._googleGeocoder.geocode({address:this.centerAddress()},function(t,e){e===google.maps.GeocoderStatus.OK?o._googleMap.fitBounds(t[0].geometry.bounds):console.error("Geocode was not successful for the following reason: "+e)})),(this._prevCenterLat!==this.centerLat()||this._prevCenterLong!==this.centerLong())&&(this._googleMap.setCenter(new google.maps.LatLng(this.centerLat(),this.centerLong())),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong()),this._prevZoom!==this.zoom()&&(this._googleMap.setZoom(this.zoom()),this._prevZoom=this.zoom()),this.updateCircles(),this.updatePins(),this._prevStreetView!==this.streetView()&&(this.streetView()?(this._googleMapPanorama.setPosition({lat:this.centerLat(),lng:this.centerLong()}),this._googleMapPanorama.setPov({heading:0,pitch:0}),this._googleMapPanorama.setVisible(!0)):this._googleMapPanorama.setVisible(!1),this._prevStreetView=this.streetView())},i.prototype.requireGoogleMap=function(){return this._googleMapPromise||(this._googleMapPromise=new Promise(function(t,e){window.google&&window.google.maps&&t();var o="https:"===window.location.protocol?"https:":"http:",r=r||"AIzaSyDwGn2i1i_pMZvnqYJN1BksD_tjYaCOWKg";require(["async!"+o+"//maps.google.com/maps/api/js?key="+r+"&libraries=drawing,geometry"],function(){t()})})),this._googleMapPromise},i.prototype.render=function(t){var o=this,r=arguments;return this.requireGoogleMap().then(function(){e.prototype.render.apply(o,r)}),this},i.prototype.updateCircles=function(){function e(t){return t[0]+"_"+t[1]}var o=[],r=[],i=t.map(this._circleMap.keys(),function(t){return t});this.data().forEach(function(t){i.remove(e(t)),t[3]&&!this._circleMap.has(e(t))?o.push(t):t[3]&&this._circleMap.has(e(t))?r.push(t):!t[3]&&this._circleMap.has(e(t))&&i.set(e(t),!0)},this),o.forEach(function(t){var o=this.createCircle(t[0],t[1],t[3],"");this._circleMap.set(e(t),o)},this),r.forEach(function(t){},this);var n=this;i.forEach(function(t){n._circleMap.get(t).setMap(null),n._circleMap.remove(t)})},i.prototype.updatePins=function(){function e(t){return t[0]+"_"+t[1]}var o=[],r=[],i=t.map(this._pinMap.keys(),function(t){return t});this.data().forEach(function(t){i.remove(e(t)),t[2]&&!this._pinMap.has(e(t))?o.push(t):t[2]&&this._pinMap.has(e(t))?r.push(t):!t[2]&&this._pinMap.has(e(t))&&i.set(e(t),!0)},this),o.forEach(function(t){var o=this.createMarker(t[0],t[1],t[2],"");this._pinMap.set(e(t),o)},this),r.forEach(function(t){this._pinMap.get(e(t)).setIcon(this.createIcon(t[2]))},this);var n=this;i.forEach(function(t){n._pinMap.get(t).setMap(null),n._pinMap.remove(t)})},i.prototype.createIcon=function(t){return{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z M -2,-30",fillColor:t.fillColor,fillOpacity:t.fillOpacity||.8,scale:.5,strokeColor:t.strokeColor||"black",strokeWeight:.25}},i.prototype.createMarker=function(t,e,o){return new google.maps.Marker({position:new google.maps.LatLng(t,e),animation:google.maps.Animation.DROP,title:o.title||"",icon:this.createIcon(o),map:this._googleMap})},i.prototype.createCircle=function(t,e,o){return new google.maps.Circle({center:new google.maps.LatLng(t,e),radius:16093*o.radius/10,fillColor:o.fillColor||"red",strokeColor:o.strokeColor||o.fillColor||"black",strokeWeight:.5,map:this._googleMap})},i.prototype.zoomTo=function(t){var e=0,o=new google.maps.LatLngBounds;return t.forEach(function(t){var r=new google.maps.LatLng(t[0],t[1]);o.extend(r),++e}),e&&(this._googleMap.setCenter(o.getCenter()),this._googleMap.fitBounds(o),this._googleMap.getZoom()>12&&this._googleMap.setZoom(12)),this},i.prototype.zoomToFit=function(){return this.zoomTo(this.data())},i}),function(t,e){"function"==typeof define&&define.amd?define("map/GMapGraph.js",["./GMap","../graph/Graph","../graph/Edge","../common/Shape"],e):t.map_GMapGraph=e(t.map_GMap,t.graph_Graph,t.graph_Edge,t.common_Shape)}(this,function(t,e,o,r){function i(){t.call(this)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype._class+=" map_GMapGraph",i.prototype.enter=function(){t.prototype.enter.apply(this,arguments);var i=(new e).layout("None"),n=i.render,a=this;i.render=function(){var t=[],e=[],i=null;a.data().forEach(function(n){var s=a._viewportSurface.project(n[0],n[1]),p=(new r).shape("circle").radius(3).data(n).pos(s);t.push(p),i&&e.push((new o).sourceVertex(i).targetVertex(p).targetMarker("arrowHead")),i=p}),this.data({vertices:t,edges:e}),n.apply(this,arguments),this.graphData.nodeValues().forEach(function(t){var e=a._viewportSurface.project(t.data()[0],t.data()[1]);e.x-=a.width()/2,e.y-=a.height()/2,t.move(e)}),this.graphData.edgeValues().forEach(function(t){t.points([])})},this._viewportSurface.widget(i)},i}),function(t,e){"function"==typeof define&&define.amd?define("map/GMapHeat.js",["./GMap","../other/HeatMap"],e):t.map_GMapHeat=e(t.map_GMap,t.other_HeatMap)}(this,function(t,e){function o(){t.call(this)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype._class+=" map_GMapHeat",o.prototype.enter=function(){t.prototype.enter.apply(this,arguments);var o=new e,r=o.render,i=this;o.render=function(){this.data(i.data().map(function(t){var e=i._viewportSurface.project(t[0],t[1]);return[e.x,e.y,t[4]]})),r.apply(this,arguments)},this._viewportSurface.widget(o)},o}),function(t,e){"function"==typeof define&&define.amd?define("map/GMapLayered",["d3","./GMap","../common/SVGWidget"],e):t.map_GMapLayered=e(t.d3,t.map_GMap,t.common_SVGWidget)}(this,function(t,e,o){function r(){o.call(this),this._drawStartPos="origin"}function i(){e.call(this),this._layers=[]}var n=1/16,a=4096;return r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype._class+=" map_Layered map_GMapLayered",r.prototype.enter=function(e,r){o.prototype.enter.apply(this,arguments),this._zoom=t.behavior.zoom().translate([0,0]).scale(1),this._d3GeoProjection=t.geo.mercator().scale(a/2/Math.PI).translate([0,0]),this._d3GeoPath=t.geo.path().projection(this._d3GeoProjection)},r.prototype.update=function(t,e){o.prototype.update.apply(this,arguments),this._hasZoomed=!0,this._hasRendered?this.zoomed():this.fullRender()},r.prototype.preRender=function(t){return Promise.all(this.gmap.layers().filter(function(t){return t.visible()}).map(function(t){return t.layerPreRender()}))},r.prototype.fullRender=function(){if(this._hasZoomed){this._hasRendered=!0,this.size(this.gmap.size());var e=this._element.selectAll(".layerContainer").data(this.gmap.layers().filter(function(t){return t.visible()}),function(t){return t.id()}),o=this;e.enter().append("g").attr("class","layerContainer").each(function(e){var r=t.select(this),i=o._parentOverlay.append("div");e.layerEnter(o,r,i)}),e.each(function(t){t.layerUpdate(o)}),e.exit().each(function(t){t.layerExit(o)}).remove(),this.zoomed()}},r.prototype.zoomed=function(){var t=this.gmap._overlay.getProjection();if(t){var e=new google.maps.LatLng(0,0),o=t.fromLatLngToDivPixel(e),r=parseFloat(this.surface.widgetX()),i=parseFloat(this.surface.widgetY()),a=[o.x-r,o.y-i],s=this.gmap._googleMap.getZoom();this._zoom.scale(n*(1<<s)).translate(a);var p=this._element.selectAll(".layerContainer"),l=this;p.each(function(t){t.layerZoomed(l)})}},r.prototype.projection=function(){return"mercator"},r.prototype.project=function(t,e){var o=this.surface.project(t,e);return[o.x,o.y]},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._class+=" map_GMapLayered",i.prototype.updateCircles=function(){},i.prototype.updatePins=function(){},i.prototype.layers=function(t){return arguments.length?(this._layers=t,this):this._layers},i.prototype.enter=function(){e.prototype.enter.apply(this,arguments),this.layered=new r,this.layered.gmap=this,this.layered.surface=this._viewportSurface,this.layered.surface.widget(this.layered).render()},i.prototype.render=function(t){var o=this,r=e.prototype.render.call(this,function(e){o.layered.preRender().then(function(){o.layered.fullRender(),t&&t(e)})});return r},i}),function(t,e){"function"==typeof define&&define.amd?define("map/Pins.js",["d3","./Layer","./Utility","../common/Palette","../common/Utility","css!./Pins"],e):t.map_Pins=e(t.d3,t.map_Layer,t.map_Utility,t.common_Palette,t.common_Utility)}(this,function(t,e,o,r,i){function n(){e.call(this),i.SimpleSelectionMixin.call(this),this._geohash=new o.Geohash}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype._class+=" map_Pins",n.prototype.mixin(i.SimpleSelectionMixin),n.prototype.publish("geohashColumn",null,"set","Geohash column",function(){return this.columns()},{optional:!0}),n.prototype.publish("tooltipColumn",null,"set","Tooltip column",function(){return this.columns()},{optional:!0}),n.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),n.prototype.publish("fillColor","#00FFDD","html-color","Pin Color",null,{optional:!0}),n.prototype.publish("strokeWidth",.5,"number","Pin Border Thickness (pixels)",null,{tags:["Basic"]}),n.prototype.publish("strokeColor",null,"html-color","Pin Border Color",null,{optional:!0}),n.prototype.publish("fontSize",18,"number","Font Size",null,{tags:["Basic","Shared"]}),n.prototype.publish("fontFamily","Verdana","string","Font Name",null,{tags:["Basic","Shared","Shared"]}),n.prototype.publish("fontColor","#000000","html-color","Font Color",null,{tags:["Basic","Shared"]}),n.prototype.publish("pinType","pin","set","Pin Type",["pin","circle","rectangle","rectangle-pin"],{tags:["Basic"]}),n.prototype.publish("arrowWidth",8,"number","Pin arrow width (pixels)",null,{tags:["Basic"],disable:function(t){return-1===["pin","rectangle-pin"].indexOf(t.pinType())}}),n.prototype.publish("arrowHeight",12,"number","Pin arrow height (pixels)",null,{tags:["Basic"],disable:function(t){return-1===["pin","rectangle-pin"].indexOf(t.pinType())}}),n.prototype.publish("pinWidth",20,"number","Width of pin (pixels)",null,{tags:["Basic"],disable:function(t){return-1===["rectangle","rectangle-pin"].indexOf(t.pinType())}}),n.prototype.publish("pinHeight",20,"number","Height of pin (pixels) (not including arrow)",null,{tags:["Basic"],disable:function(t){return-1===["rectangle","rectangle-pin"].indexOf(t.pinType())}}),n.prototype.publish("cornerRadius",10,"number","Radius of rectangular pin corners (pixels)",null,{tags:["Basic"],disable:function(t){return-1===["rectangle","rectangle-pin"].indexOf(t.pinType())}}),n.prototype.publish("pinRadius",12,"number","Radius of circle (pixels)",null,{tags:["Basic"],disable:function(t){return"circle"!==t.pinType()}}),n.prototype.publish("textBaseline","central","set","Pin text vertical alignment",["auto","use-script","no-change","reset-size","ideographic","alphabetic","hanging","mathematical","central","middle","text-after-edge","text-before-edge","inherit"],{tags:["Basic"]}),n.prototype.pinsData=function(){var t=this._db.fieldByLabel(this.geohashColumn()),e=this._db.fieldByLabel(this.tooltipColumn());return this.data().map(function(o){var r={lat:o[0],"long":o[1],ext:o[2]instanceof Object?o[2]:{},origRow:o};if(t)try{var i=this._geohash.bounds(o[t.idx]);r.lat=(i.ne.lat+i.sw.lat)/2,r["long"]=(i.ne.lon+i.sw.lon)/2}catch(n){}return e&&(r.ext.tooltip=o[e.idx]),r},this)},n.prototype.layerEnter=function(o,r,i){e.prototype.layerEnter.apply(this,arguments),this._pinsTransform=r,this._selection.widgetElement(this._pinsTransform),this.pinsPaths=t.select(null)},n.prototype.layerUpdate=function(t){e.prototype.layerUpdate.apply(this,arguments),this._pinsTransform.style("opacity",this.opacity()),this.pinsPaths=this._pinsTransform.selectAll(".pin").data(this.visible()?this.pinsData():[]);var o=this,r=this.pinsPaths.enter().append("g").attr("class","pin").call(this._selection.enter.bind(this._selection)).on("click",function(t){o.click(o.rowToObj(t.origRow),"geohash",o._selection.selected(this))}).on("dblclick",function(t){o.dblclick(o.rowToObj(t[2].origRow),"geohash",o._selection.selected(this))}).on("mouseover",function(t){o.isIE||this.parentNode.appendChild(this)});r.append("path").attr("class","data").append("title"),r.append("text").attr("text-anchor","middle"),this.pinsPaths.selectAll("text").style("stroke",this.fontColor()).style("fill",this.fontColor()).style("font-size",this.fontSize()).style("font-family",this.fontFamily()).style("dominant-baseline",this.textBaseline()).attr("dx",0).attr("dy",this.pinTextDY()).text(function(t){return t.ext&&t.ext.text?t.ext.text:""});var i=this.svgPinPath();this.pinsPaths.selectAll("path.data").attr("d",i).attr("stroke-width",this.strokeWidth()+"px").style("display",function(e){var o=t.project(e.lat,e["long"]);return o?null:"none"}).style("stroke",function(t){return t.ext&&t.ext.strokeColor?t.ext.strokeColor:o.strokeColor()}).style("fill",function(t){return t.ext&&t.ext.fillColor?t.ext.fillColor:o.fillColor()}),this.pinsPaths.select("title").text(function(t){return t.ext&&t.ext.tooltip?t.ext.tooltip:""}),this.pinsPaths.exit().remove()},n.prototype.layerZoomed=function(t){e.prototype.layerZoomed.apply(this,arguments),this.pinsPaths.attr("transform",function(e){var o=t.project(e.lat,e["long"]);return o||(o=[0,0]),"translate("+o[0]+", "+o[1]+")scale(1)"})},n.prototype.pinTextDY=function(){switch(this.pinType()){case"pin":case"rectangle-pin":return-this.arrowHeight();case"circle":case"rectangle":return 0}},n.prototype.svgPinPath=function(){switch(this.pinType()){case"pin":return this.circlePinPath();case"circle":return this.circlePath();case"rectangle":return this.rectanglePath();case"rectangle-pin":return this.rectanglePinPath()}},n.prototype.rectanglePinPath=function(){var t=this.pinWidth(),e=this.pinHeight(),o=this.cornerRadius(),r=this.arrowHeight(),i=this.arrowWidth(),n=0-t/2,a=0-e+o,s=(t-2*o-i)/2;return"M"+n+","+a+"a"+-o+","+-o+" 0 0 1 "+o+","+-o+"h"+(t+2*-o)+"a"+o+","+o+" 0 0 1 "+o+","+o+"v"+(e+2*-o)+"a"+o+","+o+" 0 0 1 "+-o+","+o+"h"+-s+"l"+-i/2+","+r+"l"+-i/2+","+-r+"h"+-s+"a"+-o+","+-o+" 0 0 1 "+-o+","+-o+"z"},n.prototype.rectanglePath=function(){var t=this.pinWidth(),e=this.pinHeight(),o=this.cornerRadius(),r=-t/2,i=-e/2;return i+=o,"M"+r+","+i+"a"+-o+","+-o+" 0 0 1 "+o+","+-o+"h"+(t+2*-o)+"a"+o+","+o+" 0 0 1 "+o+","+o+"v"+(e+2*-o)+"a"+o+","+o+" 0 0 1 "+-o+","+o+"h"+(-t+2*o)+"a"+-o+","+-o+" 0 0 1 "+-o+","+-o+"z"},n.prototype.circlePinPath=function(){var t=this.arrowHeight(),e=this.arrowWidth(),o=0-e/2,r=0-t,i=e/2,n=t,a=-i,s=-n,p=e+i,l=s,h=e,c=0;return"M"+o+","+r+"c"+a+" "+s+", "+p+" "+l+", "+h+" "+c+"l"+-e/2+","+t+"l"+-e/2+","+-t+"z"},n.prototype.circlePath=function(){var t=this.pinRadius(),e=t/2,o=0,r=t/2,i=t/2;return"M"+e+","+o+"a "+r+" "+i+" 0 1 0 0 0.01 0z"},n.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},n.prototype.dblclick=function(t,e,o){console.log("Double click:  "+JSON.stringify(t)+", "+e+", "+o)},n}),function(t,e){"function"==typeof define&&define.amd?define("map/GMapPin.js",["d3","./GMapLayered","./Pins"],e):t.map_GMapPin=e(t.d3,t.map_GMapLayered,t.map_Pins)}(this,function(t,e,o){function r(t){e.call(this);var r=this;this._pins=(new o).columns(["lat","long","ext"]).on("click",function(t,e,o){r.click(r.rowToObj(t.ext.origRow),"",o)}).on("dblclick",function(t,e,o){r.dblclick(r.rowToObj(t.ext.origRow),"",o)})}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype._class+=" map_GMapPin",r.prototype.publishProxy("pinColor","_pins","fillColor"),r.prototype.publishProxy("pinType","_pins","pinType"),r.prototype.publishProxy("pinWidth","_pins","pinWidth"),r.prototype.publishProxy("pinHeight","_pins","pinHeight"),r.prototype.publishProxy("cornerRadius","_pins","cornerRadius"),r.prototype.publishProxy("pinRadius","_pins","pinRadius"),r.prototype.publishProxy("arrowWidth","_pins","arrowWidth"),r.prototype.publishProxy("arrowHeight","_pins","arrowHeight"),r.prototype.publishProxy("textBaseline","_pins","textBaseline"),r.prototype.publishProxy("strokeWidth","_pins","strokeWidth"),r.prototype.publish("latitudeColumn",null,"set","Latitude",function(){return this.columns()},{optional:!0}),r.prototype.publish("longtitudeColumn",null,"set","Longtitude",function(){return this.columns()},{optional:!0}),r.prototype.publish("colorColumn",null,"set","Color",function(){return this.columns()},{optional:!0}),r.prototype.publish("tooltipColumn",null,"set","Tooltip",function(){return this.columns()},{optional:!0}),r.prototype.pinsData=function(){var t=this.columns();return this._view=this._db.rollupView([this.latitudeColumn(),this.longtitudeColumn()]),this._view.entries().map(function(e){var o=e.values[0].values[0];return[e.key,e.values[0].key,{fillColor:o[t.indexOf(this.colorColumn())],tooltip:o[t.indexOf(this.tooltipColumn())],origRow:o}]},this)},r.prototype.enter=function(t,o){e.prototype.enter.apply(this,arguments),this.layers([this._pins])},r.prototype.update=function(t,o){e.prototype.update.apply(this,arguments),this._pins.data(this.pinsData())},r.prototype.exit=function(t,o){e.prototype.exit.apply(this,arguments)},r.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+","+o)},r.prototype.dblclick=function(t,e,o){console.log("Double click:  "+JSON.stringify(t)+", "+e+","+o)},r}),function(t,e){"function"==typeof define&&define.amd?define("map/Lines.js",["d3","./Layer","css!./Lines"],e):t.map_Graph=e(t.d3,t.map_Layer)}(this,function(t,e){function o(){e.call(this)}return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype._class+=" map_Lines",o.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),o.prototype.data=function(t){var o=e.prototype.data.apply(this,arguments);return arguments.length&&(this.dataEdges=[],t.forEach(function(t){this.dataEdges.push({type:"LineString",coordinates:[[t[1],t[0]],[t[3],t[2]]]})},this)),o},o.prototype.layerEnter=function(o,r,i){e.prototype.layerEnter.apply(this,arguments),r.append("defs").append("marker").attr("class","marker").attr("id",this._id+"_arrowHead").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",16).attr("markerHeight",16).attr("markerUnits","strokeWidth").attr("orient","auto").append("polyline").attr("points","0,0 10,5 0,10 1,5"),this._edgesTransform=r.append("g"),this.edgesPaths=t.select(null)},o.prototype.layerUpdate=function(t){e.prototype.layerUpdate.apply(this,arguments),this._edgesTransform.style("opacity",this.opacity()),this.edgesPaths=this._edgesTransform.selectAll(".dataEdge").data(this.visible()?this.dataEdges:[]),this.edgesPaths.enter().append("path").attr("class","dataEdge").attr("marker-end","url(#"+this._id+"_arrowHead)"),this.edgesPaths.attr("d",t._d3GeoPath),this.edgesPaths.exit().remove()},o.prototype.layerZoomed=function(t){e.prototype.layerZoomed.apply(this,arguments),this._edgesTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",.5/t._zoom.scale()+"px")},o}),function(t,e){"function"==typeof define&&define.amd?define("map/GMapPinLine.js",["d3","./GMapLayered","./Lines","./Pins"],e):t.map_GMapPinLine=e(t.d3,t.map_GMapLayered,t.map_Lines,t.map_Pins)}(this,function(t,e,o,r){function i(t){e.call(this);var i=this;this._lines=new o,this._pins=(new r).columns(["lat","long","ext"]).on("click",function(t,e,o){i.click(i.rowToObj(t.ext.origRow),"",o)}).on("dblclick",function(t,e,o){i.click(i.rowToObj(t.ext.origRow),"",o)})}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._class+=" map_GMapPinLine",i.prototype.publish("fromPinColor","green","color","From Pin Color"),i.prototype.publish("fromLatitudeColumn",null,"set","From Latitude",function(){return this.columns()},{optional:!0}),i.prototype.publish("fromLongtitudeColumn",null,"set","From Longtitude",function(){return this.columns()},{optional:!0}),i.prototype.publish("fromColorColumn",null,"set","From Color",function(){return this.columns()},{optional:!0}),i.prototype.publish("fromTooltipColumn",null,"set","From Tooltip",function(){return this.columns()},{optional:!0}),i.prototype.publish("toPinColor","red","color","To Pin Color"),i.prototype.publish("toLatitudeColumn",null,"set","To Latitude",function(){return this.columns()},{optional:!0}),i.prototype.publish("toLongtitudeColumn",null,"set","To Longtitude",function(){return this.columns()},{optional:!0}),i.prototype.publish("toColorColumn",null,"set","To Color",function(){return this.columns()},{optional:!0}),i.prototype.publish("toTooltipColumn",null,"set","To Tooltip",function(){return this.columns()},{optional:!0}),i.prototype.pinsData=function(){var t=this.columns();this._fromView=this._db.rollupView([this.fromLatitudeColumn(),this.fromLongtitudeColumn()]),this._toView=this._db.rollupView([this.toLatitudeColumn(),this.toLongtitudeColumn()]);var e=this._fromView.entries().map(function(e){var o=e.values[0].values[0];return[e.key,e.values[0].key,{fillColor:o[t.indexOf(this.fromColorColumn())]||this.fromPinColor(),tooltip:o[t.indexOf(this.fromTooltipColumn())],origRow:o}]},this),o=this._toView.entries().map(function(e){var o=e.values[0].values[0];return[e.key,e.values[0].key,{fillColor:o[t.indexOf(this.toColorColumn())]||this.toPinColor(),tooltip:o[t.indexOf(this.toTooltipColumn())],origRow:o}]},this);return e.concat(o)},i.prototype.linesData=function(){return this._linesView=this._db.rollupView([this.fromLatitudeColumn(),this.fromLongtitudeColumn(),this.toLatitudeColumn(),this.toLongtitudeColumn()]),this._linesView.data()},i.prototype.enter=function(t,o){e.prototype.enter.apply(this,arguments),this.layers([this._lines,this._pins])},i.prototype.update=function(t,o){e.prototype.update.apply(this,arguments),this._pins.data(this.pinsData()),this._lines.data(this.linesData())},i.prototype.exit=function(t,o){e.prototype.exit.apply(this,arguments)},i.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+","+o)},i.prototype.dblclick=function(t,e,o){console.log("Double click:  "+JSON.stringify(t)+", "+e+","+o)},i}),function(t,e){"function"==typeof define&&define.amd?define("map/Graph.js",["d3","topojson","./Pins","../graph/Graph","../graph/Edge","../common/Shape","css!./Graph"],e):t.map_Graph=e(t.d3,t.topojson,t.map_Pins,t.graph_Graph,t.graph_Edge,t.common_Shape)}(this,function(t,e,o,r,i,n){function a(){o.call(this)}return a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype._class+=" map_Graph",a.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);if(arguments.length){this.dataEdges=[];var r=null;t.forEach(function(t){r&&this.dataEdges.push({type:"LineString",coordinates:[[r[1],r[0]],[t[1],t[0]]]}),r=t},this)}return e},a.prototype.layerEnter=function(e,r,i){o.prototype.layerEnter.apply(this,arguments),r.append("defs").append("marker").attr("class","marker").attr("id",this._id+"_arrowHead").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",16).attr("markerHeight",16).attr("markerUnits","strokeWidth").attr("orient","auto").append("polyline").attr("points","0,0 10,5 0,10 1,5"),this._edgesTransform=r.append("g"),this.edgesPaths=t.select(null)},a.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this._edgesTransform.style("opacity",this.opacity()),this.edgesPaths=this._edgesTransform.selectAll(".dataEdge").data(this.visible()?this.dataEdges:[]),this.edgesPaths.enter().append("path").attr("class","dataEdge").attr("marker-end","url(#"+this._id+"_arrowHead)"),this.edgesPaths.attr("d",t._d3GeoPath),this.edgesPaths.exit().remove()},a.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this._edgesTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",.5/t._zoom.scale()+"px")},a}),function(t,e){"function"==typeof define&&define.amd?define("map/Graticule.js",["d3","topojson","./Layer","../common/Palette","css!./Graticule"],e):t.map_Graticule=e(t.d3,t.topojson,t.map_Layer,t.common_Palette)}(this,function(t,e,o,r){function i(){o.call(this),this._dataMap={},this._path=t.select(null)}return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._class+=" map_Graticule",i.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),i.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),i.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),i.prototype.layerEnter=function(e,r,i){o.prototype.layerEnter.apply(this,arguments),this._graticule=t.geo.graticule(),this._graticulePath=r.append("path").datum(this._graticule).attr("class","graticule"),this._graticuleOutlinePath=r.append("path").datum(this._graticule.outline).attr("class","graticuleOutline")},i.prototype.layerUpdate=function(t){return this.visible()?(this._prevProjection!==t.projection()&&(this._graticulePath.attr("d",t._d3GeoPath),this._graticuleOutlinePath.attr("d",t._d3GeoPath),this._prevProjection=t.projection()),this._graticulePath.style("stroke",this.meshColor()),void this._graticuleOutlinePath.style("stroke",this.meshColor())):(this._graticulePath.attr("d",""),this._graticuleOutlinePath.attr("d",""),void delete this._prevProjection)},i.prototype.layerExit=function(t){delete this._prevProjection},i.prototype.layerZoomed=function(t){this._graticulePath.style("opacity",this.opacity()).attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/t._zoom.scale()+"px"),this._graticuleOutlinePath.style("opacity",this.opacity()).attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/t._zoom.scale()+"px")},i}),function(t,e){"function"==typeof define&&define.amd?define("map/Heat.js",["d3","topojson","./Layer","../other/HeatMap","../common/Palette","css!./Heat"],e):t.map_Heat=e(t.d3,t.topojson,t.map_Layer,t.other_HeatMap,t.common_Palette)}(this,function(t,e,o,r,i){function n(){o.call(this)}return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" map_Heat",n.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),n.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),n.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),n.prototype.layerEnter=function(t,e,i){o.prototype.layerEnter.apply(this,arguments),this._parentOverlay.style("pointer-events","none"),this._heatTransform=i.style("pointer-events","none").append("div").attr("class",this.classID()).style("width",t.width()+"px").style("height",t.height()+"px"),this.heat=(new r).target(this._heatTransform.node())},n.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this._heatTransform.style("opacity",this.opacity()).style("width",t.width()+"px").style("height",t.height()+"px"),this.heat.resize(t.size()),this.heat.columns(this.columns()).data(this.data().map(function(e){var o=t.project(e[0],e[1]);return[o[0],o[1],e[4]]})).render()},n.prototype.layerExit=function(t){delete this._prevProjection,this.heat.target(null),delete this.heat},n.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this.heat.columns(this.columns()).data(this.visible()?this.data().map(function(e){var o=t.project(e[0],e[1]);return[o[0],o[1],e[4]]}):[]).render()},n}),function(t,e){"function"==typeof define&&define.amd?define("map/IChoropleth.js",["../common/Palette"],e):t.map_IChoropleth=e(t.common_Palette,t.usStates,t.usCounties)}(this,function(t,e,o){function r(){}return r.prototype._palette=t.rainbow("default"),r.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},r}),function(t,e){"function"==typeof define&&define.amd?define("map/OpenStreet.js",["d3","topojson","./Layer","./Utility","css!./OpenStreet"],e):t.map_OpenStreet=e(t.d3,t.topojson,t.map_Layer,t.map_Utility)}(this,function(t,e,o,r){function i(){o.call(this)}return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._class+=" map_OpenStreet",i.prototype._copyrightText="© OpenStreetMap contributors",i.prototype.publish("tileProvider","OpenStreetMap","set","Tile Provider",["OpenStreetMap","OpenStreetMap Hot","MapQuest","MapQuest Sat","Stamen Watercolor","OpenCycleMap"],{tags:["Basic","Shared"]}),i.prototype.layerEnter=function(t,e,i){o.prototype.layerEnter.apply(this,arguments),this._tile=r.Tile(),this._openStreetTransform=e.append("g"),this._openStreet=this._openStreetTransform.append("g"),this._copyright=e.append("text").attr("x",-100).attr("y",-100).style("opacity",.5).text(this._copyrightText),this._copyrightBBox=this._copyright.node().getBBox()},i.prototype.layerUpdate=function(t){this.visible()?this._copyright.attr("x",t.width()-this._copyrightBBox.width-this._copyrightBBox.height/2).attr("y",t.height()-this._copyrightBBox.height/2).text(this._copyrightText):this._copyright.text("")},i.prototype.layerZoomed=function(t){var e=[];if(this.visible()){var o=t.project(-85,180);(!o||o[0]<=0||o[1]<=0)&&(o=[t.width(),t.height()]),this._tile.size([Math.min(t.width(),o[0]),Math.min(t.height(),o[1])]).scale(4096*t._zoom.scale()).translate(t._zoom.translate()),e=this._tile(),this._openStreetTransform.attr("transform","scale("+e.scale+")translate("+e.translate+")")}this._prevTileProvider!==this.tileProvider()&&(this._openStreet.selectAll("image").remove(),this._prevTileProvider=this.tileProvider());var r=this,i=this._openStreet.selectAll("image").data(e,function(t){return t[2]+"/"+t[0]+"/"+t[1]});i.enter().append("image").attr("xlink:href",function(t){switch(r.tileProvider()){case"OpenStreetMap Hot":return"http://"+["a","b","c"][3*Math.random()|0]+".tile.openstreetmap.fr/hot/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"MapQuest":return"http://otile"+["1","2","3","4"][4*Math.random()|0]+".mqcdn.com/tiles/1.0.0/osm/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"MapQuest Sat":return"http://otile"+["1","2","3","4"][4*Math.random()|0]+".mqcdn.com/tiles/1.0.0/sat/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"Stamen Watercolor":return"http://"+["a","b","c"][3*Math.random()|0]+".tile.stamen.com/watercolor/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"OpenCycleMap":return"http://"+["a","b"][2*Math.random()|0]+".tile.opencyclemap.org/cycle/"+t[2]+"/"+t[0]+"/"+t[1]+".png";default:return"http://"+["a","b","c"][3*Math.random()|0]+".tile.openstreetmap.org/"+t[2]+"/"+t[0]+"/"+t[1]+".png"}}).attr("width",1).attr("height",1).attr("x",function(t){return t[0]}).attr("y",function(t){return t[1]}).style("opacity",0).transition().duration(500).style("opacity",1),i.exit().remove()},i}),function(t,e){"function"==typeof define&&define.amd?define("map/TestHeatMap.js",["../layout/Layered","../layout/AbsoluteSurface","./ChoroplethStates","../other/HeatMap"],e):t.map_TestHeatMap=e(t.layout_Layered,t.layout_AbsoluteSurface,t.map_ChoroplethStates,t.other_HeatMap)}(this,function(t,e,o,r){function i(e){t.call(this);
}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype._class+=" map_TestHeatMap",i}),function(t,e){"function"==typeof define&&define.amd?define("map/TopoJSONChoropleth.js",["d3","topojson","./Choropleth","require"],e):t.map_TopoJSONChoropleth=e(t.d3,t.topojson,t.map_Choropleth,t.require)}(this,function(t,e,o,r){function i(){o.call(this),this.projection("mercator")}return i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype._class+=" map_TopoJSONChoropleth",i.prototype.publish("region","GB","set","Region Data",["AT","BE","BG","CHLI","CY","CZ","DE","DK","EE","ES","FI","FR","GB","GE","GR","HR","HU","IE","IS","IT","KS","LT","LU","LV","MD","MK","MT","ND","NL","NO","PL","PT","RO","RS","SE","SI","SK","UA"]),i.prototype.layerEnter=function(e,r,i){o.prototype.layerEnter.apply(this,arguments),this._selection.widgetElement(this._choroplethData),this.choroPaths=t.select(null);var n=this;this.tooltipHTML(function(t){var e=n.columns(),o=e&&e.length?e[0]:"Location",r=t&&t.length?t[t.length-1]:[""];return n.tooltipFormat({label:r[0],series:o,value:t[1]})})},i.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments);var e=[],r=this;this.data().forEach(function(t){if(isNaN(t[0]))for(var o in r._choroTopologyIndex)for(var i in r._choroTopologyIndex[o])i===t[0]&&r._choroTopologyIndex[o][i].forEach(function(o){e.push([o].concat(t.filter(function(t,e){return e>0})).concat([t]))});else e.push(t.concat([t]))}),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?e:[],function(t){return t[0]}),this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){r._dataMap[t[0]]&&r.click(r.rowToObj(r._dataMap[t[0]]),"weight",r._selection.selected(r))}).on("dblclick",function(t){r._dataMap[t[0]]&&r.dblclick(r.rowToObj(r._dataMap[t[0]]),"weight",r._selection.selected(r))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(e){var o=t._d3GeoPath(r._choroTopologyFeatures[e[0]]);return o||console.log("Unknown Country:  "+e),o}).style("fill",function(t){var e=r._palette(t[1],r._dataMinWeight,r._dataMaxWeight);return e}),this.choroPaths.exit().remove()},i.prototype.layerPreRender=function(){if(this._prevRegion!==this.region()&&(this._prevRegion=this.region(),delete this._topoJsonPromise),!this._topoJsonPromise){var t=this;this._topoJsonPromise=new Promise(function(o,i){r(["json!src/map/TopoJSON/"+t.region()+".json"],function(i){function n(e){t._choroTopologyIndex=e,o()}t._choroTopology=i,t._choroTopologyObjects=i.objects.PolbndA,t._choroTopologyFeatures=e.feature(t._choroTopology,t._choroTopologyObjects).features,r(["json!src/map/TopoJSON/"+t.region()+"_idx.json"],n,function(t){n({})})})})}return this._topoJsonPromise},i});