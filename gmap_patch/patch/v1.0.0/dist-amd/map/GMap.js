(function(e,t){typeof define=="function"&&define.amd?define(["d3","../common/SVGWidget","../graph/Graph","./IGMap","async!http://maps.google.com/maps/api/js?sensor=false","css!./GMap"],t):e.map_GMap=t(e.d3,e.common_SVGWidget,e.graph_Graph,e.map_IGMap)})(this,function(e,t,n,r){function i(e){n.call(this),r.call(this)}return i.prototype=Object.create(n.prototype),i.prototype._class+=" map_GMap",i.prototype.implements(r.prototype),i.prototype.enter=function(t,r,i){n.prototype.enter.apply(this,arguments),this._googleMap=new google.maps.Map(e.select(this._target).node(),{zoom:3,center:new google.maps.LatLng(41.850033,-87.6500523),mapTypeId:google.maps.MapTypeId.ROADMAP}),this._gmOverlay=new google.maps.OverlayView;var s=this;this._gmOverlay.onAdd=function(){s.layer=e.select(this.getPanes().overlayLayer).append("div").style("position","absolute").attr("class","gmapLayer"),s.layer.node().appendChild(s._parentElement.node()),s._gmOverlay.draw=function(){var e=s._gmOverlay.getProjection(),t=s._googleMap.getBounds(),n=e.fromLatLngToDivPixel(t.getSouthWest()),r=e.fromLatLngToDivPixel(t.getNorthEast()),i=s.layer.node();i.style.left=n.x+"px",i.style.top=r.y+"px",i.style.width=r.x-n.x+"px",i.style.height=n.y-r.y+"px",s.firstRun?s.calcLatLong(n.x,r.y):(s.firstRun=!0,setTimeout(function(){s.calcLatLong(n.x,r.y),s.zoomToFit()},100))},google.maps.event.addListener(s._googleMap,"center_changed",function(){s._gmOverlay.draw()})},this._gmOverlay.setMap(this._googleMap)},i.prototype.calcLatLong=function(e,t){e+=this.width()/2,t+=this.height()/2;var n=this._gmOverlay.getProjection(),r=this;this.graphData.nodeValues().forEach(function(i){var s=new google.maps.LatLng(i._data.geo_lat,i._data.geo_long);i._data.__viz_markerIcon&&!i._marker&&(i._marker=new google.maps.Marker({position:s,animation:google.maps.Animation.DROP,icon:"http://maps.google.com/mapfiles/ms/icons/"+i._data.__viz_markerIcon,map:r._googleMap})),s=n.fromLatLngToDivPixel(s),s.x-=e,s.y-=t,i.move(s)}),this.graphData.edgeValues().forEach(function(e){e.points([])})},i.prototype.zoomToFit=function(){var e=new google.maps.LatLngBounds;return this.graphData.nodeValues().forEach(function(t){var n=new google.maps.LatLng(t._data.geo_lat,t._data.geo_long);e.extend(n)}),this._googleMap.setCenter(e.getCenter()),this._googleMap.fitBounds(e),this},i});