// (c) 2008 David Troy

(function(e,t){typeof exports=="object"&&typeof module!="undefined"?t(exports):typeof define=="function"&&define.amd?define("topojson",["exports"],t):t(e.topojson=e.topojson||{})})(this,function(e){"use strict";function t(){}function n(e){if(!e)return t;var n,r,i=e.scale[0],s=e.scale[1],o=e.translate[0],u=e.translate[1];return function(e,t){t||(n=r=0),e[0]=(n+=e[0])*i+o,e[1]=(r+=e[1])*s+u}}function r(e){if(!e)return t;var n,r,i=e.scale[0],s=e.scale[1],o=e.translate[0],u=e.translate[1];return function(e,t){t||(n=r=0);var a=Math.round((e[0]-o)/i),f=Math.round((e[1]-u)/s);e[0]=a-n,e[1]=f-r,n=a,r=f}}function i(e,t){var n,r=e.length,i=r-t;while(i<--r)n=e[i],e[i++]=e[r],e[r]=n}function s(e,t){var n=0,r=e.length;while(n<r){var i=n+r>>>1;e[i]<t?n=i+1:r=i}return n}function o(e,t){return t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(t){return u(e,t)})}:u(e,t)}function u(e,t){var n={type:"Feature",id:t.id,properties:t.properties||{},geometry:a(e,t)};return t.id==null&&delete n.id,n}function a(e,t){function o(e,t){t.length&&t.pop();for(var n=s[e<0?~e:e],o=0,u=n.length,a;o<u;++o)t.push(a=n[o].slice()),r(a,o);e<0&&i(t,u)}function u(e){return e=e.slice(),r(e,0),e}function a(e){var t=[];for(var n=0,r=e.length;n<r;++n)o(e[n],t);return t.length<2&&t.push(t[0].slice()),t}function f(e){var t=a(e);while(t.length<4)t.push(t[0].slice());return t}function l(e){return e.map(f)}function c(e){var t=e.type;return t==="GeometryCollection"?{type:t,geometries:e.geometries.map(c)}:t in h?{type:t,coordinates:h[t](e)}:null}var r=n(e.transform),s=e.arcs,h={Point:function(e){return u(e.coordinates)},MultiPoint:function(e){return e.coordinates.map(u)},LineString:function(e){return a(e.arcs)},MultiLineString:function(e){return e.arcs.map(a)},Polygon:function(e){return l(e.arcs)},MultiPolygon:function(e){return e.arcs.map(l)}};return c(t)}function f(e,t){function u(t){var n=e.arcs[t<0?~t:t],r=n[0],i;return e.transform?(i=[0,0],n.forEach(function(e){i[0]+=e[0],i[1]+=e[1]})):i=n[n.length-1],t<0?[i,r]:[r,i]}function a(e,t){for(var r in e){var i=e[r];delete t[i.start],delete i.start,delete i.end,i.forEach(function(e){n[e<0?~e:e]=1}),s.push(i)}}var n={},r={},i={},s=[],o=-1;return t.forEach(function(n,r){var i=e.arcs[n<0?~n:n],s;i.length<3&&!i[1][0]&&!i[1][1]&&(s=t[++o],t[o]=n,t[r]=s)}),t.forEach(function(e){var t=u(e),n=t[0],s=t[1],o,a;if(o=i[n]){delete i[o.end],o.push(e),o.end=s;if(a=r[s]){delete r[a.start];var f=a===o?o:o.concat(a);r[f.start=o.start]=i[f.end=a.end]=f}else r[o.start]=i[o.end]=o}else if(o=r[s]){delete r[o.start],o.unshift(e),o.start=n;if(a=i[n]){delete i[a.end];var l=a===o?o:a.concat(o);r[l.start=a.start]=i[l.end=o.end]=l}else r[o.start]=i[o.end]=o}else o=[e],r[o.start=n]=i[o.end=s]=o}),a(i,r),a(r,i),t.forEach(function(e){n[e<0?~e:e]||s.push([e])}),s}function l(e){return a(e,c.apply(this,arguments))}function c(e,t,n){function i(e){var t=e<0?~e:e;(a[t]||(a[t]=[])).push({i:e,g:l})}function s(e){e.forEach(i)}function o(e){e.forEach(s)}function u(e){e.type==="GeometryCollection"?e.geometries.forEach(u):e.type in c&&(l=e,c[e.type](e.arcs))}var r=[];if(arguments.length>1){var a=[],l,c={LineString:s,MultiLineString:o,Polygon:o,MultiPolygon:function(e){e.forEach(o)}};u(t),a.forEach(arguments.length<3?function(e){r.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&r.push(e[0].i)})}else for(var h=0,p=e.arcs.length;h<p;++h)r.push(h);return{type:"MultiLineString",arcs:f(e,r)}}function h(e){var t=e[0],n=e[1],r=e[2];return Math.abs((t[0]-r[0])*(n[1]-t[1])-(t[0]-n[0])*(r[1]-t[1]))}function p(e){var t=-1,n=e.length,r,i=e[n-1],s=0;while(++t<n)r=i,i=e[t],s+=r[0]*i[1]-r[1]*i[0];return s/2}function d(e){return a(e,v.apply(this,arguments))}function v(e,t){function s(e){e.forEach(function(t){t.forEach(function(t){(n[t=t<0?~t:t]||(n[t]=[])).push(e)})}),r.push(e)}function o(t){return Math.abs(p(a(e,{type:"Polygon",arcs:[t]}).coordinates[0]))}var n={},r=[],i=[];return t.forEach(function(e){e.type==="Polygon"?s(e.arcs):e.type==="MultiPolygon"&&e.arcs.forEach(s)}),r.forEach(function(e){if(!e._){var t=[],r=[e];e._=1,i.push(t);while(e=r.pop())t.push(e),e.forEach(function(e){e.forEach(function(e){n[e<0?~e:e].forEach(function(e){e._||(e._=1,r.push(e))})})})}}),r.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:i.map(function(t){var r=[],i;t.forEach(function(e){e.forEach(function(e){e.forEach(function(e){n[e<0?~e:e].length<2&&r.push(e)})})}),r=f(e,r);if((i=r.length)>1)for(var s=1,u=o(r[0]),a,l;s<i;++s)(a=o(r[s]))>u&&(l=r[0],r[0]=r[s],r[s]=l,u=a);return r})}}function m(e){function r(e,n){e.forEach(function(e){e<0&&(e=~e);var r=t[e];r?r.push(n):t[e]=[n]})}function i(e,t){e.forEach(function(e){r(e,t)})}function o(e,t){e.type==="GeometryCollection"?e.geometries.forEach(function(e){o(e,t)}):e.type in u&&u[e.type](e.arcs,t)}var t={},n=e.map(function(){return[]}),u={LineString:r,MultiLineString:i,Polygon:i,MultiPolygon:function(e,t){e.forEach(function(e){i(e,t)})}};e.forEach(o);for(var a in t)for(var f=t[a],l=f.length,c=0;c<l;++c)for(var h=c+1;h<l;++h){var p=f[c],d=f[h],v;(v=n[p])[a=s(v,d)]!==d&&v.splice(a,0,d),(v=n[d])[a=s(v,p)]!==p&&v.splice(a,0,p)}return n}function g(e,t){return e[1][2]-t[1][2]}function y(){function r(e,n){while(n>0){var r=(n+1>>1)-1,i=t[r];if(g(e,i)>=0)break;t[i._=n]=i,t[e._=n=r]=e}}function i(e,r){for(;;){var i=r+1<<1,s=i-1,o=r,u=t[o];s<n&&g(t[s],u)<0&&(u=t[o=s]),i<n&&g(t[i],u)<0&&(u=t[o=i]);if(o===r)break;t[u._=r]=u,t[e._=r=o]=e}}var e={},t=[],n=0;return e.push=function(e){return r(t[e._=n]=e,n++),n},e.pop=function(){if(n<=0)return;var e=t[0],r;return--n>0&&(r=t[n],i(t[r._=0]=r,0)),e},e.remove=function(e){var s=e._,o;if(t[s]!==e)return;return s!==--n&&(o=t[n],(g(o,e)<0?r:i)(t[o._=s]=o,s)),s},e}function b(e,t){function u(e){o.remove(e),e[1][2]=t(e),o.push(e)}var i=n(e.transform),s=r(e.transform),o=y();return t||(t=h),e.arcs.forEach(function(e){var n=[],r=0,a,f,l,c;for(f=0,l=e.length;f<l;++f)c=e[f],i(e[f]=[c[0],c[1],Infinity],f);for(f=1,l=e.length-1;f<l;++f)a=e.slice(f-1,f+2),a[1][2]=t(a),n.push(a),o.push(a);for(f=0,l=n.length;f<l;++f)a=n[f],a.previous=n[f-1],a.next=n[f+1];while(a=o.pop()){var h=a.previous,p=a.next;a[1][2]<r?a[1][2]=r:r=a[1][2],h&&(h.next=p,h[2]=a[2],u(h)),p&&(p.previous=h,p[0]=a[0],u(p))}e.forEach(s)}),e}var w="1.6.26";e.version=w,e.mesh=l,e.meshArcs=c,e.merge=d,e.mergeArcs=v,e.feature=o,e.neighbors=m,e.presimplify=b}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Utility",["d3"],t):e.map_Utility=t(e.d3)}(this,function(e){function t(){}t.prototype.constructor=t,t.prototype._class+=" map_Geohash",t.prototype.base32="0123456789bcdefghjkmnpqrstuvwxyz",t.prototype.encode=function(e,t,n){if(typeof n=="undefined"){for(var r=1;r<=12;r++){var i=this.encode(e,t,r),s=this.decode(i);if(s.lat===e&&s.lon===t)return i}n=12}e=Number(e),t=Number(t),n=Number(n);if(isNaN(e)||isNaN(t)||isNaN(n))throw new Error("Invalid geohash");var o=0,u=0,a=!0,f="",l=-90,c=90,h=-180,p=180;while(f.length<n){if(a){var d=(h+p)/2;t>d?(o=o*2+1,h=d):(o*=2,p=d)}else{var v=(l+c)/2;e>v?(o=o*2+1,l=v):(o*=2,c=v)}a=!a,++u===5&&(f+=this.base32.charAt(o),u=0,o=0)}return f},t.prototype.decode=function(e){var t=this.bounds(e),n=t.sw.lat,r=t.sw.lon,i=t.ne.lat,s=t.ne.lon,o=(n+i)/2,u=(r+s)/2;return o=o.toFixed(Math.floor(2-Math.log(i-n)/Math.LN10)),u=u.toFixed(Math.floor(2-Math.log(s-r)/Math.LN10)),{lat:Number(o),lon:Number(u)}},t.prototype.bounds=function(e){if(e.length===0)throw new Error("Invalid geohash");e=e.toLowerCase();var t=!0,n=-90,r=90,i=-180,s=180;for(var o=0;o<e.length;o++){var u=e.charAt(o),a=this.base32.indexOf(u);if(a===-1)throw new Error("Invalid geohash");for(var f=4;f>=0;f--){var l=a>>f&1;if(t){var c=(i+s)/2;l===1?i=c:s=c}else{var h=(n+r)/2;l===1?n=h:r=h}t=!t}}var p={sw:{lat:n,lon:i},ne:{lat:r,lon:s}};return p},t.prototype.adjacent=function(e,t){e=e.toLowerCase(),t=t.toLowerCase();if(e.length===0)throw new Error("Invalid geohash");if("nsew".indexOf(t)===-1)throw new Error("Invalid direction");var n={n:["p0r21436x8zb9dcf5h7kjnmqesgutwvy","bc01fg45238967deuvhjyznpkmstqrwx"],s:["14365h7k9dcfesgujnmqp0r2twvyx8zb","238967debc01fg45kmstqrwxuvhjyznp"],e:["bc01fg45238967deuvhjyznpkmstqrwx","p0r21436x8zb9dcf5h7kjnmqesgutwvy"],w:["238967debc01fg45kmstqrwxuvhjyznp","14365h7k9dcfesgujnmqp0r2twvyx8zb"]},r={n:["prxz","bcfguvyz"],s:["028b","0145hjnp"],e:["bcfguvyz","prxz"],w:["0145hjnp","028b"]},i=e.slice(-1),s=e.slice(0,-1),o=e.length%2;return r[t][o].indexOf(i)!==-1&&s!==""&&(s=this.adjacent(s,t)),s+this.base32.charAt(n[t][o].indexOf(i))},t.prototype.neighbours=function(e){return{n:this.adjacent(e,"n"),ne:this.adjacent(this.adjacent(e,"n"),"e"),e:this.adjacent(e,"e"),se:this.adjacent(this.adjacent(e,"s"),"e"),s:this.adjacent(e,"s"),sw:this.adjacent(this.adjacent(e,"s"),"w"),w:this.adjacent(e,"w"),nw:this.adjacent(this.adjacent(e,"n"),"w")}},t.prototype.contained=function(e,t,n,r,i){if(isNaN(t)||t>=90)t=89;if(isNaN(n)||n>180)n=180;if(isNaN(r)||r<=-90)r=-89;if(isNaN(e)||e<-180)e=-180;i=i||1;var s=this.encode(t,e,i),o=this.encode(t,n,i),u=this.encode(r,n,i),a=s,f=0,l=-1,c=[s,u],h=this.adjacent(s,"e");while(h!==u)c.push(h),++f,h===o||l===f?(l=f+1,f=0,h=this.adjacent(a,"s"),a=h):h=this.adjacent(h,"e");return c},t.prototype.calculateWidthDegrees=function(e){var t;e%2===0?t=-1:t=-0.5;var n=180/Math.pow(2,2.5*e+t);return n},t.prototype.width=function(e){var t=e%2;return 180/(2^(5*e+t)/2-1)};var n=function(){function s(){var s=Math.max(Math.log(n)/Math.LN2-8,0),o=Math.round(s+i),u=Math.pow(2,s-o+8),a=[(r[0]-n/2)/u,(r[1]-n/2)/u],f=[],l=e.range(Math.max(0,Math.floor(-a[0])),Math.max(0,Math.ceil(t[0]/u-a[0]))),c=e.range(Math.max(0,Math.floor(-a[1])),Math.max(0,Math.ceil(t[1]/u-a[1])));return c.forEach(function(e){l.forEach(function(t){f.push([t,e,o])})}),f.translate=a,f.scale=u,f}var t=[960,500],n=256,r=[t[0]/2,t[1]/2],i=0;return s.size=function(e){return arguments.length?(t=e,s):t},s.scale=function(e){return arguments.length?(n=e,s):n},s.translate=function(e){return arguments.length?(r=e,s):r},s.zoomDelta=function(e){return arguments.length?(i=+e,s):i},s},r=function(){function h(e){var t=e[0],n=e[1];return o=null,(a(t,n),o)||(f(t,n),o)||(l(t,n),o)||(c(t,n),o),o}var t=1e-6,n=e.geo.albers(),r=e.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),i=e.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s=e.geo.conicEqualArea().rotate([66,0]).center([0,18]).parallels([8,18]),o,u={point:function(e,t){o=[e,t]}},a,f,l,c;return h.invert=function(e){var t=n.scale(),o=n.translate(),u=(e[0]-o[0])/t,a=(e[1]-o[1])/t;return(a>=.12&&a<.234&&u>=-0.425&&u<-0.214?r:a>=.166&&a<.234&&u>=-0.214&&u<-0.115?i:a>=.204&&a<.234&&u>=.32&&u<.38?s:n).invert(e)},h.stream=function(e){var t=n.stream(e),o=r.stream(e),u=i.stream(e),a=s.stream(e);return{point:function(e,n){t.point(e,n),o.point(e,n),u.point(e,n),a.point(e,n)},sphere:function(){t.sphere(),o.sphere(),u.sphere(),a.sphere()},lineStart:function(){t.lineStart(),o.lineStart(),u.lineStart(),a.lineStart()},lineEnd:function(){t.lineEnd(),o.lineEnd(),u.lineEnd(),a.lineEnd()},polygonStart:function(){t.polygonStart(),o.polygonStart(),u.polygonStart(),a.polygonStart()},polygonEnd:function(){t.polygonEnd(),o.polygonEnd(),u.polygonEnd(),a.polygonEnd()}}},h.precision=function(e){return arguments.length?(n.precision(e),r.precision(e),i.precision(e),s.precision(e),h):n.precision()},h.scale=function(e){return arguments.length?(n.scale(e),r.scale(e*.35),i.scale(e),s.scale(e),h.translate(n.translate())):n.scale()},h.translate=function(e){if(!arguments.length)return n.translate();var o=n.scale(),p=+e[0],d=+e[1];return a=n.translate(e).clipExtent([[p-.455*o,d-.238*o],[p+.455*o,d+.238*o]]).stream(u).point,f=r.translate([p-.307*o,d+.201*o]).clipExtent([[p-.425*o+t,d+.12*o+t],[p-.214*o-t,d+.234*o-t]]).stream(u).point,l=i.translate([p-.205*o,d+.212*o]).clipExtent([[p-.214*o+t,d+.166*o+t],[p-.115*o-t,d+.234*o-t]]).stream(u).point,c=s.translate([p+.35*o,d+.224*o]).clipExtent([[p+.32*o,d+.204*o],[p+.38*o,d+.234*o]]).stream(u).point,h},h.scale(1070)};return e.geo.albersUsaPr||(e.geo.albersUsaPr=r),{Geohash:t,Tile:n,albersUsaPr:r}}),define("css!src/map/Layered",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Layered",["d3","topojson","../common/SVGWidget","./Utility","css!./Layered"],t):e.map_Layered=t(e.d3,e.topojson,e.common_SVGWidget,e.map_Utility)}(this,function(e,t,n,r){function o(){n.call(this),this._drawStartPos="origin",this.projection("mercator")}var i=.25,s=2048/Math.PI;return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype._class+=" map_Layered",o.prototype.publish("projection",null,"set","Map projection type",["albersUsa","albersUsaPr","azimuthalEqualArea","azimuthalEquidistant","conicEqualArea","conicConformal","conicEquidistant","equirectangular","gnomonic","mercator","orthographic","stereographic","transverseMercator"]),o.prototype.publish("centerLat",0,"number","Center Latitude",null,{tags:["Basic"]}),o.prototype.publish("centerLong",0,"number","Center Longtitude",null,{tags:["Basic"]}),o.prototype.publish("zoom",1,"number","Zoom Level",null,{tags:["Basic"]}),o.prototype.publish("autoScaleMode","all","set","Auto Scale",["none","all"],{tags:["Basic"]}),o.prototype.publish("layers",[],"widgetArray","Layers"),o.prototype.data=function(e){var t=n.prototype.data.apply(this,arguments);return arguments.length&&(this._autoScaleOnNextRender=!0),t},o.prototype.projection_orig=o.prototype.projection,o.prototype.projection=function(t){var n=o.prototype.projection_orig.apply(this,arguments);if(arguments.length){this._d3GeoProjection=e.geo[t]().scale(s).translate([0,0]);switch(t){case"orthographic":this._d3GeoProjection.clipAngle(90).rotate([0,0])}this._d3GeoPath=e.geo.path().projection(this._d3GeoProjection),this._autoScaleOnNextRender=!0}return n},o.prototype.size=function(e){var t=n.prototype.size.apply(this,arguments);return arguments.length&&(delete this._prevCenterLat,delete this._prevCenterLong),t},o.prototype.enter=function(t,r){n.prototype.enter.apply(this,arguments);var s=this;this._zoom=e.behavior.zoom().scaleExtent([.25*i,131072*i]).on("zoomstart",function(e){s._zoomstart_translate=s._zoom.translate(),s._zoomstart_scale=s._zoom.scale()}).on("zoom",function(){if(e.event&&e.event.sourceEvent&&e.event.sourceEvent.ctrlKey&&e.event.sourceEvent.type==="mousemove"){s.render();return}s.zoomed();var t=s.width()/2,n=s.height()/2,r=s.invert(t,n);s.centerLong(r[0]),s.centerLat(r[1]),s.zoom(s._zoom.scale()/i),s._prevCenterLong=s.centerLong(),s._prevCenterLat=s.centerLat(),s._prevZoom=s.zoom()}).on("zoomend",function(){}),this._zoomGrab=r.append("rect").attr("class","background"),this._layersTarget=r.append("g").attr("class","layersTarget"),r.call(this._zoom)},o.prototype.update=function(t,r){n.prototype.update.apply(this,arguments);if(this._prevCenterLat!==this.centerLat()||this._prevCenterLong!==this.centerLong()||this._prevZoom!==this.zoom()){var o=e.geo[this.projection()]().scale(this.zoom()*i*s).translate([this.width()/2,this.height()/2]),u=o([this.centerLong(),this.centerLat()])||[this.width()/2,this.height()/2];this._zoom.scale(this.zoom()*i).translate([this.width()-u[0],this.height()-u[1]]),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong(),this._prevZoom=this.zoom()}this._zoomGrab.attr("width",this.width()).attr("height",this.height());var a=this._layersTarget.selectAll(".layerContainer").data(this.layers().filter(function(e){return e.visible()}),function(e){return e.id()}),f=this;a.enter().append("g").attr("id",function(e){return e.id()}).attr("class","layerContainer").each(function(t){t._svgElement=e.select(this),t._domElement=f._parentOverlay.append("div"),t.layerEnter(f,t._svgElement,t._domElement)}),a.each(function(e){e.layerUpdate(f)}),a.exit().each(function(e){e.layerExit(f),e._domElement.remove()}).remove(),a.order(),this.zoomed()},o.prototype.exit=function(e,t){n.prototype.enter.apply(this,arguments)},o.prototype.zoomed=function(){var e=this._layersTarget.selectAll(".layerContainer"),t=this;e.each(function(e){e.layerZoomed(t)})},o.prototype.render=function(e){var t=this,r=n.prototype.render.call(this,function(n){t._layersTarget&&(t._renderCount&&t._autoScaleOnNextRender||t._prevAutoScaleMode!==t.autoScaleMode())?(t._prevAutoScaleMode=t.autoScaleMode(),t._autoScaleOnNextRender=!1,setTimeout(function(){t.autoScale(),t.autoScale(),e&&e(n)},0)):e&&e(n)});return r},o.prototype.project=function(e,t){e>=90?e=89:e<=-90&&(e=-89);var n=this._d3GeoProjection([t,e]);return n&&(n[0]*=this._zoom.scale(),n[1]*=this._zoom.scale(),n[0]+=this._zoom.translate()[0],n[1]+=this._zoom.translate()[1]),n},o.prototype.invert=function(e,t){return e-=this._zoom.translate()[0],t-=this._zoom.translate()[1],e/=this._zoom.scale(),t/=this._zoom.scale(),this._d3GeoProjection.invert([e,t])},o.prototype.getBounds=function(){var e=this._layersTarget.node().getBBox();return{x:e.x,y:e.y,width:e.width,height:e.height}},o.prototype.autoScale=function(){switch(this.autoScaleMode()){case"none":return;case"all":this.shrinkToFit(this.getBounds())}},o.prototype.shrinkToFit=function(e){if(e.width&&e.height){var t=this.width(),n=this.height(),r=this._zoom.translate(),i=this._zoom.scale();e.x+=e.width/2,e.y+=e.height/2,r[0]-=e.x-t/2,r[1]-=e.y-n/2;var s=i*Math.min(t/e.width,n/e.height);this._zoom.translate(r).scale(s).event(this._layersTarget)}else console.log("Layered.prototype.shrinkToFit - invalid rect:  "+e)},o}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Layer",["./Layered","../api/ITooltip"],t):e.map_Layer=t(e.map_Layered,e.api_ITooltip)}(this,function(e,t){function n(n){e.call(this),t.call(this)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype._class+=" map_Layer",n.prototype.implements(t.prototype),n.prototype.layerEnter=function(e,t,n){this._parentOverlay=e._parentOverlay},n.prototype.enter=function(t,n){e.prototype.enter.apply(this,arguments),this._svgElement=this._layersTarget.append("g"),this._domElement=this._parentOverlay.append("div"),this.layerEnter(this,this._svgElement,this._domElement)},n.prototype.layerUpdate=function(e){},n.prototype.update=function(t,n){e.prototype.update.apply(this,arguments),this.layerUpdate(this)},n.prototype.layerExit=function(e){},n.prototype.exit=function(t,n){this.layerExit(this),this._svgElement.remove(),this._domElement.remove(),e.prototype.exit.apply(this,arguments)},n.prototype.layerZoomed=function(e){},n.prototype.zoomed=function(){e.prototype.zoomed.apply(this,arguments),this.layerZoomed(this)},n}),define("css!src/map/Choropleth",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Choropleth",["d3","topojson","./Layer","../common/Palette","../common/Utility","css!./Choropleth"],t):e.map_Choropleth=t(e.d3,e.topojson,e.map_Layer,e.common_Palette,e.common_Utility)}(this,function(e,t,n,r,i){function s(){n.call(this),i.SimpleSelectionMixin.call(this),this._dataMap={},this._path=e.select(null)}return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype._class+=" map_Choropleth",s.prototype.mixin(i.SimpleSelectionMixin),s.prototype._palette=r.rainbow("default"),s.prototype.publish("paletteID","YlOrRd","set","Palette ID",s.prototype._palette.switch(),{tags:["Basic","Shared"]}),s.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),s.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),s.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),s.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),s.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),s.prototype.publish("internalOnly",!1,"boolean","Internal mesh only"),s.prototype.publish("autoScaleMode","mesh","set","Auto Scale",["none","mesh","data"],{tags:["Basic"],override:!0}),s.prototype.data=function(e){var t=n.prototype.data.apply(this,arguments);if(arguments.length){this._dataMap={},this._dataMinWeight=null,this._dataMaxWeight=null;var r=this;this.data().forEach(function(e){r._dataMap[e[0]]=e;if(!r._dataMinWeight||e[1]<r._dataMinWeight)r._dataMinWeight=e[1];if(!r._dataMaxWeight||e[1]>r._dataMaxWeight)r._dataMaxWeight=e[1]})}return t},s.prototype.getDataBounds=function(){var e=this._choroplethData.node().getBBox(),t={x:e.x,y:e.y,width:e.width,height:e.height},n=this._zoom.scale();t.x*=n,t.y*=n,t.width*=n,t.height*=n;var r=this._zoom.translate();return t.x+=r[0],t.y+=r[1],t},s.prototype.autoScale=function(){switch(this.autoScaleMode()){case"none":return;case"mesh":this.shrinkToFit(this.getBounds());break;case"data":this.shrinkToFit(this.getDataBounds())}},s.prototype.layerEnter=function(e,t,r){n.prototype.layerEnter.apply(this,arguments),this._choroplethTransform=t,this._choroplethData=this._choroplethTransform.append("g"),this._choropleth=this._choroplethTransform.append("path").attr("class","mesh")},s.prototype.layerUpdate=function(e,r){n.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette.switch(this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id()));if(!this.visible()||!this.meshVisible()){this._choropleth.attr("d",""),delete this._prevProjection;return}if(r||this._prevProjection!==e.projection()||this._prevInternalOnly!==this.internalOnly())this._choropleth.attr("d",e._d3GeoPath(t.mesh(this._choroTopology,this._choroTopologyObjects,this.internalOnly()?function(e,t){return e!==t}:function(e,t){return!0}))),this._prevProjection=e.projection(),this._prevInternalOnly=this.internalOnly();this._choroplethTransform.style("opacity",this.opacity()).style("stroke",this.meshColor())},s.prototype.layerExit=function(e){delete this._prevProjection,delete this._prevInternalOnly},s.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this._choroplethTransform.attr("transform","translate("+e._zoom.translate()+")scale("+e._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/e._zoom.scale()+"px")},s.prototype.click=function(e,t,n){console.log("Click:  "+JSON.stringify(e)+", "+t+", "+n)},s}),function(e,t){typeof define=="function"&&define.amd?define("src/map/ChoroplethContinents",["d3","topojson","./Choropleth","./countries"],t):e.map_ChoroplethContinents=t(e.d3,e.topojson,e.map_Choropleth,e.map_countries)}(this,function(e,t,n,r){function i(){n.call(this),this._choroTopology=r.topology,this._choroTopologyObjects=r.topology.objects.land}return i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype._class+=" map_ChoroplethContinents",i}),function(e,t){typeof define=="function"&&define.amd?define("src/map/ChoroplethCounties",["d3","topojson","./Choropleth","./us-counties"],t):e.map_ChoroplethCounties=t(e.d3,e.topojson,e.map_Choropleth,e.map_usCounties)}(this,function(e,t,n,r){function a(){n.call(this),this.projection("albersUsaPr"),this._choroTopology=r.topology,this._choroTopologyObjects=r.topology.objects.counties}var i=t.feature(r.topology,r.topology.objects.counties).features,s={};for(var o in i)i[o].id&&(s[i[o].id]=i[o]);var u=e.format("05d");return a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype._class+=" map_ChoroplethCounties",a.prototype.publish("onClickFormatFIPS",!1,"boolean","format FIPS code as a String on Click"),a.prototype.layerEnter=function(t,i,s){n.prototype.layerEnter.apply(this,arguments),this._selection.widgetElement(this._choroplethData),this.choroPaths=e.select(null);var o=this;this.tooltipHTML(function(e){return o.tooltipFormat({label:r.countyNames[e[0]],value:o._dataMap[e[0]]?o._dataMap[e[0]][1]:"N/A"})})},a.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?this.data():[],function(e){return e[0]});var t=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(e){if(t._dataMap[e[0]]){var n=t.onClickFormatFIPS()?t._dataMap[e[0]].map(function(e,n){return t.onClickFormatFIPS()&&n===0?u(e):e}):t._dataMap[e[0]];t.click(t.rowToObj(n),"weight",t._selection.selected(this))}}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(t){var n=e._d3GeoPath(s[t[0]]);return n||console.log("Unknown US County:  "+t),n}).style("fill",function(e){var n=t._palette(e[1],t._dataMinWeight,t._dataMaxWeight);return n}),this.choroPaths.exit().remove()},a}),function(e,t){typeof define=="function"&&define.amd?define("src/map/ChoroplethCountries",["d3","topojson","./Choropleth","./countries"],t):e.map_ChoroplethCountries=t(e.d3,e.topojson,e.map_Choropleth,e.map_countries)}(this,function(e,t,n,r){function u(){n.call(this),this._choroTopology=r.topology,this._choroTopologyObjects=r.topology.objects.countries}var i=t.feature(r.topology,r.topology.objects.countries).features,s={};for(var o in i)i[o].id&&r.countryNames[i[o].id]&&(s[r.countryNames[i[o].id].name]=i[o]);return u.prototype=Object.create(n.prototype),u.prototype.constructor=u,u.prototype._class+=" map_ChoroplethCountries",u.prototype.layerEnter=function(t,r,i){n.prototype.layerEnter.apply(this,arguments),this._selection.widgetElement(this._choroplethData),this.choroPaths=e.select(null);var s=this;this.tooltipHTML(function(e){return s.tooltipFormat({label:e[0],value:e[1]})})},u.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?this.data():[],function(e){return e[0]});var t=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(e){t._dataMap[e[0]]&&t.click(t.rowToObj(t._dataMap[e[0]]),"weight",t._selection.selected(this))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(t){var n=e._d3GeoPath(s[t[0]]);return n||console.log("Unknown Country:  "+t),n}).style("fill",function(e){var n=t._palette(e[1],t._dataMinWeight,t._dataMaxWeight);return n}),this.choroPaths.exit().remove()},u}),function(e,t){typeof define=="function"&&define.amd?define("src/map/ChoroplethStates",["d3","topojson","./Choropleth","./us-states"],t):e.map_ChoroplethStates=t(e.d3,e.topojson,e.map_Choropleth,e.map_usStates)}(this,function(e,t,n,r){function u(){n.call(this),this.projection("albersUsaPr"),this._choroTopology=r.topology,this._choroTopologyObjects=r.topology.objects.states}var i=t.feature(r.topology,r.topology.objects.states).features,s={};for(var o in i)i[o].id&&(s[r.stateNames[i[o].id].code]=i[o]);return u.prototype=Object.create(n.prototype),u.prototype.constructor=u,u.prototype._class+=" map_ChoroplethStates",u.prototype.layerEnter=function(t,i,o){n.prototype.layerEnter.apply(this,arguments),this._selection.widgetElement(this._choroplethData),this.choroPaths=e.select(null);var u=this;this.tooltipHTML(function(e){var t=s[e[0]].id;return u.tooltipFormat({label:r.stateNames[t].name,value:e[1]})})},u.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this.choroPaths=this._choroplethData.selectAll(".data").data(this.visible()?this.data():[],function(e){return e[0]});var t=this;this.choroPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(e){t.click(t.rowToObj(e),"weight",t._selection.selected(this))}).on("mouseout.tooltip",this.tooltip.hide).on("mousemove.tooltip",this.tooltip.show),this.choroPaths.attr("d",function(t){var n=e._d3GeoPath(s[t[0]]);return n||console.log("Unknown US State:  "+t),n}).style("fill",function(e){var n=t._palette(e[1],t._dataMinWeight,t._dataMaxWeight);return n}),this.choroPaths.exit().remove()},u}),function(e,t){typeof define=="function"&&define.amd?define("src/map/ChoroplethStatesHeat",["../layout/Layered"],t):e.map_ChoroplethStatesHeat=t(e.layout_Layered)}(this,function(e){function t(t){e.call(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._class+=" map_ChoroplethStatesHeat",t}),define("css!src/map/GeoHash",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/GeoHash",["d3","topojson","./Layer","./Utility","../common/Palette","../common/Utility","css!./GeoHash"],t):e.map_GeoHash=t(e.d3,e.topojson,e.map_Layer,e.map_Utility,e.common_Palette,e.common_Utility)}(this,function(e,t,n,r,i,s){function o(){n.call(this)}return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype._class+=" map_GeoHash",o.prototype._palette=i.rainbow("default"),o.prototype.publish("paletteID","YlOrRd","set","Palette ID",o.prototype._palette.switch(),{tags:["Basic","Shared"]}),o.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),o.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),o.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),o.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),o.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),o.prototype.data=function(e){var t=n.prototype.data.apply(this,arguments);return arguments.length&&(this._dataMinWeight=null,this._dataMaxWeight=null,this.data().forEach(function(e){if(!this._dataMinWeight||e[1]<this._dataMinWeight)this._dataMinWeight=e[1];if(!this._dataMaxWeight||e[1]>this._dataMaxWeight)this._dataMaxWeight=e[1]},this)),t},o.prototype.layerEnter=function(t,i,o){n.prototype.layerEnter.apply(this,arguments),this.geohash=new r.Geohash,this._geoHashTransform=i.append("g"),this._selection=new s.SimpleSelection(this._geoHashTransform),this.geoHashPaths=e.select(null)},o.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette.switch(this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this._geoHashTransform.style("opacity",this.opacity()),this.geoHashPaths=this._geoHashTransform.selectAll(".data").data(this.visible()?this.data():[],function(e){return e[0]});var t=this;this.geoHashPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(e){t.click(t.rowToObj(e),"weight",t._selection.selected(this))}),this.geoHashPaths.attr("d",function(n){var r=t.geohash.bounds(n[0]),i={type:"LineString",coordinates:[[r.sw.lon,r.ne.lat],[r.ne.lon,r.ne.lat],[r.ne.lon,r.sw.lat],[r.sw.lon,r.sw.lat]]};return e._d3GeoPath(i)}).style("fill",function(e){var n=t._palette(e[1],t._dataMinWeight,t._dataMaxWeight);return n}),this.geoHashPaths.exit().remove()},o.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this._geoHashTransform.attr("transform","translate("+e._zoom.translate()+")scale("+e._zoom.scale()+")").attr("stroke-width",1.5/e._zoom.scale()+"px")},o.prototype.click=function(e,t,n){console.log("Click:  "+JSON.stringify(e)+", "+t+", "+n)},o}),define("css!src/map/GMap",[],function(){}),function(e,t){if(typeof define=="function"&&define.amd){var n=window.location.protocol==="https:"?"https:":"http:",r=r||"AIzaSyDwGn2i1i_pMZvnqYJN1BksD_tjYaCOWKg";define("src/map/GMap",["d3","../common/HTMLWidget","../layout/AbsoluteSurface","async!"+n+"//maps.google.com/maps/api/js?key="+r,"css!./GMap"],t)}else e.map_GMap=t(e.d3,e.common_HTMLWidget,e.layout_AbsoluteSurface)}(this,function(e,t,n){function r(e,t,n){google.maps.OverlayView.call(this),this._div=null,this._worldSurface=t,this._viewportSurface=n,this._map=e,this.setMap(e);var r=this;google.maps.event.addListener(e,"bounds_changed",function(){r.draw()}),google.maps.event.addListener(e,"projection_changed",function(){r.draw()}),this._prevWorldMin={x:0,y:0},this._prevWorldMax={x:0,y:0},this._prevMin={x:0,y:0},this._prevMax={x:0,y:0}}function i(){function r(t,n,r){var i=e._overlay.getProjection(),s=i.fromLatLngToDivPixel(new google.maps.LatLng(n,r)),o=i.getWorldWidth(),u=parseFloat(t.widgetX()),a=parseFloat(t.widgetY()),f=parseFloat(t.widgetWidth());s.x-=u,s.y-=a;while(s.x<0)s.x+=o;while(s.x>f)s.x-=o;return s}t.call(this),this._tag="div";var e=this;this._worldSurface=new n,this._worldSurface.project=function(e,t){return r(this,e,t)},this._viewportSurface=new n,this._viewportSurface.project=function(e,t){return r(this,e,t)}}return r.prototype=google.maps.OverlayView.prototype,r.prototype.onAdd=function(){this.div=document.createElement("div"),this._viewportSurface.target(this.div).units("pixels");var e=this.getPanes();e.overlayMouseTarget.appendChild(this.div)},r.prototype.draw=function(){var e=this.getProjection();if(!e)return;var t=this._map.getBounds(),n=e.fromLatLngToDivPixel(t.getCenter()),r=e.fromLatLngToDivPixel(t.getSouthWest()),i=e.fromLatLngToDivPixel(t.getNorthEast()),s={x:r.x,y:i.y},o={x:i.x,y:r.y},u=e.getWorldWidth();while(o.x<s.x+100)o.x+=u;while(s.x>n.x)s.x-=u,o.x-=u;if(s.x!==this._prevMin.x||s.y!==this._prevMin.y||o.x!==this._prevMax.x||o.y!==this._prevMax.y)this._viewportSurface.widgetX(s.x).widgetY(s.y).widgetWidth(o.x-s.x).widgetHeight(o.y-s.y).render(),this._prevMin=s,this._prevMax=o;var a=e.fromLatLngToDivPixel(new google.maps.LatLng(85,-179.9)),f=e.fromLatLngToDivPixel(new google.maps.LatLng(-85,179.9));while(f.x<a.x+100)f.x+=u;while(a.x>n.x)a.x-=u,f.x-=u;if(a.x!==this._prevWorldMin.x||a.y!==this._prevWorldMin.y||f.x!==this._prevWorldMax.x||f.y!==this._prevWorldMax.y)this._worldSurface.widgetX(a.x).widgetY(a.y).widgetWidth(f.x-a.x).widgetHeight(f.y-a.y).render(),this._prevWorldMin=f,this._prevWorldMax=f},r.prototype.onRemove=function(){this._viewportSurface.target(null),this._div.parentNode.removeChild(this._div),this._div=null},i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype._class+=" map_GMap",i.prototype.publish("type","road","set","Map Type",["terrain","road","satellite","hybrid"],{tags:["Basic"]}),i.prototype.publish("centerLat",42.877742,"number","Center Latitude",null,{tags:["Basic"]}),i.prototype.publish("centerLong",-97.380979,"number","Center Longtitude",null,{tags:["Basic"]}),i.prototype.publish("zoom",4,"number","Zoom Level",null,{tags:["Basic"]}),i.prototype.publish("panControl",!0,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("zoomControl",!0,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("mapTypeControl",!1,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("scaleControl",!0,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("streetViewControl",!1,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("overviewMapControl",!1,"boolean","Pan Controls",null,{tags:["Basic"]}),i.prototype.publish("googleMapStyles",{},"object","Styling for map colors etc",null,{tags:["Basic"]}),i.prototype.data=function(e){var n=t.prototype.data.apply(this,arguments);return n},i.prototype.getMapType=function(){switch(this.type()){case"terrain":return google.maps.MapTypeId.TERRAIN;case"road":return google.maps.MapTypeId.ROADMAP;case"satellite":return google.maps.MapTypeId.SATELLITE;case"hybrid":return google.maps.MapTypeId.HYBRID;default:return google.maps.MapTypeId.ROADMAP}},i.prototype.getMapOptions=function(){return{panControl:this.panControl(),zoomControl:this.zoomControl(),mapTypeControl:this.mapTypeControl(),scaleControl:this.scaleControl(),streetViewControl:this.streetViewControl(),overviewMapControl:this.overviewMapControl(),overviewMapControlOptions:{opened:!0},styles:this.googleMapStyles()}},i.prototype.size=function(e){var n=t.prototype.size.apply(this,arguments);return arguments.length&&this._googleMapNode&&(this._googleMapNode.style({width:e.width+"px",height:e.height+"px"}),google.maps.event.trigger(this._googleMap,"resize")),n},i.prototype.enter=function(n,i){t.prototype.enter.apply(this,arguments),this._googleMapNode=i.append("div").style({width:this.width()+"px",height:this.height()+"px"}),this._googleMap=new google.maps.Map(this._googleMapNode.node(),{zoom:this.zoom(),center:new google.maps.LatLng(this.centerLat(),this.centerLong()),mapTypeId:this.getMapType(),disableDefaultUI:!0}),this._overlay=new r(this._googleMap,this._worldSurface,this._viewportSurface),this._circleMap=e.map([]),this._pinMap=e.map([]),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong(),this._prevZoom=this.zoom()},i.prototype.update=function(e,t){this._googleMap.setMapTypeId(this.getMapType()),this._googleMap.setOptions(this.getMapOptions());if(this._prevCenterLat!==this.centerLat()||this._prevCenterLong!==this.centerLong())this._googleMap.setCenter(new google.maps.LatLng(this.centerLat(),this.centerLong())),this._prevCenterLat=this.centerLat(),this._prevCenterLong=this.centerLong();this._prevZoom!==this.zoom()&&(this._googleMap.setZoom(this.zoom()),this._prevZoom=this.zoom()),this.updateCircles(),this.updatePins()},i.prototype.updateCircles=function(){function t(e){return e[0]+"_"+e[1]}var n=[],r=[],i=e.map(this._circleMap.keys(),function(e){return e});this.data().forEach(function(e){i.remove(t(e)),e[3]&&!this._circleMap.has(t(e))?n.push(e):e[3]&&this._circleMap.has(t(e))?r.push(e):!e[3]&&this._circleMap.has(t(e))&&i.set(t(e),!0)},this),n.forEach(function(e){var n=this.createCircle(e[0],e[1],e[3],"");this._circleMap.set(t(e),n)},this),r.forEach(function(e){},this);var s=this;i.forEach(function(e){s._circleMap.get(e).setMap(null),s._circleMap.remove(e)})},i.prototype.updatePins=function(){function t(e){return e[0]+"_"+e[1]}var n=[],r=[],i=e.map(this._pinMap.keys(),function(e){return e});this.data().forEach(function(e){i.remove(t(e)),e[2]&&!this._pinMap.has(t(e))?n.push(e):e[2]&&this._pinMap.has(t(e))?r.push(e):!e[2]&&this._pinMap.has(t(e))&&i.set(t(e),!0)},this),n.forEach(function(e){var n=this.createMarker(e[0],e[1],e[2],"");this._pinMap.set(t(e),n)},this),r.forEach(function(e){this._pinMap.get(t(e)).setIcon(this.createIcon(e[2]))},this);var s=this;i.forEach(function(e){s._pinMap.get(e).setMap(null),s._pinMap.remove(e)})},i.prototype.createIcon=function(e){return{path:"M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z M -2,-30",fillColor:e.fillColor,fillOpacity:e.fillOpacity||.8,scale:.5,strokeColor:e.strokeColor||"black",strokeWeight:.25}},i.prototype.createMarker=function(e,t,n){return new google.maps.Marker({position:new google.maps.LatLng(e,t),animation:google.maps.Animation.DROP,title:n.title||"",icon:this.createIcon(n),map:this._googleMap})},i.prototype.createCircle=function(e,t,n){return new google.maps.Circle({center:new google.maps.LatLng(e,t),radius:16093*n.radius/10,fillColor:n.fillColor||"red",strokeColor:n.strokeColor||n.fillColor||"black",strokeWeight:.5,map:this._googleMap})},i.prototype.zoomTo=function(e){var t=0,n=new google.maps.LatLngBounds;return e.forEach(function(e){var r=new google.maps.LatLng(e[0],e[1]);n.extend(r),++t}),t&&(this._googleMap.setCenter(n.getCenter()),this._googleMap.fitBounds(n),this._googleMap.getZoom()>12&&this._googleMap.setZoom(12)),this},i.prototype.zoomToFit=function(){return this.zoomTo(this.data())},i}),function(e,t){typeof define=="function"&&define.amd?define("src/map/GMapGraph",["./GMap","../graph/Graph","../graph/Edge","../common/Shape"],t):e.map_GMapGraph=t(e.map_GMap,e.graph_Graph,e.graph_Edge,e.common_Shape)}(this,function(e,t,n,r){function i(){e.call(this)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._class+=" map_GMapGraph",i.prototype.enter=function(){e.prototype.enter.apply(this,arguments);var i=(new t).layout("None"),s=i.render,o=this;i.render=function(){var e=[],t=[],i=null;o.data().forEach(function(s){var u=o._viewportSurface.project(s[0],s[1]),a=(new r).shape("circle").radius(3).data(s).pos(u);e.push(a),i&&t.push((new n).sourceVertex(i).targetVertex(a).targetMarker("arrowHead")),i=a}),this.data({vertices:e,edges:t}),s.apply(this,arguments),this.graphData.nodeValues().forEach(function(e){var t=o._viewportSurface.project(e.data()[0],e.data()[1]);t.x-=o.width()/2,t.y-=o.height()/2,e.move(t)}),this.graphData.edgeValues().forEach(function(e){e.points([])})},this._viewportSurface.widget(i)},i}),function(e,t){typeof define=="function"&&define.amd?define("src/map/GMapHeat",["./GMap","../other/HeatMap"],t):e.map_GMapHeat=t(e.map_GMap,e.other_HeatMap)}(this,function(e,t){function n(){e.call(this)}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype._class+=" map_GMapHeat",n.prototype.enter=function(){e.prototype.enter.apply(this,arguments);var n=new t,r=n.render,i=this;n.render=function(){this.data(i.data().map(function(e){var t=i._viewportSurface.project(e[0],e[1]);return[t.x,t.y,e[4]]})),r.apply(this,arguments)},this._viewportSurface.widget(n)},n}),function(e,t){typeof define=="function"&&define.amd?define("src/map/GMapLayered",["d3","./GMap","../common/SVGWidget"],t):e.map_GMapLayered=t(e.d3,e.map_GMap,e.common_SVGWidget)}(this,function(e,t,n){function s(){n.call(this),this._drawStartPos="origin"}function o(){t.call(this),this._layers=[]}var r=1/16,i=4096;return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype._class+=" map_Layered",s.prototype.enter=function(t,r){n.prototype.enter.apply(this,arguments),this._zoom=e.behavior.zoom().translate([0,0]).scale(1),this._d3GeoProjection=e.geo.mercator().scale(i/2/Math.PI).translate([0,0]),this._d3GeoPath=e.geo.path().projection(this._d3GeoProjection)},s.prototype.update=function(e,t){n.prototype.update.apply(this,arguments),this._hasZoomed=!0,this._hasRendered?this.zoomed():this.fullRender()},s.prototype.fullRender=function(){if(!this._hasZoomed)return;this._hasRendered=!0,this.size(this.gmap.size());var t=this._element.selectAll(".layerContainer").data(this.gmap.layers(),function(e){return e.id()}),n=this;t.enter().append("g").attr("class","layerContainer").each(function(t){var r=e.select(this),i=n._parentOverlay.append("div");t.layerEnter(n,r,i)}),t.each(function(e){e.layerUpdate(n)}),t.exit().each(function(e){e.layerExit(n)}).remove(),this.zoomed()},s.prototype.zoomed=function(){var e=this.gmap._overlay.getProjection();if(e){var t=new google.maps.LatLng(0,0),n=e.fromLatLngToDivPixel(t),i=parseFloat(this.surface.widgetX()),s=parseFloat(this.surface.widgetY()),o=[n.x-i,n.y-s],u=this.gmap._googleMap.getZoom();this._zoom.scale(r*(1<<u)).translate(o);var a=this._element.selectAll(".layerContainer"),f=this;a.each(function(e){e.layerZoomed(f)})}},s.prototype.projection=function(){return"mercator"},s.prototype.project=function(e,t){var n=this.surface.project(e,t);return[n.x,n.y]},o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype._class+=" map_GMapLayered",o.prototype.updateCircles=function(){},o.prototype.updatePins=function(){},o.prototype.layers=function(e){return arguments.length?(this._layers=e,this):this._layers},o.prototype.enter=function(){t.prototype.enter.apply(this,arguments),this.layered=new s,this.layered.gmap=this,this.layered.surface=this._viewportSurface,this.layered.surface.widget(this.layered).render()},o.prototype.render=function(e){var n=t.prototype.render.apply(this,arguments);return this.layered.fullRender(),n},o}),define("css!src/map/Pins",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Pins",["d3","./Layer","./Utility","../common/Palette","../common/Utility","css!./Pins"],t):e.map_Pins=t(e.d3,e.map_Layer,e.map_Utility,e.common_Palette,e.common_Utility)}(this,function(e,t,n,r,i){function s(){t.call(this),i.SimpleSelectionMixin.call(this),this._geohash=new n.Geohash}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype._class+=" map_Pins",s.prototype.mixin(i.SimpleSelectionMixin),s.prototype.publish("geohashColumn",null,"set","Geohash column",function(){return this.columns()},{optional:!0}),s.prototype.publish("tooltipColumn",null,"set","Tooltip column",function(){return this.columns()},{optional:!0}),s.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),s.prototype.publish("fillColor","#00FFDD","html-color","Pin Color",null,{optional:!0}),s.prototype.publish("strokeWidth",.5,"number","Pin Border Thickness (pixels)",null,{tags:["Basic"]}),s.prototype.publish("strokeColor","#000000","html-color","Pin Border Color",null,{optional:!0}),s.prototype.publish("fontSize",18,"number","Font Size",null,{tags:["Basic","Shared"]}),s.prototype.publish("fontFamily","Verdana","string","Font Name",null,{tags:["Basic","Shared","Shared"]}),s.prototype.publish("fontColor","#000000","html-color","Font Color",null,{tags:["Basic","Shared"]}),s.prototype.publish("pinType","pin","set","Pin Type",["pin","circle","rectangle","rectangle-pin"],{tags:["Basic"]}),s.prototype.publish("arrowWidth",8,"number","Pin arrow width (pixels)",null,{tags:["Basic"],disable:function(e){return["pin","rectangle-pin"].indexOf(e.pinType())===-1}}),s.prototype.publish("arrowHeight",12,"number","Pin arrow height (pixels)",null,{tags:["Basic"],disable:function(e){return["pin","rectangle-pin"].indexOf(e.pinType())===-1}}),s.prototype.publish("pinWidth",20,"number","Width of pin (pixels)",null,{tags:["Basic"],disable:function(e){return["rectangle","rectangle-pin"].indexOf(e.pinType())===-1}}),s.prototype.publish("pinHeight",20,"number","Height of pin (pixels) (not including arrow)",null,{tags:["Basic"],disable:function(e){return["rectangle","rectangle-pin"].indexOf(e.pinType())===-1}}),s.prototype.publish("cornerRadius",10,"number","Radius of rectangular pin corners (pixels)",null,{tags:["Basic"],disable:function(e){return["rectangle","rectangle-pin"].indexOf(e.pinType())===-1}}),s.prototype.publish("pinRadius",12,"number","Radius of circle (pixels)",null,{tags:["Basic"],disable:function(e){return e.pinType()!=="circle"}}),s.prototype.publish("textBaseline","central","set","Pin text vertical alignment",["auto","use-script","no-change","reset-size","ideographic","alphabetic","hanging","mathematical","central","middle","text-after-edge","text-before-edge","inherit"],{tags:["Basic"]}),s.prototype.pinsData=function(){var e=this._db.fieldByLabel(this.geohashColumn()),t=this._db.fieldByLabel(this.tooltipColumn());return this.data().map(function(n){var r=[n[0],n[1],n[2]instanceof Object?n[2]:{}];r[2].origRow=n;if(e)try{var i=this._geohash.bounds(n[e.idx]);r[0]=(i.ne.lat+i.sw.lat)/2,r[1]=(i.ne.lon+i.sw.lon)/2}catch(s){}return t&&(r[2].tooltip=n[t.idx]),r},this)},s.prototype.layerEnter=function(n,r,i){t.prototype.layerEnter.apply(this,arguments),this._pinsTransform=r,this._selection.widgetElement(this._pinsTransform),this.pinsPaths=e.select(null)},s.prototype.layerUpdate=function(e){t.prototype.layerUpdate.apply(this,arguments),this._pinsTransform.style("opacity",this.opacity()),this.pinsPaths=this._pinsTransform.selectAll(".pin").data(this.visible()?this.pinsData():[],function(e){return e[0]});var n=this,r=this.pinsPaths.enter().append("g").attr("class","pin");r.append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(e){n.click(n.rowToObj(e[2].origRow),"geohash",n._selection.selected(this))}).on("mouseover",function(e){this.parentNode.appendChild(this)}).append("title"),r.append("text").attr("text-anchor","middle"),this.pinsPaths.selectAll("text").style("stroke",this.fontColor()).style("fill",this.fontColor()).style("font-size",this.fontSize()).style("font-family",this.fontFamily()).style("dominant-baseline",this.textBaseline()).attr("dx",0).attr("dy",this.pinTextDY()).text(function(e){return e[2]&&e[2].text?e[2].text:""});var i=this.svgPinPath();this.pinsPaths.selectAll("path.data").attr("d",i).attr("stroke-width",this.strokeWidth()+"px").style("display",function(t){var n=e.project(t[0],t[1]);return n?null:"none"}).style("stroke",function(e){return e[2]&&e[2].strokeColor?e[2].strokeColor:n.strokeColor()}).style("fill",function(e){return e[2]&&e[2].fillColor?e[2].fillColor:n.fillColor()}),this.pinsPaths.select("title").text(function(e){return e[2]&&e[2].tooltip?e[2].tooltip:""}),this.pinsPaths.exit().remove()},s.prototype.layerZoomed=function(e){t.prototype.layerZoomed.apply(this,arguments),this.pinsPaths.attr("transform",function(t){var n=e.project(t[0],t[1]);return n||(n=[0,0]),"translate("+n[0]+", "+n[1]+")scale("+1+")"})},s.prototype.pinTextDY=function(){switch(this.pinType()){case"pin":case"rectangle-pin":return-this.arrowHeight();case"circle":case"rectangle":return 0}},s.prototype.svgPinPath=function(){switch(this.pinType()){case"pin":return this.circlePinPath();case"circle":return this.circlePath();case"rectangle":return this.rectanglePath();case"rectangle-pin":return this.rectanglePinPath()}},s.prototype.rectanglePinPath=function(){var e=this.pinWidth(),t=this.pinHeight(),n=this.cornerRadius(),r=this.arrowHeight(),i=this.arrowWidth(),s=0-e/2,o=0-t+n,u=(e-n*2-i)/2;return"M"+s+","+o+"a"+ -n+","+ -n+" 0 0 1 "+n+","+ -n+"h"+(e+ -n*2)+"a"+n+","+n+" 0 0 1 "+n+","+n+"v"+(t+ -n*2)+"a"+n+","+n+" 0 0 1 "+ -n+","+n+"h"+ -u+"l"+ -i/2+","+r+"l"+ -i/2+","+ -r+"h"+ -u+"a"+ -n+","+ -n+" 0 0 1 "+ -n+","+ -n+"z"},s.prototype.rectanglePath=function(){var e=this.pinWidth(),t=this.pinHeight(),n=this.cornerRadius(),r=-e/2,i=-t/2;return i+=n,"M"+r+","+i+"a"+ -n+","+ -n+" 0 0 1 "+n+","+ -n+"h"+(e+ -n*2)+"a"+n+","+n+" 0 0 1 "+n+","+n+"v"+(t+ -n*2)+"a"+n+","+n+" 0 0 1 "+ -n+","+n+"h"+(-e+n*2)+"a"+ -n+","+ -n+" 0 0 1 "+ -n+","+ -n+"z"},s.prototype.circlePinPath=function(){var e=this.arrowHeight(),t=this.arrowWidth(),n=0-t/2,r=0-e,i=t/2,s=e,o=-i,u=-s,a=t+i,f=u,l=t,c=0;return"M"+n+","+r+"c"+o+" "+u+", "+a+" "+f+", "+l+" "+c+"l"+ -t/2+","+e+"l"+ -t/2+","+ -e+"z"},s.prototype.circlePath=function(){var e=this.pinRadius(),t=e/2,n=0,r=e/2,i=e/2;return"M"+t+","+n+"a "+r+" "+i+" 0 1 0 0 0.01 0"+"z"},s.prototype.click=function(e,t,n){console.log("Click:  "+JSON.stringify(e)+", "+t+", "+n)},s}),function(e,t){typeof define=="function"&&define.amd?define("src/map/GMapPin",["d3","./GMapLayered","./Pins"],t):e.map_GMapPin=t(e.d3,e.map_GMapLayered,e.map_Pins)}(this,function(e,t,n){function r(e){t.call(this);var r=this;this._pins=(new n).columns(["lat","long","ext"]).on("click",function(e,t,n){r.click(r.rowToObj(e.ext.origRow),"",n)})}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype._class+=" map_GMapPin",r.prototype.publishProxy("pinColor","_pins","fillColor"),r.prototype.publishProxy("pinType","_pins","pinType"),r.prototype.publishProxy("pinWidth","_pins","pinWidth"),r.prototype.publishProxy("pinHeight","_pins","pinHeight"),r.prototype.publishProxy("cornerRadius","_pins","cornerRadius"),r.prototype.publishProxy("pinRadius","_pins","pinRadius"),r.prototype.publishProxy("arrowWidth","_pins","arrowWidth"),r.prototype.publishProxy("arrowHeight","_pins","arrowHeight"),r.prototype.publishProxy("textBaseline","_pins","textBaseline"),r.prototype.publishProxy("strokeWidth","_pins","strokeWidth"),r.prototype.publish("latitudeColumn",null,"set","Latitude",function(){return this.columns()},{optional:!0}),r.prototype.publish("longtitudeColumn",null,"set","Longtitude",function(){return this.columns()},{optional:!0}),r.prototype.publish("colorColumn",null,"set","Color",function(){return this.columns()},{optional:!0}),r.prototype.publish("tooltipColumn",null,"set","Tooltip",function(){return this.columns()},{optional:!0}),r.prototype.pinsData=function(){var e=this.columns();return this._view=this._db.rollupView([this.latitudeColumn(),this.longtitudeColumn()]),this._view.entries().map(function(t){var n=t.values[0].values[0];return[t.key,t.values[0].key,{fillColor:n[e.indexOf(this.colorColumn())],tooltip:n[e.indexOf(this.tooltipColumn())],origRow:n}]},this)},r.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this.layers([this._pins])},r.prototype.update=function(e,n){t.prototype.update.apply(this,arguments),this._pins.data(this.pinsData())},r.prototype.exit=function(e,n){t.prototype.exit.apply(this,arguments)},r.prototype.click=function(e,t,n){console.log("Click:  "+JSON.stringify(e)+", "+t+","+n)},r}),define("css!src/map/Lines",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Lines",["d3","./Layer","css!./Lines"],t):e.map_Graph=t(e.d3,e.map_Layer)}(this,function(e,t){function n(){t.call(this)}return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype._class+=" map_Lines",n.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),n.prototype.data=function(e){var n=t.prototype.data.apply(this,arguments);return arguments.length&&(this.dataEdges=[],e.forEach(function(e){this.dataEdges.push({type:"LineString",coordinates:[[e[1],e[0]],[e[3],e[2]]]})},this)),n},n.prototype.layerEnter=function(n,r,i){t.prototype.layerEnter.apply(this,arguments),r.append("defs").append("marker").attr("class","marker").attr("id",this._id+"_arrowHead").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",16).attr("markerHeight",16).attr("markerUnits","strokeWidth").attr("orient","auto").append("polyline").attr("points","0,0 10,5 0,10 1,5"),this._edgesTransform=r.append("g"),this.edgesPaths=e.select(null)},n.prototype.layerUpdate=function(e){t.prototype.layerUpdate.apply(this,arguments),this._edgesTransform.style("opacity",this.opacity()),this.edgesPaths=this._edgesTransform.selectAll(".dataEdge").data(this.visible()?this.dataEdges:[]),this.edgesPaths.enter().append("path").attr("class","dataEdge").attr("marker-end","url(#"+this._id+"_arrowHead)"),this.edgesPaths.attr("d",e._d3GeoPath),this.edgesPaths.exit().remove()},n.prototype.layerZoomed=function(e){t.prototype.layerZoomed.apply(this,arguments),this._edgesTransform.attr("transform","translate("+e._zoom.translate()+")scale("+e._zoom.scale()+")").style("stroke-width",.5/e._zoom.scale()+"px")},n}),function(e,t){typeof define=="function"&&define.amd?define("src/map/GMapPinLine",["d3","./GMapLayered","./Lines","./Pins"],t):e.map_GMapPinLine=t(e.d3,e.map_GMapLayered,e.map_Lines,e.map_Pins)}(this,function(e,t,n,r){function i(e){t.call(this);var i=this;this._lines=new n,this._pins=(new r).columns(["lat","long","ext"]).on("click",function(e,t,n){i.click(i.rowToObj(e.ext.origRow),"",n)})}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype._class+=" map_GMapPinLine",i.prototype.publish("fromPinColor","green","color","From Pin Color"),i.prototype.publish("fromLatitudeColumn",null,"set","From Latitude",function(){return this.columns()},{optional:!0}),i.prototype.publish("fromLongtitudeColumn",null,"set","From Longtitude",function(){return this.columns()},{optional:!0}),i.prototype.publish("fromColorColumn",null,"set","From Color",function(){return this.columns()},{optional:!0}),i.prototype.publish("fromTooltipColumn",null,"set","From Tooltip",function(){return this.columns()},{optional:!0}),i.prototype.publish("toPinColor","red","color","To Pin Color"),i.prototype.publish("toLatitudeColumn",null,"set","To Latitude",function(){return this.columns()},{optional:!0}),i.prototype.publish("toLongtitudeColumn",null,"set","To Longtitude",function(){return this.columns()},{optional:!0}),i.prototype.publish("toColorColumn",null,"set","To Color",function(){return this.columns()},{optional:!0}),i.prototype.publish("toTooltipColumn",null,"set","To Tooltip",function(){return this.columns()},{optional:!0}),i.prototype.pinsData=function(){var e=this.columns();this._fromView=this._db.rollupView([this.fromLatitudeColumn(),this.fromLongtitudeColumn()]),this._toView=this._db.rollupView([this.toLatitudeColumn(),this.toLongtitudeColumn()]);var t=this._fromView.entries().map(function(t){var n=t.values[0].values[0];return[t.key,t.values[0].key,{fillColor:n[e.indexOf(this.fromColorColumn())]||this.fromPinColor(),tooltip:n[e.indexOf(this.fromTooltipColumn())],origRow:n}]},this),n=this._toView.entries().map(function(t){var n=t.values[0].values[0];return[t.key,t.values[0].key,{fillColor:n[e.indexOf(this.toColorColumn())]||this.toPinColor(),tooltip:n[e.indexOf(this.toTooltipColumn())],origRow:n}]},this);return t.concat(n)},i.prototype.linesData=function(){return this._linesView=this._db.rollupView([this.fromLatitudeColumn(),this.fromLongtitudeColumn(),this.toLatitudeColumn(),this.toLongtitudeColumn()]),this._linesView.data()},i.prototype.enter=function(e,n){t.prototype.enter.apply(this,arguments),this.layers([this._lines,this._pins])},i.prototype.update=function(e,n){t.prototype.update.apply(this,arguments),this._pins.data(this.pinsData()),this._lines.data(this.linesData())},i.prototype.exit=function(e,n){t.prototype.exit.apply(this,arguments)},i.prototype.click=function(e,t,n){console.log("Click:  "+JSON.stringify(e)+", "+t+","+n)},i}),define("css!src/map/Graph",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Graph",["d3","topojson","./Pins","../graph/Graph","../graph/Edge","../common/Shape","css!./Graph"],t):e.map_Graph=t(e.d3,e.topojson,e.map_Pins,e.graph_Graph,e.graph_Edge,e.common_Shape)}(this,function(e,t,n,r,i,s){function o(){n.call(this)}return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype._class+=" map_Graph",o.prototype.data=function(e){var t=n.prototype.data.apply(this,arguments);if(arguments.length){this.dataEdges=[];var r=null;e.forEach(function(e){r&&this.dataEdges.push({type:"LineString",coordinates:[[r[1],r[0]],[e[1],e[0]]]}),r=e},this)}return t},o.prototype.layerEnter=function(t,r,i){n.prototype.layerEnter.apply(this,arguments),r.append("defs").append("marker").attr("class","marker").attr("id",this._id+"_arrowHead").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",16).attr("markerHeight",16).attr("markerUnits","strokeWidth").attr("orient","auto").append("polyline").attr("points","0,0 10,5 0,10 1,5"),this._edgesTransform=r.append("g"),this.edgesPaths=e.select(null)},o.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this._edgesTransform.style("opacity",this.opacity()),this.edgesPaths=this._edgesTransform.selectAll(".dataEdge").data(this.visible()?this.dataEdges:[]),this.edgesPaths.enter().append("path").attr("class","dataEdge").attr("marker-end","url(#"+this._id+"_arrowHead)"),this.edgesPaths.attr("d",e._d3GeoPath),this.edgesPaths.exit().remove()},o.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this._edgesTransform.attr("transform","translate("+e._zoom.translate()+")scale("+e._zoom.scale()+")").style("stroke-width",.5/e._zoom.scale()+"px")},o}),define("css!src/map/Graticule",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Graticule",["d3","topojson","./Layer","../common/Palette","css!./Graticule"],t):e.map_Graticule=t(e.d3,e.topojson,e.map_Layer,e.common_Palette)}(this,function(e,t,n,r){function i(){n.call(this),this._dataMap={},this._path=e.select(null)}return i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype._class+=" map_Graticule",i.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),i.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),i.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),i.prototype.layerEnter=function(t,r,i){n.prototype.layerEnter.apply(this,arguments),this._graticule=e.geo.graticule(),this._graticulePath=r.append("path").datum(this._graticule).attr("class","graticule"),this._graticuleOutlinePath=r.append("path").datum(this._graticule.outline).attr("class","graticuleOutline")},i.prototype.layerUpdate=function(e){if(!this.visible()){this._graticulePath.attr("d",""),this._graticuleOutlinePath.attr("d",""),delete this._prevProjection;return}this._prevProjection!==e.projection()&&(this._graticulePath.attr("d",e._d3GeoPath),this._graticuleOutlinePath.attr("d",e._d3GeoPath),this._prevProjection=e.projection()),this._graticulePath.style("stroke",this.meshColor()),this._graticuleOutlinePath.style("stroke",this.meshColor())},i.prototype.layerExit=function(e){delete this._prevProjection},i.prototype.layerZoomed=function(e){this._graticulePath.style("opacity",this.opacity()).attr("transform","translate("+e._zoom.translate()+")scale("+e._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/e._zoom.scale()+"px"),this._graticuleOutlinePath.style("opacity",this.opacity()).attr("transform","translate("+e._zoom.translate()+")scale("+e._zoom.scale()+")").style("stroke-width",this.meshStrokeWidth()/e._zoom.scale()+"px")},i}),define("css!src/map/Heat",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/Heat",["d3","topojson","./Layer","../other/HeatMap","../common/Palette","css!./Heat"],t):e.map_Heat=t(e.d3,e.topojson,e.map_Layer,e.other_HeatMap,e.common_Palette)}(this,function(e,t,n,r,i){function s(){n.call(this)}return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype._class+=" map_Heat",s.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),s.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),s.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),s.prototype.layerEnter=function(e,t,i){n.prototype.layerEnter.apply(this,arguments),this._parentOverlay.style("pointer-events","none"),this._heatTransform=i.style("pointer-events","none").append("div").attr("class",this.classID()).style("width",e.width()+"px").style("height",e.height()+"px"),this.heat=(new r).target(this._heatTransform.node())},s.prototype.layerUpdate=function(e){n.prototype.layerUpdate.apply(this,arguments),this._heatTransform.style("opacity",this.opacity()).style("width",e.width()+"px").style("height",e.height()+"px"),this.heat.resize(e.size()),this.heat.columns(this.columns()).data(this.data().map(function(t){var n=e.project(t[0],t[1]);return[n[0],n[1],t[4]]})).render()},s.prototype.layerExit=function(e){delete this._prevProjection,this.heat.target(null),delete this.heat},s.prototype.layerZoomed=function(e){n.prototype.layerZoomed.apply(this,arguments),this.heat.columns(this.columns()).data(this.visible()?this.data().map(function(t){var n=e.project(t[0],t[1]);return[n[0],n[1],t[4]]}):[]).render()},s}),function(e,t){typeof define=="function"&&define.amd?define("src/map/IChoropleth",["../common/Palette"],t):e.map_IChoropleth=t(e.common_Palette,e.usStates,e.usCounties)}(this,function(e,t,n){function r(){}return r.prototype._palette=e.rainbow("default"),r.prototype.click=function(e,t,n){console.log("Click:  "+JSON.stringify(e)+", "+t+", "+n)},r}),define("css!src/map/OpenStreet",[],function(){}),function(e,t){typeof define=="function"&&define.amd?define("src/map/OpenStreet",["d3","topojson","./Layer","./Utility","css!./OpenStreet"],t):e.map_OpenStreet=t(e.d3,e.topojson,e.map_Layer,e.map_Utility)}(this,function(e,t,n,r){function i(){n.call(this)}return i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype._class+=" map_OpenStreet",i.prototype._copyrightText="© OpenStreetMap contributors",i.prototype.publish("tileProvider","OpenStreetMap","set","Tile Provider",["OpenStreetMap","OpenStreetMap Hot","MapQuest","MapQuest Sat","Stamen Watercolor","OpenCycleMap"],{tags:["Basic","Shared"]}),i.prototype.layerEnter=function(e,t,i){n.prototype.layerEnter.apply(this,arguments),this._tile=r.Tile(),this._openStreetTransform=t.append("g"),this._openStreet=this._openStreetTransform.append("g"),this._copyright=t.append("text").attr("x",-100).attr("y",-100).style("opacity",.5).text(this._copyrightText),this._copyrightBBox=this._copyright.node().getBBox()},i.prototype.layerUpdate=function(e){this.visible()?this._copyright.attr("x",e.width()-this._copyrightBBox.width-this._copyrightBBox.height/2).attr("y",e.height()-this._copyrightBBox.height/2).text(this._copyrightText):this._copyright.text("")},i.prototype.layerZoomed=function(e){var t=[];if(this.visible()){var n=e.project(-85,180);if(!n||n[0]<=0||n[1]<=0)n=[e.width(),e.height()];this._tile.size([Math.min(e.width(),n[0]),Math.min(e.height(),n[1])]).scale(e._zoom.scale()*4096).translate(e._zoom.translate()),t=this._tile(),this._openStreetTransform.attr("transform","scale("+t.scale+")translate("+t.translate+")")}this._prevTileProvider!==this.tileProvider()&&(this._openStreet.selectAll("image").remove(),this._prevTileProvider=this.tileProvider());var r=this,i=this._openStreet.selectAll("image").data(t,function(e){return e[2]+"/"+e[0]+"/"+e[1]});i.enter().append("image").attr("xlink:href",function(e){switch(r.tileProvider()){case"OpenStreetMap Hot":return"http://"+["a","b","c"][Math.random()*3|0]+".tile.openstreetmap.fr/hot/"+e[2]+"/"+e[0]+"/"+e[1]+".png";case"MapQuest":return"http://otile"+["1","2","3","4"][Math.random()*4|0]+".mqcdn.com/tiles/1.0.0/osm/"+e[2]+"/"+e[0]+"/"+e[1]+".png";case"MapQuest Sat":return"http://otile"+["1","2","3","4"][Math.random()*4|0]+".mqcdn.com/tiles/1.0.0/sat/"+e[2]+"/"+e[0]+"/"+e[1]+".png";case"Stamen Watercolor":return"http://"+["a","b","c"][Math.random()*3|0]+".tile.stamen.com/watercolor/"+e[2]+"/"+e[0]+"/"+e[1]+".png";case"OpenCycleMap":return"http://"+["a","b"][Math.random()*2|0]+".tile.opencyclemap.org/cycle/"+e[2]+"/"+e[0]+"/"+e[1]+".png";default:return"http://"+["a","b","c"][Math.random()*3|0]+".tile.openstreetmap.org/"+e[2]+"/"+e[0]+"/"+e[1]+".png"}}).attr("width",1).attr("height",1).attr("x",function(e){return e[0]}).attr("y",function(e){return e[1]}).style("opacity",0).transition().duration(500).style("opacity",1),i.exit().remove()},i}),function(e,t){typeof define=="function"&&define.amd?define("src/map/TestHeatMap",["../layout/Layered","../layout/AbsoluteSurface","./ChoroplethStates","../other/HeatMap"],t):e.map_TestHeatMap=t(e.layout_Layered,e.layout_AbsoluteSurface,e.map_ChoroplethStates,e.other_HeatMap)}(this,function(e,t,n,r){function i(t){e.call(this)}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._class+=" map_TestHeatMap",i}),function(e,t){typeof define=="function"&&define.amd?define("src/map/TopoJSONChoropleth",["d3","topojson","./Choropleth","require"],t):e.map_TopoJSONChoropleth=t(e.d3,e.topojson,e.map_Choropleth,e.require)}(this,function(e,t,n,r){function i(){n.call(this),this.projection("mercator")}return i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype._class+=" map_TopoJSONChoropleth",i.prototype.publish("region","GB","set","Region Data",["AT","BE","BG","CHLI","CY","CZ","DE","DK","EE","ES","FI","FR","GB","GE","GR","HR","HU","IE","IS","IT","KS","LT","LU","LV","MD","MK","MT","ND","NL","NO","PL","PT","RO","RS","SE","SI","SK","UA"]),i.prototype.layerEnter=function(t,r,i){n.prototype.layerEnter.apply(this,arguments),this._selection.widgetElement(this._choroplethData),this.choroPaths=e.select(null)},i.prototype.layerUpdate=function(e){var i=this;return(new Promise(function(s,o){i._prevRegion!==i.region()?(i._prevRegion=i.region(),r(["json!src/map/TopoJSON/"+i.region()+".json"],function(o){function u(t){i._choroTopologyIndex=t,n.prototype.layerUpdate.call(i,e,!0),s()}i._choroTopology=o,i._choroTopologyObjects=o.objects.PolbndA,i._choroTopologyFeatures=t.feature(i._choroTopology,i._choroTopologyObjects).features,r(["json!src/map/TopoJSON/"+i.region()+"_idx.json"],u,function(e){u({})})})):(n.prototype.layerUpdate.call(i,e),s())})).then(function(){var t=[];i.data().forEach(function(e){if(isNaN(e[0]))for(var n in i._choroTopologyIndex)for(var r in i._choroTopologyIndex[n])r===e[0]&&i._choroTopologyIndex[n][r].forEach(function(n){t.push([n].concat(e.filter(function(e,t){return t>0})))});else t.push(e)}),i.choroPaths=i._choroplethData.selectAll(".data").data(i.visible()?t:[],function(e){return e[0]}),i.choroPaths.enter().append("path").attr("class","data").call(i._selection.enter.bind(i._selection)).on("click",function(e){i._dataMap[e[0]]&&i.click(i.rowToObj(i._dataMap[e[0]]),"weight",i._selection.selected(i))}).on("mouseover.tooltip",function(e){i.tooltipShow([e[0],e[1]],i.columns(),1)}).on("mouseout.tooltip",function(e){i.tooltipShow()}).on("mousemove.tooltip",function(e){i.tooltipShow([e[0],e[1]],i.columns(),1)}),i.choroPaths.attr("d",function(t){var n=e._d3GeoPath(i._choroTopologyFeatures[t[0]]);return n||console.log("Unknown Country:  "+t),n}).style("fill",function(e){var t=i._palette(e[1],i._dataMinWeight,i._dataMaxWeight);return t}),i.choroPaths.exit().remove()})},i}),function(e){var t=document,n="appendChild",r="styleSheet",i=t.createElement("style");i.type="text/css",t.getElementsByTagName("head")[0][n](i),i[r]?i[r].cssText=e:i[n](t.createTextNode(e))}(".map_Layered .background{fill:none}.map_Layered .raster image{fill:#b5d0d0}.map_Layered .hash path{fill:none;stroke:red;stroke-linejoin:round}.map_Layered .checkerFill{fill:red;stroke:red;opacity:.5}.map_Layered .checkerNoFill{fill:none;stroke:none;opacity:.5}.map_Layered .mesh{fill:none;stroke:#6d6e71}.map_Layered .data.selected{stroke-width:1.25px}.map_GMap .marker{fill:#656565;stroke:none;stroke-width:1px}.map_GMap .map_Layered{pointer-events:auto;cursor:auto}.gm-style img{max-width:none}.gm-style label{width:auto;display:inline}.map_Layered .data{stroke:none}.map_Layered .data.selected{stroke:red}.map_Layered .data.over{stroke:orange}.map_Layered .data.selected.over{stroke:red}.map_Layered .marker{fill:#656565;stroke:none;stroke-width:1px}.map_Layered .dataEdge{stroke:#000;fill:none}.map_Layered .graticule{fill:none;stroke:#a9a9a9;stroke-linejoin:round}.map_Layered .graticuleOutline{fill:none;stroke:#000;stroke-linejoin:round}.map_Heat{//pointer-events:none}.map_Heat canvas{pointer-events:none}.map_OpenStreet .background{fill:#fff}.map_OpenStreet .graticule{fill:none;stroke:#777;stroke-width:.5px;stroke-opacity:.5}.map_Layered .vector{fill:none;stroke:navy;stroke-linejoin:round}"),define("hpcc-viz-map",function(){});