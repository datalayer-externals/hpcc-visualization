!function(t,e){"function"==typeof define&&define.amd?define(["d3","topojson","./Layer","./Utility","css!./OpenStreet"],e):t.map_OpenStreet=e(t.d3,t.topojson,t.map_Layer,t.map_Utility)}(this,function(t,e,r,o){function i(){r.call(this)}return i.prototype=Object.create(r.prototype),i.prototype.constructor=i,i.prototype._class+=" map_OpenStreet",i.prototype._copyrightText="Â© OpenStreetMap contributors",i.prototype.publish("tileProvider","OpenStreetMap","set","Tile Provider",["OpenStreetMap","OpenStreetMap Hot","MapQuest","MapQuest Sat","Stamen Watercolor","OpenCycleMap"],{tags:["Basic","Shared"]}),i.prototype.layerEnter=function(t,e,i){r.prototype.layerEnter.apply(this,arguments),this._tile=o.Tile(),this._openStreetTransform=e.append("g"),this._openStreet=this._openStreetTransform.append("g"),this._copyright=e.append("text").attr("x",-100).attr("y",-100).style("opacity",.5).text(this._copyrightText),this._copyrightBBox=this._copyright.node().getBBox()},i.prototype.layerUpdate=function(t){this.visible()?this._copyright.attr("x",t.width()-this._copyrightBBox.width-this._copyrightBBox.height/2).attr("y",t.height()-this._copyrightBBox.height/2).text(this._copyrightText):this._copyright.text("")},i.prototype.layerZoomed=function(t){var e=[];if(this.visible()){var r=t.project(-85,180);(!r||r[0]<=0||r[1]<=0)&&(r=[t.width(),t.height()]),this._tile.size([Math.min(t.width(),r[0]),Math.min(t.height(),r[1])]).scale(4096*t._zoom.scale()).translate(t._zoom.translate()),e=this._tile(),this._openStreetTransform.attr("transform","scale("+e.scale+")translate("+e.translate+")")}this._prevTileProvider!==this.tileProvider()&&(this._openStreet.selectAll("image").remove(),this._prevTileProvider=this.tileProvider());var o=this,i="https:"===window.location.protocol?"https:":"http:",a=this._openStreet.selectAll("image").data(e,function(t){return t[2]+"/"+t[0]+"/"+t[1]});a.enter().append("image").attr("xlink:href",function(t){switch(o.tileProvider()){case"OpenStreetMap Hot":return i+"//"+["a","b","c"][3*Math.random()|0]+".tile.openstreetmap.fr/hot/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"MapQuest":return i+"//otile"+["1","2","3","4"][4*Math.random()|0]+".mqcdn.com/tiles/1.0.0/osm/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"MapQuest Sat":return i+"//otile"+["1","2","3","4"][4*Math.random()|0]+".mqcdn.com/tiles/1.0.0/sat/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"Stamen Watercolor":return i+"//"+["a","b","c"][3*Math.random()|0]+".tile.stamen.com/watercolor/"+t[2]+"/"+t[0]+"/"+t[1]+".png";case"OpenCycleMap":return i+"//"+["a","b"][2*Math.random()|0]+".tile.opencyclemap.org/cycle/"+t[2]+"/"+t[0]+"/"+t[1]+".png";default:return i+"//"+["a","b","c"][3*Math.random()|0]+".tile.openstreetmap.org/"+t[2]+"/"+t[0]+"/"+t[1]+".png"}}).attr("width",1).attr("height",1).attr("x",function(t){return t[0]}).attr("y",function(t){return t[1]}).style("opacity",0).transition().duration(500).style("opacity",1),a.exit().remove()},i});