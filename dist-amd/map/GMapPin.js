!function(t,o){"function"==typeof define&&define.amd?define(["d3","./GMapLayered","./Pins"],o):t.map_GMapPin=o(t.d3,t.map_GMapLayered,t.map_Pins)}(this,function(t,o,i){function e(t){o.call(this);var e=this;this._pins=(new i).columns(["lat","long","ext"]).on("click",function(t,o,i){if(window.event.ctrlKey&&e.streetViewOnClick()){var n=e.rowToObj(t.ext.origRow);e.streetViewAt({lat:+n[e.latitudeColumn()],lng:+n[e.longtitudeColumn()]})}else e.click(e.rowToObj(t.ext.origRow),"",i)}).on("dblclick",function(t,o,i){e.dblclick(e.rowToObj(t.ext.origRow),"",i)})}return e.prototype=Object.create(o.prototype),e.prototype.constructor=e,e.prototype._class+=" map_GMapPin",e.prototype.publish("autoScale",!1,"boolean","Auto scale to data"),e.prototype.publishProxy("pinColor","_pins","fillColor"),e.prototype.publishProxy("pinType","_pins","pinType"),e.prototype.publishProxy("pinWidth","_pins","pinWidth"),e.prototype.publishProxy("pinHeight","_pins","pinHeight"),e.prototype.publishProxy("cornerRadius","_pins","cornerRadius"),e.prototype.publishProxy("pinRadius","_pins","pinRadius"),e.prototype.publishProxy("arrowWidth","_pins","arrowWidth"),e.prototype.publishProxy("arrowHeight","_pins","arrowHeight"),e.prototype.publishProxy("textBaseline","_pins","textBaseline"),e.prototype.publishProxy("strokeWidth","_pins","strokeWidth"),e.prototype.publishProxy("omitNullLatLong","_pins","omitNullLatLong"),e.prototype.publish("latitudeColumn",null,"set","Latitude",function(){return this.columns()},{optional:!0}),e.prototype.publish("longtitudeColumn",null,"set","Longtitude",function(){return this.columns()},{optional:!0}),e.prototype.publish("colorColumn",null,"set","Color",function(){return this.columns()},{optional:!0}),e.prototype.publish("tooltipColumn",null,"set","Tooltip",function(){return this.columns()},{optional:!0}),e.prototype.publish("streetViewOnClick",!1,"boolean","Switch to street view when pin clicked"),e.prototype.pinsData=function(){var t=this.columns();return this._view=this._db.rollupView([this.latitudeColumn(),this.longtitudeColumn()]),this._view.entries().map(function(o){var i=o.values[0].values[0];return[o.key,o.values[0].key,{fillColor:i[t.indexOf(this.colorColumn())],tooltip:i[t.indexOf(this.tooltipColumn())],origRow:i}]},this)},e.prototype.enter=function(t,i){o.prototype.enter.apply(this,arguments),this.layers([this._pins])},e.prototype.update=function(t,i){o.prototype.update.apply(this,arguments),this._pins.data(this.pinsData()),this.autoScale()&&this._prevChecksum!==this._db.checksum()&&(this._prevChecksum=this._db.checksum(),this.zoomTo(this._pins.pinsData().map(function(t){return[t.lat,t["long"]]})))},e.prototype.exit=function(t,i){o.prototype.exit.apply(this,arguments)},e.prototype.click=function(t,o,i){this.streetViewOnClick()&&this.streetViewAt({lat:+t[this.latitudeColumn()],lng:+t[this.longtitudeColumn()]})},e.prototype.dblclick=function(t,o,i){console.log("Double click:  "+JSON.stringify(t)+", "+o+","+i)},e});