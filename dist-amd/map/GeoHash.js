!function(t,e){"function"==typeof define&&define.amd?define(["d3","topojson","./Layer","./Utility","../common/Palette","../common/Utility","css!./GeoHash"],e):t.map_GeoHash=e(t.d3,t.topojson,t.map_Layer,t.map_Utility,t.common_Palette,t.common_Utility)}(this,function(t,e,o,a,i,s){function l(){o.call(this)}return l.prototype=Object.create(o.prototype),l.prototype.constructor=l,l.prototype._class+=" map_GeoHash",l.prototype._palette=i.rainbow("default"),l.prototype.publish("paletteID","YlOrRd","set","Palette ID",l.prototype._palette["switch"](),{tags:["Basic","Shared"]}),l.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),l.prototype.publish("opacity",1,"number","Opacity",null,{tags:["Advanced"]}),l.prototype.publish("meshVisible",!0,"boolean","Mesh Visibility"),l.prototype.publish("meshColor",null,"html-color","Stroke Color",null,{optional:!0}),l.prototype.publish("meshStrokeWidth",.25,"number","Stroke Width"),l.prototype.data=function(t){var e=o.prototype.data.apply(this,arguments);return arguments.length&&(this._dataMinWeight=null,this._dataMaxWeight=null,this.data().forEach(function(t){(!this._dataMinWeight||t[1]<this._dataMinWeight)&&(this._dataMinWeight=t[1]),(!this._dataMaxWeight||t[1]>this._dataMaxWeight)&&(this._dataMaxWeight=t[1])},this)),e},l.prototype.layerEnter=function(e,i,l){o.prototype.layerEnter.apply(this,arguments),this.geohash=new a.Geohash,this._geoHashTransform=i.append("g"),this._selection=new s.SimpleSelection(this._geoHashTransform),this.geoHashPaths=t.select(null)},l.prototype.layerUpdate=function(t){o.prototype.layerUpdate.apply(this,arguments),this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this._geoHashTransform.style("opacity",this.opacity()),this.geoHashPaths=this._geoHashTransform.selectAll(".data").data(this.visible()?this.data():[],function(t){return t[0]});var e=this;this.geoHashPaths.enter().append("path").attr("class","data").call(this._selection.enter.bind(this._selection)).on("click",function(t){e.click(e.rowToObj(t),"weight",e._selection.selected(this))}).on("dblclick",function(t){e.dblclick(e.rowToObj(t),"weight",e._selection.selected(this))}),this.geoHashPaths.attr("d",function(o){var a=e.geohash.bounds(o[0]),i={type:"LineString",coordinates:[[a.sw.lon,a.ne.lat],[a.ne.lon,a.ne.lat],[a.ne.lon,a.sw.lat],[a.sw.lon,a.sw.lat]]};return t._d3GeoPath(i)}).style("fill",function(t){var o=e._palette(t[1],e._dataMinWeight,e._dataMaxWeight);return o}),this.geoHashPaths.exit().remove()},l.prototype.layerZoomed=function(t){o.prototype.layerZoomed.apply(this,arguments),this._geoHashTransform.attr("transform","translate("+t._zoom.translate()+")scale("+t._zoom.scale()+")").attr("stroke-width",1.5/t._zoom.scale()+"px")},l.prototype.click=function(t,e,o){console.log("Click:  "+JSON.stringify(t)+", "+e+", "+o)},l.prototype.dblclick=function(t,e,o){console.log("Double click:  "+JSON.stringify(t)+", "+e+", "+o)},l});