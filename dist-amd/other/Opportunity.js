!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","../common/Utility","../common/PropertyExt","css!./Opportunity"],e):t.graph_Opportunity=e(t.d3,t.common_SVGWidget,t.common_Utility,t.common_PropertyExt)}(this,function(t,e,r,o){function n(t){o.call(this),this._owner=t}function a(t){o.call(this),this._owner=t}function p(t){o.call(this),this._owner=t}function u(t){e.call(this),this._drawStartPos="origin",this.groupCount=7}return n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype._class+=" graph_Opportunity.Column",n.prototype.publish("headerLabel",null,"string","Header value of a table",function(){return this._owner?this._owner.columns():[]},{tags:["Basic"],optional:!0}),a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype._class+=" graph_Opportunity.MouseHoverColumn",a.prototype.publish("hoverValue",null,"string","Hover value of a table",function(){return this._owner?this._owner.columns():[]},{tags:["Basic"],optional:!0}),a.prototype.publish("hoverList",null,"set","Hover value of a table",function(){return this._owner?this._owner.getIds():[]},{tags:["Basic"],optional:!0}),p.prototype=Object.create(o.prototype),p.prototype.constructor=p,p.prototype._class+=" graph_Opportunity.ColumnDropdown",p.prototype.publish("columnIndex",null,"number","Column index for display context data based on column dropdown list selction",{},{tags:["Basic","Shared"]}),p.prototype.publish("ColumnDropdownList",null,"set","column value of a table",function(){return this._owner?this._owner.getIds():[]},{tags:["Basic"],optional:!0}),u.prototype=Object.create(e.prototype),u.prototype.constructor=u,u.prototype.Column=n,u.prototype.MouseHoverColumn=a,u.prototype.ColumnDropdown=p,u.prototype._class+=" graph_Opportunity",u.prototype.publish("previousGroup","","set","label in Opportunity",function(){return this.getIds()},{tags:["Basic","Shared"]}),u.prototype.publish("currentGroup","","set","label in Opportunity",function(){return this.getIds()},{tags:["Basic","Shared"]}),u.prototype.publish("opportunityId","id","set","Id for label in Opportunity",function(){return this.getIds()},{tags:["Basic","Shared"]}),u.prototype.publish("url",null,"string","URL in Opportunity",{},{tags:["Basic","Shared"]}),u.prototype.publish("width",1100,"number","label in Opportunity",{},{tags:["Basic","Shared"]}),u.prototype.publish("addColumn",null,"string","number of columns in a table",{},{tags:["Basic","Shared"],editor_input:function(t,e,r,o){r.append("button").attr("id",t.id()+"_addColumn"+o.id).classed("property-input custom-editor-input addColumn update",!0).text("AddColumn").on("click",function(){e.groupCount=e.groupCount+1;var r="Added a new column";t.setProperty(e,o.id,r)})}}),u.prototype.publish("removeColumn",null,"string","number of columns in a table",function(){return this.columns()},{tags:["Basic","Shared"],editor_input:function(t,e,r,o){r.append("button").attr("id",t.id()+"_removeColumn"+o.id).classed("property-input custom-editor-input removeColumn update",!0).text("RemoveColumn").on("click",function(){e.groupCount=e.groupCount-1;var r="Removed a column";t.setProperty(e,o.id,r)})}}),u.prototype.publish("headerLabels",[],"propertyArray","Source Columns",null,{autoExpand:n}),u.prototype.publish("mouseHover",[],"propertyArray","mouse hover options",null,{autoExpand:a}),u.prototype.publish("columnData",[],"propertyArray","column data",null,{autoExpand:p}),u.prototype.getIds=function(){var t=this.columns();return t.unshift("default"),t},u.prototype.enter=function(r,o){e.prototype.enter.apply(this,arguments);var n=30,a=14,p=10,u=(this.data().length+1)*(a+p+1)+n;this.svg=o.append("g").attr("width",100*this.groupCount+1).attr("height",u),this.svg.append("defs").append("marker").classed("arrowhead",!0).attr("id","end-arrow").attr("viewBox","0 -5 10 10").attr("refX",6).attr("markerWidth",8).attr("markerHeight",8).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5").attr("fill","rgb(100,100,100)"),this.tooltipdiv=t.select("body").append("div").attr("class","graph_Opportunity-tooltip tooltip").style("opacity",0)},u.prototype.update=function(r,o){e.prototype.update.apply(this,arguments);var n=this,a=this.data(),p=this.opportunityId();a.sort(function(t,e){return t.cur_group>e.cur_group?1:t.cur_group<e.cur_group?-1:0});for(var u=[],i=1;i<=n.groupCount;i++)u.push(i);var s=30,l=14,d=10,c=(a.length+1)*(l+d+1)+s,h=this.width(),g=30,y=h/n.groupCount-g,v=this.svg.selectAll(".group").data(u);v.enter().append("rect").attr("class","group"),v.attr("x",function(t,e){return e*h/n.groupCount+1}).attr("y",s).attr("width",h/this.groupCount).attr("height",c-s),v.exit().remove();var m=this.svg.selectAll(".group_headings").data(u);if(m.enter().append("text").attr("class","group_headings").attr("y",20),m.attr("x",function(t,e){return e*h/n.groupCount+h/n.groupCount/n.groupCount}).text(function(t,e){return n.headerLabels().length>0&&n.headerLabels()[e]&&n.headerLabels()[e].headerLabel()?n.headerLabels()[e].headerLabel():""}),m.exit().remove(),"prev_group"===this.previousGroup()&&"cur_group"===this.currentGroup()){var f=this.svg.selectAll(".node_date_change").data(a);f.enter().append("g").attr("class","node_date_change update").on("mouseover",function(e){n.tooltipdiv.transition().duration(200).style("opacity",.9);var r="<span style='font-weight:bolder'>Close Date Change </span><br/>",o=n.mouseHover();o.forEach(function(t,o){void 0!==t.hoverValue()&&(r=r+"<span style='font-weight:bold'>"+t.hoverValue()+":  </span>"+e[t.hoverList()]+"<br/>")});var a=e.prevdate+"";a=a.replace(/(\d\d\d\d)(\d\d)(\d\d)/g,"$3-$2-$1");var p=e.curdate+"";p=p.replace(/(\d\d\d\d)(\d\d)(\d\d)/g,"$3-$2-$1"),r=r+"<span style='font-weight:bold'>From: </span>"+a+"<br/><span style='font-weight:bold'>To: </span>"+p+"<br/>",n.tooltipdiv.html(r).style("left",t.event.pageX+"px").style("top",t.event.pageY-50+"px")}).on("mouseout",function(t){n.tooltipdiv.transition().duration(500).style("opacity",0)}).each(function(e){var r=t.select(this);r.append("rect").attr("class","node_date_change_rect").attr("width",5).attr("height",l).attr("rx",6).attr("ry",6)}),f.attr("transform",function(t,e){return"translate("+(9*h/n.groupCount+g-80)+","+(e+e*(l+d)+12+s)+")"}),f.exit().remove();var _=this.svg.selectAll(".node_prev_group").data(a);_.enter().append("g").attr("class","node_prev_group").on("mouseover",function(e,r){n.tooltipdiv.transition().duration(200).style("opacity",.9);var o="",a=n.mouseHover();a.forEach(function(t,r){void 0!==t.hoverValue()&&(o=o+"<span style='font-weight:bold'>"+t.hoverValue()+":  </span>"+e[t.hoverList()]+"<br/>")}),n.tooltipdiv.html(o).style("left",t.event.pageX+"px").style("top",t.event.pageY-100+"px")}).on("mouseout",function(t){n.tooltipdiv.transition().duration(500).style("opacity",0)}).each(function(e){var r=t.select(this);r.append("rect").attr("class","node_prev_rect").attr("rx",6).attr("ry",6),r.append("text").attr("class","node_prev_text")}),_.classed("update",!0).classed("changed",function(t){return 0!==t.delta}).attr("transform",function(t,e){return"translate("+((t.prev_group-1)*h/n.groupCount+g/2)+","+(e+e*(l+d)+10+s)+")"}).each(function(e){var r=t.select(this),o=r.selectAll(".arrow").data(0!==e.delta?[e]:[]);o.enter().append("line").attr("class","arrow update"),o.attr("x1",function(t){return t.delta>0?y:0}).attr("y1",l/2).attr("x2",function(t){return t.delta>0?y+g-4+(Math.abs(t.delta)-1)*(h/n.groupCount):-g-(Math.abs(t.delta)-1)*(h/n.groupCount)+4}).attr("y2",l/2).style("stroke-dasharray","3, 3").style("stroke","rgb(100,100,100)").style("marker-end","url(#end-arrow)").style("opacity","1"),o.exit().remove()});var b=_.select(".node_prev_rect");b.attr("width",y).attr("height",l);var x=_.select(".node_prev_text");x.attr("dy",l/2+3).attr("dx",y/4).text(function(t){return"number"==typeof t[p]?t[p]:t[p].substring(0,14)}),_.exit().remove();var w=this.svg.selectAll(".node_cur_group").data(a);w.enter().append("g").attr("class","node_cur_group").attr("transform",function(t,e){return"translate("+((t.prev_group-1)*h/n.groupCount+g/2)+","+(e+e*(l+d)+10+s)+")"}).on("mouseover",function(e,r){n.tooltipdiv.transition().duration(200).style("opacity",.9);var o="",a=n.mouseHover();a.forEach(function(t,r){void 0!==t.hoverValue()&&(o=o+"<span style='font-weight:bold'>"+t.hoverValue()+":  </span>"+e[t.hoverList()]+"<br/>")}),n.tooltipdiv.html(o).style("left",t.event.pageX+"px").style("top",t.event.pageY-100+"px")}).on("mouseout",function(t){n.tooltipdiv.transition().duration(500).style("opacity",0)}).each(function(e){var r=t.select(this);r.append("rect").attr("class","node_cur_rect").attr("fill",function(t){var e;return e=t.delta<0||7===t.cur_group?"#F78181":"#A9F5A9"}).attr("rx",6).attr("ry",6),r.append("a").append("text").attr("class","node_cur_text")}),w.classed("update",!0).classed("changed",function(t){return 0!==t.delta}).transition().duration(800).ease("linear").attr("transform",function(t,e){return"translate("+((t.cur_group-1)*h/n.groupCount+g/2)+","+(e+e*(l+d)+10+s)+")"}).each("end",function(){t.selectAll(".arrow").style("opacity","1")});var C=w.select(".node_cur_group a");C.classed("update",!0).attr("xlink:href",function(t){return n.url()+t.id}).attr("xlink:show","new");var L=w.select(".node_cur_rect");L.attr("width",y).attr("height",l);var O=w.select(".node_cur_text");O.classed("update",!0).attr("dy",l/2+3).attr("dx",y/4).style("fill","blue").text(function(t){return"number"==typeof t[p]?t[p]:t[p].substring(0,14)}),w.exit().remove()}for(var A=0;A<n.columnData().length;A++)if(n.columnData()[A]&&n.columnData()[A].ColumnDropdownList()){var D=this.svg.selectAll(".columnDataText_"+A).data(a);D.enter().append("g").attr("class","columnDataText_"+A+" update").each(function(e){var r=t.select(this);r.append("text")}),D.attr("transform",function(t,e){return"translate("+(n.columnData()[A].columnIndex()*h/n.groupCount+g/2)+","+(e+e*(l+d)+12+s)+")"}).attr("width",5).attr("height",l).attr("rx",6).attr("ry",6);var B=D.select("text");B.attr("y",-6).attr("dy",l+14).attr("dx",0).attr("height",20).attr("width",29).text(function(t,e){return t[n.columnData()[A].ColumnDropdownList()]}),D.exit().remove()}},u.prototype.exit=function(t,r){e.prototype.exit.apply(this,arguments)},u});