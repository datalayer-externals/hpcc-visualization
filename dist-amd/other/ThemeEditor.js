!function(e,t){"function"==typeof define&&define.amd?define(["../common/Widget","../common/HTMLWidget","./Persist","./PropertyEditor","css!./ThemeEditor"],t):e.other_PropertyEditor=t(e.common_Widget,e.common_HTMLWidget,e.other_Persist,e.other_PropertyEditor)}(this,function(e,t,r,i){function a(){t.call(this),this._tag="div",this._current_grouping=void 0,this._showing_columns=void 0,this._showing_data=void 0,this.columns(["Key","Value"]),this._contentEditors=[],this._showSettings=!0,this._defaultThemes=[],this._widgetObjsById={}}function n(e){var t=e.split(/(?=[0-9A-Z])/).map(function(e){return e.length>1?e+" ":e}).join("");return t.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})}function o(e,t,r,i){function a(e,t){var r="";return e.set.forEach(function(e){var i=e===t?" selected":"";r+="<option value='"+e+"'"+i+">"+e+"</option>"}),r}var n,o="",s="te-input-"+e.id+"-"+i;"undefined"!=typeof e.ext&&"undefined"!=typeof e.ext.inputType&&(n=e.ext.inputType),"undefined"!=typeof e.inputID&&(s=e.inputID);var l="data-paramid='"+e.id+"' data-wids='"+r.map(function(e){return"object"==typeof e.widget?e.widget._id:e}).join(",")+"'";switch(e.type){case"boolean":var d=t?" checked":"";o="<input id='"+s+"' "+l+" type='checkbox' class='te-checkbox te-input'"+d+">";break;case"number":"undefined"!=typeof n?"textarea"===n?o="<textarea id='"+s+"' class='te-textarea te-input' "+l+">"+t+"</textarea>":"range"===n&&(o="<input id='"+s+"' class='te-input' type='range' "+l+" value='"+t+"'  min='"+e.ext.min+"' max='"+e.ext.max+"' step='"+e.ext.step+"'>"):o="<input id='"+s+"' type='text' class='te-text te-input' "+l+" value='"+t+"'>";break;case"string":"undefined"!=typeof n?"textarea"===n&&(o="<textarea id='"+s+"' class='te-textarea te-input' "+l+">"+t+"</textarea>"):o="<input id='"+s+"' type='text' class='te-text te-input' value='"+t+"' "+l+">";break;case"html-color":var p=""===t?"":" value='"+t+"'";o="<input id='"+s+"' type='text' class='te-html-color-input te-input' "+l+" "+p+">",o+="<input type='color' class='te-html-color-button te-input' "+l+" "+p+">";break;case"set":var u=a(e,t);o="<select id='"+s+"' class='te-select te-input'"+l+">"+u+"</select>";break;case"array":o="<textarea id='"+s+"' class='te-textarea te-input' data-type='array' "+l+">"+t+"</textarea>"}return"undefined"!=typeof e.ext.saveButton&&(o+="<button id='"+e.ext.saveButtonID+"'>"+e.ext.saveButton+"</button>"),o}var s=function(e){return"function"==typeof window.g_defaultThemes&&window.g_defaultThemes(e),JSON.parse(localStorage.getItem("themeEditorThemes")||"{}")},l=function(e){return"function"==typeof window.g_defaultSerials&&window.g_defaultSerials(e),JSON.parse(localStorage.getItem("themeEditorSerials")||"{}")},d=function(e){var t=s(),r=[];for(var i in t)r.push(i);return"undefined"!=typeof e&&"undefined"!=typeof r[e]&&(r=r[e]),r},p=function(e){var t=l(),r=[];for(var i in t)r.push(i);return"undefined"!=typeof e&&"undefined"!=typeof r[e]&&(r=r[e]),r};a.prototype=Object.create(t.prototype),a.prototype._class+=" other_ThemeEditor",a.prototype.publish("themeMode",!0,"boolean","Edit default values",null,{tags:["Basic"]}),a.prototype.publish("saveTheme","","string","Save Theme",null,{tags:["Basic","Theme"],saveButton:"Save",saveButtonID:"te-save-button"}),a.prototype.publish("loadedTheme",d(1),"set","Loaded Theme",d(),{tags:["Basic","Theme"]}),a.prototype.publish("saveSerial","","string","Save Serial",null,{tags:["Basic","Serial"],saveButton:"Save",saveButtonID:"te-save-button"}),a.prototype.publish("loadedSerial",p(0),"set","Loaded Serial",p(),{tags:["Basic","Serial"]}),a.prototype.publish("showColumns",!0,"boolean","Show Columns",null,{tags:["Intermediate"]}),a.prototype.publish("showData",!0,"boolean","Show Data",null,{tags:["Intermediate"]}),a.prototype.publish("shareCountMin",1,"number","Share Count Min",null,{tags:["Private"]}),a.prototype.publish("paramGrouping","By Param","set","Param Grouping",["By Param","By Widget"],{tags:["Private"]}),a.prototype.publish("editorComplexity","Basic","set","Choose what publish properties to display within the editor.",["Basic","Intermediate","Advanced","Private"],{tags:["Private"]}),a.prototype.publish("sectionTitle","","string","Section Title",null,{tags:["Private"]}),a.prototype.publish("collapsibleSections",!0,"boolean","Collapsible Sections",null,{tags:["Intermediate"]}),a.prototype.getThemes=s,a.prototype.getSerials=l,a.prototype.getDefaultThemes=d,a.prototype.getDefaultSerials=p,a.prototype.showSettings=function(e){return arguments.length?(this._showSettings=e,this):this._showSettings},a.prototype.onChange=function(e,t){},a.prototype.enter=function(e,r){t.prototype.enter.apply(this,arguments),this._parentElement.style("overflow","auto")};var u=function(e){var t=!1;return"undefined"==typeof e._current_grouping?e._current_grouping=e._group_params_by:e._current_grouping!==e._group_params_by&&(t=!0),"undefined"==typeof e._showing_columns?e._showing_columns=e.showColumns():e._showing_columns!==e.showColumns()&&(t=!0),"undefined"==typeof e._showing_data?e._showing_data=e.showData():e._showing_data!==e.showData()&&(t=!0),t};return a.prototype.widgetProperty=function(e,t,r){return void 0===r?e[t]():e[t](r)},a.prototype.load=function(){},a.prototype.save=function(){},a.prototype.needsPropTableRedraw=function(e,t){var r=null===document.getElementById("te-themeEditorOptions");return r},a.prototype.update=function(e,i){t.prototype.update.apply(this,arguments),u(this)&&i.selectAll("#"+this._id+" > table").remove(),this._current_grouping=this.paramGrouping(),this._widgetObjsById[this._id]=this,this._sharedProperties=this.findSharedProperties(this.data());var a=this.needsPropTableRedraw();if(a&&this.showSettings()){var n=r.discover(this);for(var s in n)if(-1!==n[s].ext.tags.indexOf(this.editorComplexity())){var l=this[n[s].id]();("loadedTheme"===n[s].id||"loadedSerial"===n[s].id)&&(n[s].inputID="te-load-theme"),n[s].input=o(n[s],l,[this._id],this._id)}else delete n[s];e.innerHTML=this.propertiesTableHtml(n);var d=document.createEvent("Events");d.initEvent("TE Properties Ready",!0,!0),document.dispatchEvent(d)}this.buildTableObjects(e,this._sharedProperties),this.initFunctionality(e)},a.prototype.exit=function(e,r){t.prototype.exit.apply(this,arguments)},a.prototype.click=function(e){},a.prototype.propertiesTableHtml=function(e){var t={id:"te-themeEditorOptions",label:"Editor Options",rowArr:[]},r={id:"te-tableModeOptions",label:this.themeMode()?"Save/Load Theme":"Save/Load Serial",rowArr:[]};for(var i in e)this.themeMode()?-1===e[i].ext.tags.indexOf("Theme")&&-1===e[i].ext.tags.indexOf("Serial")?t.rowArr.push({th:n(e[i].id),td:e[i].input,trClass:"propertyRow"}):-1!==e[i].ext.tags.indexOf("Theme")&&r.rowArr.push({th:n(e[i].id),td:e[i].input,trClass:"propertyRow"}):-1===e[i].ext.tags.indexOf("Serial")&&-1===e[i].ext.tags.indexOf("Theme")?t.rowArr.push({th:n(e[i].id),td:e[i].input,trClass:"propertyRow"}):-1!==e[i].ext.tags.indexOf("Serial")&&r.rowArr.push({th:n(e[i].id),td:e[i].input,trClass:"propertyRow"});var a="";return t.rowArr.length>0&&(a+=this.tableObjHtml(t)),r.rowArr.length>0&&(a+=this.tableObjHtml(r)),a},a.prototype.buildTableObjects=function(e,t){var r={};r=this.themeMode()?{chartColorSection:{id:"te-colorOptions",label:"Chart Colors",rowObjArr:[]},surfaceSection:{id:"te-containerOptions",label:"Container Styles/Colors",rowObjArr:[]},fontSection:{id:"te-fontOptions",label:"Font Styles/Colors",rowObjArr:[]}}:{nonSurfaceSection:{id:"te-chartOptions",label:"Chart Properties",rowObjArr:[]}};for(var i in t)this.themeMode()?-1===i.toUpperCase().indexOf("FONT")||-1!==t[i].arr[0].widget._class.indexOf("layout_Surface")&&-1!==i.toUpperCase().indexOf("COLOR")?"paletteID"===i?r.chartColorSection.rowObjArr.push(t[i]):-1!==t[i].arr[0].widget._class.indexOf("layout_Surface")&&r.surfaceSection.rowObjArr.push(t[i]):r.fontSection.rowObjArr.push(t[i]):-1===t[i].arr[0].widget._class.indexOf("layout_Surface")&&r.nonSurfaceSection.rowObjArr.push(t[i]);var a="";for(var n in r)a+=this.sharedPropertyTableHtml(r[n]);e.innerHTML+=a},a.prototype.initFunctionality=function(e){function t(e){if(a.showSettings()){var t=document.getElementById("te-save-button");t.onclick=function(e){var t=e.srcElement,r=t.previousSibling.value;if(r.length>1){var i,n=document.getElementById("te-load-theme"),o=n.getElementsByTagName("option"),s=!1;for(var l in o){var d=o[l].value;d===r&&(s=!0)}if(s){var p=confirm("'"+r+"' already exists. Do you want to overwrite the existing save? ");p&&(i=a.save(r))}else i=a.save(r),n.innerHTML+="<option value='"+r+"'>"+r+"</option>";t.previousSibling.value="",n.value=r}else alert("Save Name cannot be empty.")}}}function r(e){var t=e.getElementsByClassName("te-input");for(var r in t){if(isNaN(parseInt(r)))break;var i=t[r],n=i.getAttribute("id");"te-load-theme"===n?i.onchange=function(e){var t=e.srcElement;a.load(t.value)}:null!==n&&-1!==n.indexOf("te-input-themeMode")?i.onchange=function(e){var t=e.srcElement;a.themeMode(t.checked);var r=document.getElementById("te-load-theme"),i=null!==r?r.value:"Default";a.load(i)}:("INPUT"===i.tagName||"SELECT"===i.tagName||"TEXTAREA"===i.tagName)&&(i.onchange=function(e){var t=e.srcElement,r=t.getAttribute("id");-1!==t.className.split(" ").indexOf("te-html-color-button")&&(r=t.previousSibling.getAttribute("id"),t.previousSibling.value=t.value);var i=t.getAttribute("type"),n=r.split("-"),o=n.slice(0,n.length-1).join("-")+"-",s=t.getAttribute("data-wids"),l=t.getAttribute("data-paramid"),d=s.split(",");d.forEach(function(e){var r=o+e,n=document.getElementById(r);if("checkbox"===i)n.checked=t.checked,a._widgetObjsById[e][l](t.checked);else if("array"===t.getAttribute("data-type")){n.value=t.value;try{a._widgetObjsById[e][l](JSON.parse(t.value))}catch(s){}}else n.value=t.value,a._widgetObjsById[e][l](t.value),-1!==n.className.split(" ").indexOf("te-html-color-input")?n.nextSibling.value=t.value:-1!==n.className.split(" ").indexOf("te-html-color-button")&&(n.previousSibling.value=t.value)}),a.data().forEach(function(e){e.render()})})}}function i(e){var t=e.getElementsByClassName("te-section-table");for(var r in t)if("function"==typeof t[r].getElementsByTagName){var i=t[r].getElementsByTagName("thead");i[0].onclick=function(e){var t=e.toElement;"TH"===t.tagName&&(t=t.parentElement.parentElement);var r=t.parentElement,i="";-1===r.className.split(" ").indexOf("expanded")?(r.className="te-section-table expanded",i="shown"):(r.className="te-section-table collapsed",i="hidden");var a=r.getElementsByTagName("tbody");a[0].className=i}}var a=e.getElementsByClassName("sharedPropertyRow");for(var n in a)if("function"==typeof a[n].getElementsByClassName){var o=a[n].getElementsByClassName("te-label");o[0].onclick=function(e){var t=e.toElement,r=t.parentElement,i="";-1===r.className.split(" ").indexOf("expanded")?(r.className="sharedPropertyRow expanded",i="shown"):(r.className="sharedPropertyRow collapsed",i="hidden");for(var a=r.nextSibling;null!==a;)-1===a.className.split(" ").indexOf("sharedPropertyRow")?(a.className="propertyRow "+i,a=a.nextSibling):a=null}}}var a=this;i(e),r(e),t(e)},a.prototype.sharedPropertyTableHtml=function(e){function t(e){var t=e.widget.classID().split("_"),r=t.join("/");return r+" <i>["+e.widget._id+"]</i>"}function r(e){return n(e.id)}function i(e,t){function r(e,t){var r=e.arr[t].widget[e.id]();return null!==r?r:""}var i=r(e,t),a=o(e,i,[e.arr[t]],e.arr[t].widget._id);return a}function a(e){function t(e){var t=e.arr[0].widget[e.id]();return e.arr.forEach(function(e,r){return t!==e.widget[e.id]()?"":void 0}),null!==t?"array"===e.type?JSON.stringify(t):t:""}var r=t(e),i=o(e,r,e.arr,"shared");return i}var s={id:e.id,label:e.label,rowArr:[]};return e.rowObjArr.forEach(function(e){e.arr.forEach(function(n,o){0===o&&s.rowArr.push({th:r(e),td:a(e),trClass:"sharedPropertyRow collapsed"}),s.rowArr.push({th:t(n),td:i(e,o),trClass:"propertyRow hidden"})})}),this.tableObjHtml(s)},a.prototype.tableObjHtml=function(e){var t="<table id='"+e.id+"' class='te-section-table expanded'>";return t+="<thead><tr><th colspan='2'>"+e.label+"</th></tr></thead>",t+="<tbody>",e.rowArr.forEach(function(e){t+=this.tableRowObjHtml(e)},this),t+="</tbody>",t+"</table>"},a.prototype.tableRowObjHtml=function(e){var t="undefined"!=typeof e.trClass?"<tr class='"+e.trClass+"'>":"<tr>";return t+="<th class='te-label'>"+e.th+"</th>",t+="<td>"+e.td+"</td>",t+"</tr>"},a.prototype.setWidgetObjsById=function(e){var t=this,r=e.widget[e.id]();"widgetArray"===e.type?r.forEach(function(e){t._widgetObjsById[e._id]=e}):"widget"===e.type&&null!==r&&(this._widgetObjsById[r._id]=r)},a.prototype.checkTagFilter=function(e){var t=["Basic"],r=!1;return e.forEach(function(e){-1!==t.indexOf(e)&&(r=!0)}),r},a.prototype.findSharedProperties=function(e){function t(e,i){var n=[];if(null!==e){var o=r.discover(e);o.forEach(function(r,o){if("undefined"!=typeof r.ext.tags&&n.push({id:r.id,type:r.type,description:r.description,set:r.set,ext:r.ext,widget:e}),"widgetArray"===r.type){var s=a.widgetProperty(e,r.id);s.forEach(function(e){var r=t(e,i+1);n=n.concat(r)})}else if("widget"===r.type){var l=a.widgetProperty(e,r.id),d=t(l,i+1);n=n.concat(d)}})}return n}var i,a=this;if("undefined"!=typeof e&&e.length>0){var n=[];i={};var o={},s={};e.forEach(function(e){var r=t(e,0);n=n.concat(r)}),n.forEach(function(e){if(-1!==["widget","widgetArray"].indexOf(e.type))a.setWidgetObjsById(e);else if(a.checkTagFilter(e.ext.tags)){var t=e.id;-1!==e.widget._class.indexOf("Surface")?("undefined"==typeof o[t]&&(o[t]={arr:[]}),o[t].id=e.id,o[t].description=e.description,o[t].type=e.type,o[t].set=e.set,o[t].ext=e.ext,o[t].arr.push(e)):("undefined"==typeof s[t]&&(s[t]={arr:[]}),s[t].id=e.id,s[t].description=e.description,s[t].type=e.type,s[t].set=e.set,s[t].ext=e.ext,s[t].arr.push(e)),"undefined"==typeof i[t]&&(i[t]={arr:[]}),i[t].id=e.id,i[t].description=e.description,i[t].type=e.type,i[t].set=e.set,i[t].ext=e.ext,i[t].arr.push(e)}})}return i},a});