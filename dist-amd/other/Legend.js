!function(t,e){"function"==typeof define&&define.amd?define(["d3","./Table","../common/Palette","css!./Legend"],e):t.other_Legend=e(t.d3,t.other_Table,t.common_Palette)}(this,function(t,e,i){function o(){e.call(this),this._resetCache=!0,this.showHeader(!1),this.pagination(!1)}function a(t){return'<div class="colorBlock" style="background-color:'+t+';"></div>'}o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype._class+=" other_Legend",o.prototype.publish("dataFamily","ND","set","Type of data",["1D","2D","ND","map","any"],{tags:["Private"]}),o.prototype.publish("orientation","vertical","set","Orientation of Legend rows",["vertical","horizontal"],{tags:["Private"]}),o.prototype.publish("rainbowFormat",",","string","Rainbow number formatting",null,{tags:["Private"],optional:!0,disable:function(t){return!t.isRainbow()}}),o.prototype.publish("rainbowBins",8,"number","Number of rainbow bins",null,{tags:["Private"],disable:function(t){return!t.isRainbow()}}),o.prototype.isRainbow=function(){var t=this.getWidget();return t&&t._palette&&"rainbow"===t._palette.type()},o.prototype.targetWidget=function(t){if(!arguments.length)return this._targetWidget;this._targetWidget=t;var e=t.data,i=this;return t.data=function(){return arguments.length>0&&i._resetCache&&(i._hiddenRows=[],i._cachedData=arguments[0]),i._resetCache=!0,e.apply(i._targetWidget,arguments)},this._targetWidgetMonitor&&(this._targetWidgetMonitor.remove(),delete this._targetWidgetMonitor),this._targetWidgetMonitor=this._targetWidget.monitor(function(t,e,o,a){switch(t){case"chart":case"columns":case"paletteID":i.lazyRender()}}),this},o.prototype.getWidget=function(){if(this._targetWidget)switch(this._targetWidget.classID()){case"chart_MultiChart":return this._targetWidget.chart()}return this._targetWidget},o.prototype.getPalette=function(){var t=this.getWidget();if(t&&t._palette)switch(t._palette.type()){case"ordinal":return i.ordinal(t._palette.id());case"rainbow":return i.rainbow(t._palette.id())}return i.ordinal("default")};var n=e.prototype.getBBox;return o.prototype.getBBox=function(t,e){var i=n.apply(this,arguments),o=this.element().select(".tableDiv > table");if(!o.empty()){var a=o.node().getBoundingClientRect(),r=a.width+8+(this.hasVScroll(this._parentElement)?this.getScrollbarWidth():0),s=a.height+8+(this.hasHScroll(this._parentElement)?this.getScrollbarWidth():0);return{x:i.x,y:i.y,width:(e?Math.round(r):r)*this._scale,height:(e?Math.round(s):s)*this._scale}}return i},o.prototype.enter=function(i,o){e.prototype.enter.apply(this,arguments),t.select(i.parentNode).style("overflow-y","auto"),this.renderHtmlDataCells(!0),this.fixedHeader(!1),this.fixedSize(!0),o.classed("other_Legend",!0)},o.prototype.update=function(i,o){var n=["Key","Label"],r=[];if(this._targetWidget){var s=this.getPalette();switch(s.type()){case"ordinal":switch(this.dataFamily()){case"2D":r=this._targetWidget.data().map(function(t){return[a(s(t[0])),t[0]]},this);break;case"ND":var h=this._targetWidget.columns();r=h.filter(function(t,e){return e>0}).map(function(t){return[a(s(t)),t]},this)}break;case"rainbow":var l=t.format(this.rainbowFormat()),d=this.getWidget(),c=this.rainbowBins(),g=d._dataMinWeight,p=d._dataMaxWeight,u=(p-g)/(c-1);r.push([a(s(g,g,p)),l(g)]);for(var f=1;c-1>f;++f){var _=u*f;r.push([a(s(_,g,p)),l(Math.floor(_))])}r.push([a(s(p,g,p)),l(p)])}}this.columns(n),this.data(r),e.prototype.update.apply(this,arguments),o.classed("horiz-legend","horizontal"===this.orientation());var y=o.select(".tableDiv > table"),b=y.node().getBoundingClientRect(),m=this._parentElement.node().getBoundingClientRect();o.select(".tableDiv").style({overflow:"visible"});var w=m.height/2-b.height/2,v=m.width/2-b.width/2;y.style({position:"absolute",top:w+"px",left:v+"px"});var W=this.pageNumber()-1,D=this.itemsPerPage(),R=W*D,C=parseInt(W*D)+parseInt(D),x=null;x=this.pagination()?this.data().slice(R,C):this.data();var M=this.tbody.selectAll("tr").data(x),k=this;M.on("click",function(t,e){k.onClick(t,e)}).on("dblclick",function(t,e){k.onDblClick(t,e)}).on("mouseover",function(t,e){k.onMouseOver(t,e)})},o.prototype.exit=function(t,i){this._targetWidgetMonitor&&(this._targetWidgetMonitor.remove(),delete this._targetWidgetMonitor),e.prototype.exit.apply(this,arguments)},o.prototype.filteredData=function(){var t=this;return this._cachedData?this._cachedData.filter(function(e,i){return-1===t._hiddenRows.indexOf(i)}):[]},o.prototype.onClick=function(t,e){console.log("Legend onClick method"),console.log("rowData: "+t),console.log("rowIdx: "+e),this._hiddenRows||(this._hiddenRows=[]),this._cachedData||(this._cachedData=this._targetWidget.data()),this._targetWidget&&"function"==typeof this._targetWidget.hideRowOnLegendClick&&this._targetWidget.hideRowOnLegendClick()&&(-1===this._hiddenRows.indexOf(e)?this._hiddenRows.push(e):this._hiddenRows=this._hiddenRows.filter(function(t){return t!==e}),this._resetCache=!1,this._targetWidget.data(this.filteredData()).lazyRender())},o.prototype.onDblClick=function(t,e){console.log("Legend onDblClick method"),console.log("rowData: "+t),console.log("rowIdx: "+e)},o.prototype.onMouseOver=function(t,e){console.log("Legend onMouseOver method"),console.log("rowData: "+t),console.log("rowIdx: "+e)},o});