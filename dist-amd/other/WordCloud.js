!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","../api/I2DChart","../api/ITooltip","d3-cloud","css!./WordCloud"],e):t.other_WordCloud=e(t.d3,t.common_SVGWidget,t.api_I2DChart,t.api_ITooltip,t.d3.layout.cloud)}(this,function(t,e,o,i,n){function a(){e.call(this),o.call(this),i.call(this),this._prevOffsetX=this.offsetX(),this._prevOffsetY=this.offsetY(),this._prevZoom=this.zoom(),this._vizData=[]}return a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.prototype._class+=" other_WordCloud",a.prototype["implements"](o.prototype),a.prototype["implements"](i.prototype),a.prototype.publish("paletteID","default","set","Palette ID",a.prototype._palette["switch"](),{tags:["Basic","Shared"]}),a.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),a.prototype.publish("fontFamily","Impact","string","Font Name",null,{tags:["Basic"]}),a.prototype.publish("fontSizeFrom",6,"number","Font Size From",null,{tags:["Basic"]}),a.prototype.publish("fontSizeTo",48,"number","Font Size To",null,{tags:["Basic"]}),a.prototype.publish("angleFrom",-60,"number","Angle From",null,{tags:["Basic"]}),a.prototype.publish("angleTo",60,"number","Angle To",null,{tags:["Basic"]}),a.prototype.publish("angleCount",5,"number","Angle Count",null,{tags:["Basic"]}),a.prototype.publish("padding",0,"number","Padding",null,{tags:["Intermediate"]}),a.prototype.publish("scaleMode","linear","set","Text scaling mode",["linear","log","sqrt","pow"],{tags:["Intermediate"]}),a.prototype.publish("spiral","archimedean","set","Text scaling mode",["archimedean","rectangular"],{tags:["Intermediate"]}),a.prototype.publish("offsetX",0,"number","X offset",null,{tags:["Advanced"]}),a.prototype.publish("offsetY",0,"number","Y offset",null,{tags:["Advanced"]}),a.prototype.publish("zoom",1,"number","Zoom",null,{tags:["Advanced"]}),a.prototype.data=function(t){var o=e.prototype.data.apply(this,arguments);return arguments.length&&(this._vizData=t.map(function(t){var e={};for(var o in t)e["__viz_"+o]=t[o];return e})),o},a.prototype.enter=function(o,i){e.prototype.enter.apply(this,arguments),this._root=i.append("g"),this._canvas=document.createElement("canvas");var a=this;this._zoom=t.behavior.zoom().scaleExtent([.1,10]).on("zoom",function(){a.zoomed(a._zoom,t.event.translate,t.event.scale)}),i.call(this._zoom),this._cloud=(new n).canvas(this._canvas),this.tooltipHTML(function(t){var e=a.columns(),o=e&&e.length?e[0]:"Word";return a.tooltipFormat({label:t.__viz_0,series:o,value:t.__viz_1})})},a.prototype.update=function(o,i){function n(t,e){var o=a._root.selectAll("text").data(t,function(t){return t.__viz_0?t.__viz_0.toLowerCase():""});o.enter().append("text").attr("text-anchor","middle").text(function(t){return t.__viz_0}).on("click",function(t){a.click({label:t.__viz_0,weight:t.__viz_1})}).on("dblclick",function(t){a.dblclick({label:t.__viz_0,weight:t.__viz_1})}).on("mouseout.tooltip",a.tooltip.hide).on("mousemove.tooltip",a.tooltip.show).style("opacity",1e-6),o.style("font-size",function(t){return r(t.__viz_1)+"px"}).style("font-family",a.fontFamily()).transition().duration(1e3).attr("transform",function(t){return"translate("+[t.x,t.y]+")rotate("+t.rotate+")"}).style("fill",function(t){return a._palette(t.__viz_0?t.__viz_0.toLowerCase():"")}).style("opacity",1),o.exit().transition().duration(1e3).style("opacity",1e-4).remove()}e.prototype.update.apply(this,arguments),this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this.zoomed(this,[this.offsetX(),this.offsetY()],this.zoom());var a=this,s=t.extent(this._vizData,function(t){return t.__viz_1}),r=t.scale[this.scaleMode()]().domain(s).range([this.fontSizeFrom(),this.fontSizeTo()]),l=t.scale.linear().domain([0,a.angleCount()-1]).range([a.angleFrom(),a.angleTo()]);this._cloud.stop().size([this.width(),this.height()]).words(this._vizData).font(this.fontFamily()).padding(this.padding()).spiral(this.spiral()).text(function(t){return t.__viz_0}).fontSize(function(t){return r(t.__viz_1)}).rotate(function(){return l(~~(Math.random()*a.angleCount()))}).on("end",n).start()},a.prototype.zoomed=function(t,e,o){if(e[0]!==this._prevOffsetX||e[1]!==this._prevOffsetY||o!==this._prevZoom){switch(this._root.attr("transform","translate("+e[0]+","+e[1]+")scale("+o+")"),t){case this:this._zoom.scale(o).translate(e);break;case this._zoom:this.offsetX(e[0]),this.offsetY(e[1]),this.zoom(o)}this._prevOffsetX=e[0],this._prevOffsetY=e[1],this._prevZoom=o}},a});