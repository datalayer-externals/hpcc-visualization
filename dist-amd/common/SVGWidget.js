!function(t,e){"function"==typeof define&&define.amd?define(["d3","./Widget","./Transition"],e):t.common_SVGWidget=e(t.d3,t.common_Widget,t.common_Transition)}(this,function(t,e,i){function n(){e.call(this),this._tag="g",this._boundingBox=null,this.transition=new i(this),this._drawStartPos="center"}n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype._class+=" common_SVGWidget",n.prototype.move=function(t,e){var i=this.pos.apply(this,arguments);return arguments.length&&(e?this._element.transition().duration(e):this._element).attr("transform","translate("+t.x+" "+t.y+")"),i},n.prototype.size=function(t){var i=e.prototype.size.apply(this,arguments);return arguments.length&&(this._boundingBox=null),i},n.prototype.resize=function(t){var i=e.prototype.resize.apply(this,arguments);if(this._parentRelativeDiv)switch(this._parentRelativeDiv.style({width:this._size.width+"px",height:this._size.height+"px"}),this._drawStartPos){case"origin":this.pos({x:0,y:0});break;case"center":default:this.pos({x:this._size.width/2,y:this._size.height/2})}return this._parentElement.attr("width",this._size.width).attr("height",this._size.height),i},n.prototype.target=function(e){if(!arguments.length)return this._target;if(this._target&&e&&this._target.__data__.id!==e.__data__.id)throw"Target can only be assigned once.";return this._target=e,("string"==typeof this._target||this._target instanceof String)&&(this._target=document.getElementById(this._target)),this._target instanceof SVGElement?(this._parentElement=t.select(this._target),this._parentWidget=this._parentElement.datum(),this._parentWidget&&this._parentWidget._id!==this._id||(this._parentWidget=this.locateParentWidget(this._target.parentNode)),this._parentOverlay=this.locateOverlayNode()):this._target?(this._parentRelativeDiv=t.select(this._target).append("div").style({position:"relative"}),this._parentElement=this._parentRelativeDiv.append("svg").style({position:"absolute",top:0,left:0}),this._parentOverlay=this._parentRelativeDiv.append("div").style({position:"absolute",top:0,left:0}),this.resize(this._size)):this.exit(),this},n.prototype.enter=function(t,i){e.prototype.enter.apply(this,arguments)},n.prototype.update=function(t,i){e.prototype.update.apply(this,arguments)},n.prototype.postUpdate=function(t,i){e.prototype.postUpdate.apply(this,arguments),"origin"===this._drawStartPos&&this._target instanceof SVGElement?this._element.attr("transform","translate("+(this._pos.x-this._size.width/2)+","+(this._pos.y-this._size.height/2)+")scale("+this._scale+")"):this._element.attr("transform","translate("+this._pos.x+","+this._pos.y+")scale("+this._scale+")")},n.prototype.exit=function(t,i){this._parentRelativeDiv&&(this._parentOverlay.remove(),this._parentElement.remove(),this._parentRelativeDiv.remove()),e.prototype.exit.apply(this,arguments)},n.prototype.getOffsetPos=function(){var t={x:0,y:0};return this._parentWidget?(t=this._parentWidget.getOffsetPos(),t.x+=this._pos.x,t.y+=this._pos.y,t):t},n.prototype.getBBox=function(t,e){if(t||null===this._boundingBox){var i=this._element.node();i instanceof SVGElement&&(this._boundingBox=i.getBBox())}return null===this._boundingBox?{x:0,y:0,width:0,height:0}:{x:(e?Math.round(this._boundingBox.x):this._boundingBox.x)*this._scale,y:(e?Math.round(this._boundingBox.y):this._boundingBox.y)*this._scale,width:(e?Math.round(this._boundingBox.width):this._boundingBox.width)*this._scale,height:(e?Math.round(this._boundingBox.height):this._boundingBox.height)*this._scale}},n.prototype.intersection=function(t,e){return this.intersectRect(t,e)};var s=function(t,e,i){return{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}},r=function(t,e,i,n){var s={type:"",points:[]},r=(n.x-i.x)*(t.y-i.y)-(n.y-i.y)*(t.x-i.x),o=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),a=(n.y-i.y)*(e.x-t.x)-(n.x-i.x)*(e.y-t.y);if(0!==a){var h=r/a,p=o/a;h>=0&&1>=h&&p>=0&&1>=p?(s.type="Intersection",s.points.push({x:t.x+h*(e.x-t.x),y:t.y+h*(e.y-t.y)})):s.type="No Intersection"}else 0===r||0===o?s.type="Coincident":s.type="Parallel";return s};n.prototype.intersectRect=function(t,e){var i=this.getOffsetPos(),n=this.getBBox();if(t.x===e.x&&t.y===e.y)return t;var s={x:i.x-n.width/2,y:i.y-n.height/2},o={x:i.x+n.width/2,y:i.y-n.height/2},a={x:i.x+n.width/2,y:i.y+n.height/2},h={x:i.x-n.width/2,y:i.y+n.height/2},p=r(s,o,t,e);return p.points.length?{x:p.points[0].x,y:p.points[0].y}:(p=r(o,a,t,e),p.points.length?{x:p.points[0].x,y:p.points[0].y}:(p=r(a,h,t,e),p.points.length?{x:p.points[0].x,y:p.points[0].y}:(p=r(h,s,t,e),p.points.length?{x:p.points[0].x,y:p.points[0].y}:null)))};var o=function(t,e,i,n){var r={type:"",points:[]},o=(n.x-i.x)*(n.x-i.x)+(n.y-i.y)*(n.y-i.y),a=2*((n.x-i.x)*(i.x-t.x)+(n.y-i.y)*(i.y-t.y)),h=t.x*t.x+t.y*t.y+i.x*i.x+i.y*i.y-2*(t.x*i.x+t.y*i.y)-e*e,p=a*a-4*o*h;if(0>p)r.type="Outside";else if(0===p)r.type="Tangent";else{var y=Math.sqrt(p),u=(-a+y)/(2*o),l=(-a-y)/(2*o);(0>u||u>1)&&(0>l||l>1)?0>u&&0>l||u>1&&l>1?r.type="Outside":r.type="Inside":(r.type="Intersection",u>=0&&1>=u&&r.points.push(s(i,n,u)),l>=0&&1>=l&&r.points.push(s(i,n,l)))}return r};return n.prototype.intersectCircle=function(t,e){var i=this.getOffsetPos(),n=this.radius(),s=o(i,n,t,e);return s.points.length?{x:s.points[0].x,y:s.points[0].y}:null},n.prototype.distance=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},n.prototype._pushMarkers=function(t,e){this.svgMarkerGlitch&&(t=t||this._element,t.selectAll("path[marker-start],path[marker-end]").attr("fixme-start",function(t){return this.getAttribute("marker-start")}).attr("fixme-end",function(t){return this.getAttribute("marker-end")}).attr("marker-start",null).attr("marker-end",null))},n.prototype._popMarkers=function(t,e){this.svgMarkerGlitch&&(t=t||this._element,t.selectAll("path[fixme-start],path[fixme-end]").attr("marker-start",function(t){return this.getAttribute("fixme-start")}).attr("marker-end",function(t){return this.getAttribute("fixme-end")}).attr("fixme-start",null).attr("fixme-end",null))},n.prototype._popMarkersDebounced=e.prototype.debounce(function(t,e){this.svgMarkerGlitch&&this._popMarkers(t,e)},250),n.prototype._fixIEMarkers=function(t,e){this.svgMarkerGlitch&&(this._pushMarkers(t,e),this._popMarkersDebounced(t,e))},n});