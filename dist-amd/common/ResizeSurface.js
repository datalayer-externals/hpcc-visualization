!function(t,e){"function"==typeof define&&define.amd?define(["d3","./Surface","css!./ResizeSurface"],e):t.common_ResizeSurface=e(t.d3,t.common_Surface)}(this,function(t,e){function i(){e.call(this),this.handleWidth=8,this.handles=[{loc:"NW"},{loc:"N"},{loc:"NE"},{loc:"E"},{loc:"SE"},{loc:"S"},{loc:"SW"},{loc:"W"}];var i=this;this.dispatch=t.dispatch("sizestart","size","sizeend"),this.drag=t.behavior.drag().origin(function(t){return t}).on("dragstart",function(e){i.dispatch.sizestart(i,e.loc),i.allowResize()&&(t.event.sourceEvent.stopPropagation(),i._dragHandlePos={x:e.x,y:e.y},i._dragStartPos=i.pos(),i._dragStartSize=i.size(),i._prevPosSize={x:i._dragStartPos.x,y:i._dragStartPos.y,width:i._dragStartSize.width,height:i._dragStartSize.height},i._textPosSize=i._text.getBBox(!0),i._iconPosSize=i._icon.getBBox(!0),i.showContent(!1))}).on("drag",function(e){if(i.allowResize()){t.event.sourceEvent.stopPropagation();var h=t.event.x-i._dragHandlePos.x,a=t.event.y-i._dragHandlePos.y,d={x:0,y:0,w:0,h:0};switch(e.loc){case"NW":d.x=h/2,d.w=-h;case"N":d.y=a/2,d.h=-a;break;case"NE":d.y=a/2,d.h=-a;case"E":d.x=h/2,d.w=h;break;case"SE":d.x=h/2,d.w=h;case"S":d.y=a/2,d.h=a;break;case"SW":d.y=a/2,d.h=a;case"W":d.x=h/2,d.w=-h}var o={x:i._dragStartPos.x+d.x,y:i._dragStartPos.y+d.y,width:i._dragStartSize.width+d.w,height:i._dragStartSize.height+d.h};o.width<2*i._iconPosSize.width+i._textPosSize.width&&(o.x=i._prevPosSize.x,o.width=i._prevPosSize.width),o.height<i._textPosSize.height+48&&(o.y=i._prevPosSize.y,o.height=i._prevPosSize.height),i.pos({x:o.x,y:o.y},!1,!1).size({width:o.width,height:o.height}).render().getBBox(!0),i.dispatch.size(i,e.loc),i._prevPosSize=o}}).on("dragend",function(e){i.allowResize()&&(t.event.sourceEvent.stopPropagation(),i.showContent(!0).render(),i._container.getBBox(!0),i._titleRect.getBBox(!0),i.dispatch.sizeend(i,e.loc))})}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._class+=" common_ResizeSurface",i.prototype.publish("allowResize",!0,"boolean","Sets if surface can be resized",null,{tags:["Private","Shared"]}),i.prototype.move=function(t){var i=e.prototype.move.apply(this,arguments);return this.updateHandles(this._domNode,this._element),i},i.prototype.update=function(t,i){e.prototype.update.apply(this,arguments),this.updateHandles(t,i)},i.prototype.updateHandles=function(e,i){var h=this._parentElement.selectAll("rect").data(this.handles,function(t){return t.loc});h.enter().append("rect").attr("class",function(t){return"resize"+t.loc}).call(this.drag);var a=this._pos.x+this._container._pos.x-this._container.width()/2,d=this._pos.y+this._titleRect._pos.y-this._titleRect.height()/2,o=this._pos.x+this._container._pos.x+this._container.width()/2,n=this._pos.y+this._container._pos.y+this._container.height()/2,s=o-a,r=n-d,c=this;h.each(function(e){switch(e.loc){case"NW":e.x=a-c.handleWidth/2,e.y=d-c.handleWidth/2,e.width=c.handleWidth,e.height=c.handleWidth;break;case"N":e.x=a+c.handleWidth/2,e.y=d-c.handleWidth/2,e.width=s-c.handleWidth,e.height=c.handleWidth;break;case"NE":e.x=o-c.handleWidth/2,e.y=d-c.handleWidth/2,e.width=c.handleWidth,e.height=c.handleWidth;break;case"E":e.x=o-c.handleWidth/2,e.y=d+c.handleWidth/2,e.width=c.handleWidth,e.height=r-c.handleWidth;break;case"SE":e.x=o-c.handleWidth/2,e.y=n-c.handleWidth/2,e.width=c.handleWidth,e.height=c.handleWidth;break;case"S":e.x=a+c.handleWidth/2,e.y=n-c.handleWidth/2,e.width=s-c.handleWidth,e.height=c.handleWidth;break;case"SW":e.x=a-c.handleWidth/2,e.y=n-c.handleWidth/2,e.width=c.handleWidth,e.height=c.handleWidth;break;case"W":e.x=a-c.handleWidth/2,e.y=d+c.handleWidth/2,e.width=c.handleWidth,e.height=r-c.handleWidth}t.select(this).attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height)})},i});