!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","../api/IInput","../chart/Axis","../common/Icon","css!./Slider"],e):t.form_Slider=e(t.d3,t.common_SVGWidget,t.api_IInput,t.chart_Axis,t.common_Icon)}(this,function(t,e,i,s,o){function a(){e.call(this),i.call(this),this.selectionLabel(""),this._playing=!1,this._loop=!1,this.axis=new s;var a=this;this._playIcon=(new o).faChar(""),this._playIcon.click=function(e){t.event.stopPropagation(),a._playing?a.pause():a.play()},this._loopIcon=(new o).faChar("").image_colorFill(this._loop?null:"#bbb").shape_colorFill(this._loop?null:"white").paddingPercent(33),this._loopIcon.click=function(t){a._loop?a._loop=!1:a._loop=!0,a._loopIcon.image_colorFill(a._loop?null:"#bbb").shape_colorFill(a._loop?null:"white").render()},this.brush=t.svg.brush().extent([0,0]).on("brushstart",function(t){a.brushstart(t,this)}).on("brush",function(t){a.brushmove(t,this)}).on("brushend",function(t){a.brushend(t,this)}),this.brush.empty=function(){return!1},this._inputElement=[]}a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.prototype._class+=" form_Slider",a.prototype["implements"](i.prototype),a.prototype.publish("padding",16,"number","Outer Padding",null,{tags:["Basic"]}),a.prototype.publish("fontSize",null,"number","Font Size",null,{tags:["Basic"]}),a.prototype.publish("fontFamily",null,"string","Font Name",null,{tags:["Basic"]}),a.prototype.publish("fontColor",null,"html-color","Font Color",null,{tags:["Basic"]}),a.prototype.publish("allowRange",!1,"boolean","Allow Range Selection",null,{tags:["Intermediate"]}),a.prototype.publish("low","0","string","Low",null,{tags:["Intermediate"]}),a.prototype.publish("high","100","string","High",null,{tags:["Intermediate"]}),a.prototype.publish("step",10,"number","Step",null,{tags:["Intermediate"]}),a.prototype.publish("selectionLabel","","string","Selection Label",null,{tags:["Intermediate"]}),a.prototype.publishProxy("tickCount","axis","tickCount"),a.prototype.publishProxy("tickFormat","axis","tickFormat"),a.prototype.publishProxy("type","axis"),a.prototype.publishProxy("timePattern","axis"),a.prototype.publishProxy("powExponent","axis","powExponent"),a.prototype.publishProxy("logBase","axis","logBase"),a.prototype.publishProxy("overlapMode","axis"),a.prototype.publishProxy("labelRotation","axis"),a.prototype.publish("showPlay",!1,"boolean","Show Play Button"),a.prototype.publish("playInterval",1e3,"number","Play Interval"),a.prototype.publishProxy("playDiameter","_playIcon","diameter",32),a.prototype.publish("playGutter",4,"number","Play Gutter"),a.prototype.publishProxy("loopDiameter","_loopIcon","diameter",24),a.prototype.publish("loopGutter",4,"number","Play Gutter"),a.prototype.name=function(t){return a.prototype.columns.apply(this,arguments)};var r=a.prototype.value;return a.prototype.value=function(t){var i=r.apply(this,arguments);return arguments.length&&e.prototype.data.apply(this,arguments),i},a.prototype.play=function(){this._playing=!0,this._playIcon.faChar("").render();var t=this.data();(t<this.low()||t>=this.high())&&(t=this.low(),this.data(t).render(),this._click());var e=this;this.intervalHandler=setInterval(function(){t+=e.step(),t>e.high()?e._loop===!0?(t=e.low(),e.data(t).render(),e._click()):e.pause():(e.data(t).render(),e._click())},e.playInterval())},a.prototype.pause=function(){this._playing=!1,this._playIcon.faChar("").render(),clearInterval(this.intervalHandler)},a.prototype.data=function(t){var i=e.prototype.data.apply(this,arguments);return arguments.length&&this.brushg&&this.brushg.call(this.brush.extent(this.allowRange()?this.data():[this.data(),this.data()])),i},a.prototype.enter=function(t,e){this.sliderElement=e.append("g"),this._inputElement.push(this.sliderElement),this.axis.target(this.sliderElement.node()).x(this.width()).y(0).width(this.width()-this.padding()).low(this.low()).high(this.high()).render(),this.axis.d3Axis.tickSize(0).tickPadding(12),this.brushg=this.sliderElement.append("g").attr("class","brush").call(this.brush),this.brushg.select(".background").attr("y",-9).attr("height",18),this.brushg.select(".extent").attr("y","-10").attr("height","20"),this.brushg.selectAll(".resize").select("rect").attr("x",function(t){return"e"===t?0:-8}).attr("y","-10").attr("width","8").attr("height","20"),this.handle=this.brushg.selectAll(".resize").append("path").attr("class","handle").attr("transform","translate(0,-27)"),this._playIcon.target(this.sliderElement.node()).render(),this._loopIcon.target(this.sliderElement.node()).render()},a.prototype.update=function(t,e){var i=this,s=this.width()-this.padding()/2;this._playIcon.pos({x:s-(this.loopDiameter()+this.loopGutter()+this.playDiameter()/2),y:0}).diameter(this.playDiameter()).display(this.showPlay()).render(),this._loopIcon.pos({x:s-this.loopDiameter()/2,y:0}).diameter(this.loopDiameter()).display(this.showPlay()).render(),(this.high()-this.low())/this.step()<=10;var o=this.showPlay()?this.loopDiameter()+this.loopGutter()+this.playDiameter()+this.playGutter():0;s-=o;var a=this.axis.calcOverflow(e);this.axis.x(this.width()/2-o/2).y(a.depth).width(this.width()-this.padding()-o).low(this.low()).high(this.high()).render(),this.brushg.attr("transform","translate("+this.padding()/2+", 0)"),this.handle.attr("d",function(t){return i.handlePath(t)}),0===this.data().length&&(this.allowRange()?this.data([this.low(),this.low()]):this.data(this.low())),this.axis.d3Scale.clamp(!0),this.brush.x(this.axis.d3Scale),this.brushg.call(this.brush.extent(this.allowRange()?this.data():[this.data(),this.data()]));var r=this.sliderElement.node().getBBox();this.sliderElement.attr("transform","translate("+-this.width()/2+", "+-(r.y+r.height/2)+")")},a.prototype.brushstart=function(e,i){t.event&&t.event.sourceEvent&&t.event.sourceEvent.stopPropagation()},a.prototype.brushmove=function(e,i){if(t.event&&t.event.sourceEvent&&(t.event.sourceEvent.stopPropagation(),!this.allowRange())){var s=this.axis.invert(t.mouse(i)[0]);t.select(i).call(this.brush.extent([s,s]))}},a.prototype.brushend=function(e,i){if(t.event&&t.event.sourceEvent)if(t.event.sourceEvent.stopPropagation(),this.allowRange()){var s=this.brush.extent();s[0]=this.nearestStep(s[0]),s[1]=this.nearestStep(s[1]),t.select(i).call(this.brush.extent(s)),this.newSelection(this.axis.parseInvert(s[0]),this.axis.parseInvert(s[1]))}else{var o=this.nearestStep(this.axis.invert(t.mouse(i)[0]));t.select(i).call(this.brush.extent([o,o])),this.value(this.axis.parseInvert(o)),this._click()}},a.prototype.nearestStep=function(t){switch(this.type()){case"time":return t;default:return+this.axis.parse(this.low())+Math.round((t-+this.axis.parse(this.low()))/+this.step())*+this.step()}},a.prototype.handlePath=function(t,e){var i=+("e"===t),s=i?1:-1,o=this.allowRange()?.5:0,a=18,r="M"+o*s+","+a+"A6,6 0 0 "+i+" "+6.5*s+","+(a+6)+"V"+(2*a-6)+"A6,6 0 0 "+i+" "+o*s+","+2*a;return r+=this.allowRange()?"ZM"+2.5*s+","+(a+8)+"V"+(2*a-8)+"M"+4.5*s+","+(a+8)+"V"+(2*a-8):"M"+1*s+","+(a+8)+"V"+(2*a-8)},a.prototype._click=function(){if(this.selectionLabel()){var t={};t[this.selectionLabel()]=this.data(),this.click(t)}else this.click(this.data())},a.prototype.newSelection=function(t,e){console.log("newSelection:  "+t+", "+e)},a});