!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/HTMLWidget","amcharts-serial","require","../common/Utility","./SerialAxis","../api/ITooltip"],e):t.amchart_CommonSerial=e(t.d3,t.common_HTMLWidget,t.AmCharts,t.require,t.common_Utility,t.amchart_SerialAxis,t.api_ITooltip)}(this,function(t,e,i,a,s,o,r){function l(){e.call(this),this._tag="div",this._chart={},this._selected=null,this._selections=[],this._dataUpdated=0,this._prevDataUpdated=-1,this._columnsUpdated=0,this._prevColumnsUpdated=-1,this._dateParserData=t.time.format("%Y-%m-%d").parse,this._dateParserValue=t.time.format("%Y-%m-%d").parse,this._colorObj={},this._selectionObj={},this._xAxis=new o,this._xAxis.owningWidget=this,this._yAxis=new o,this._yAxis.owningWidget=this}return l.prototype=Object.create(e.prototype),l.prototype.constructor=l,l.prototype._class+=" amchart_CommonSerial",l.prototype["implements"](r.prototype),l.prototype.publish("backwardsCompatible",!0,"boolean","Allow use of old publish parameters"),l.prototype.publish("xAxes",[],"propertyArray","xAxis",null,{max:1,tags:["Basic"]}),l.prototype.publish("yAxes",[],"propertyArray","yAxis",null,{tags:["Basic"]}),l.prototype.publish("fontSize",11,"number","Font Size",null,{tags:["Basic","Shared"]}),l.prototype.publish("fontFamily","Verdana","string","Font Name",null,{tags:["Basic","Shared","Shared"]}),l.prototype.publish("fontColor","#000000","html-color","Font Color",null,{tags:["Basic","Shared"]}),l.prototype.publish("lineWidth",1,"number","Line Thickness",null,{min:0,max:10,step:1,inputType:"range",tags:["Basic","Shared"]}),l.prototype.publish("lineColor",null,"html-color","Color of the data/content lines",null,{tags:["Basic","Shared"]}),l.prototype.publish("lineOpacity",1,"number","Line Opacity",null,{min:0,max:1,step:.001,inputType:"range",tags:["Basic","Shared"]}),l.prototype.publish("dashedLineStyle",0,"number","Length of Dashed Line. 0 = none",null,{tags:["Advanced","Shared"]}),l.prototype.publish("marginLeft",null,"number","Margin (Left)",null,{tags:["Intermediate"]}),l.prototype.publish("marginRight",null,"number","Margin (Right)",null,{tags:["Intermediate"]}),l.prototype.publish("marginTop",null,"number","Margin (Top)",null,{tags:["Intermediate"]}),l.prototype.publish("marginBottom",null,"number","Margin (Bottom)",null,{tags:["Intermediate"]}),l.prototype.publish("showScrollbar",!1,"boolean","Show Chart Scrollbar",null,{tags:["Intermediate","Shared"]}),l.prototype.publish("orientation","horizontal","set","Orientation",["horizontal","vertical"],{tags:["Intermediate"]}),l.prototype.publish("startDuration",.3,"number","Start Duration (sec)",null,{tags:["Private"]}),l.prototype.publish("useImgPatterns",!1,"boolean","Enable Image Pattern backgrounds",null,{tags:["Private"]}),l.prototype.publish("imgPatternArr",'["../ampatterns/black/pattern2.png"]',"string","Background Pattern Images (Not used if '[]')",null,{inputType:"textarea",tags:["Private"]}),l.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),l.prototype.publish("axisMinPeriod","MM","string","Minimum period when parsing dates"),l.prototype.publish("selectionColor","#f00","html-color","Font Color",null,{tags:["Basic"]}),l.prototype.publish("selectionMode","simple","set","Selection Mode",["simple","multi"],{tags:["Intermediate"]}),l.prototype.publish("showCursor",!1,"boolean","Show Chart Scrollbar",null,{tags:["Intermediate","Shared"]}),l.prototype.publish("showFirstLabel",!0,"boolean","Show first label",null,{tags:["Intermediate","Shared"]}),l.prototype.publish("showLastLabel",!0,"boolean","Show last label",null,{tags:["Intermediate","Shared"]}),l.prototype.publish("equalSpacing",!1,"boolean","Show Chart Scrollbar",null,{tags:["Intermediate","Shared"]}),l.prototype.publish("paletteGrouping","By Column","set","Palette Grouping",["By Category","By Column"],{tags:["Basic"]}),l.prototype.publish("y2",[],"array","Columns to associate with second Y-Axis"),l.prototype.publish("axisLineWidth",1,"number","Axis Line Width",null,{tags:["Intermediate","Shared"]}),l.prototype.publish("axisAlpha",1,"number","Axis Alpha",null,{tags:["Intermediate"]}),l.prototype.publish("startOnAxis",!0,"boolean","Draw Chart Starting On Axis.",null,{tags:["Intermediate"]}),l.prototype.publish("xAxisShowAllLabels",!1,"boolean","show All Category Axis Labels",null,{tags:["Intermediate"]}),l.prototype.publish("axisFontSize",null,"number","X/Y Axis Text Font Size",null,{tags:["Basic","Shared"]}),l.prototype.publishProxy("xAxisBaselineColor","_xAxis","axisBaselineColor"),l.prototype.publishProxy("yAxisBaselineColor","_yAxis","axisBaselineColor"),l.prototype.publishProxy("xAxisFontColor","_xAxis","axisFontColor"),l.prototype.publishProxy("yAxisFontColor","_yAxis","axisFontColor"),l.prototype.publishProxy("xAxisTitle","_xAxis","axisTitle"),l.prototype.publishProxy("yAxisTitle","_yAxis","axisTitle"),l.prototype.publishProxy("xAxisTitleFontSize","_xAxis","axisTitleFontSize"),l.prototype.publishProxy("yAxisTitleFontSize","_yAxis","axisTitleFontSize"),l.prototype.publishProxy("xAxisTitleFontColor","_xAxis","axisTitleFontColor"),l.prototype.publishProxy("yAxisTitleFontColor","_yAxis","axisTitleFontColor"),l.prototype.publishProxy("xAxisLabelRotation","_xAxis","axisLabelRotation"),l.prototype.publishProxy("yAxisLabelRotation","_yAxis","axisLabelRotation"),l.prototype.publishProxy("xAxisAutoGridCount","_xAxis","axisAutoGridCount"),l.prototype.publishProxy("yAxisAutoGridCount","_yAxis","axisAutoGridCount"),l.prototype.publishProxy("xAxisGridPosition","_xAxis","axisGridPosition"),l.prototype.publishProxy("xAxisBoldPeriodBeginning","_xAxis","axisBoldPeriodBeginning"),l.prototype.publishProxy("yAxisBoldPeriodBeginning","_yAxis","axisBoldPeriodBeginning"),l.prototype.publishProxy("xAxisDashLength","_xAxis","axisDashLength"),l.prototype.publishProxy("yAxisDashLength","_yAxis","axisDashLength"),l.prototype.publishProxy("xAxisFillAlpha","_xAxis","axisFillAlpha"),l.prototype.publishProxy("yAxisFillAlpha","_yAxis","axisFillAlpha"),l.prototype.publishProxy("xAxisFillColor","_xAxis","axisFillColor"),l.prototype.publishProxy("yAxisFillColor","_yAxis","axisFillColor"),l.prototype.publishProxy("xAxisGridAlpha","_xAxis","axisGridAlpha"),l.prototype.publishProxy("yAxisGridAlpha","_yAxis","axisGridAlpha"),l.prototype.publishProxy("xAxisTypeTimePattern","_xAxis","axisTypeTimePattern"),l.prototype.publishProxy("yAxisTypeTimePattern","_yAxis","axisTypeTimePattern"),l.prototype.publishProxy("xAxisType","_xAxis","axisType"),l.prototype.publishProxy("yAxisType","_yAxis","axisType"),l.prototype.publishProxy("xAxisTickFormat","_xAxis","axisTickFormat"),l.prototype.publishProxy("yAxisTickFormat","_yAxis","axisTickFormat"),l.prototype._origBackwardsCompatible=l.prototype.backwardsCompatible,l.prototype.backwardsCompatible=function(t){var e=l.prototype._origBackwardsCompatible.apply(this,arguments);return arguments.length&&this.switchProperties(t),e},l.prototype.switchProperties=function(t){t===!0?l.prototype.excludeObjs=["amchart_SerialAxis"]:l.prototype.excludeObjs=[]},l.prototype.xAxis=function(t){if(!this.xAxes()[t]){var e=new o;e._owningWidget=this,this.xAxes()[t]=e}return this.xAxes()[t]},l.prototype.yAxis=function(t){if(!this.yAxes()[t]){var e=new o;e._owningWidget=this,this.yAxes()[t]=e}return this.yAxes()[t]},l.prototype.formatData=function(t){switch(this.xAxes()[0].axisType()){case"time":return this.xAxes()[0]._parser("number"==typeof t?t.toString():t);default:return t}},l.prototype.formatValue=function(t){if(!t)return t;if(t instanceof Array)return t.map(function(t){return this.formatValue(t)},this);switch(this.yAxes()[0].axisType()){case"time":return this.yAxes()[0]._parser("number"==typeof t?t.toString():t);default:return"string"==typeof t?+t:t}},l.prototype.amFormatData=function(t){this._rangeType=null;var e=[],i=this;if(t.forEach(function(t){var a={};t.forEach(function(t,e){var s=i.columns()[e];if(t instanceof Array){var o=e-1;2===t.length?(a["openField"+o]=i.formatValue(t[0]),a["valueField"+o]=i.formatValue(t[1]),i._rangeType="normal"):(a["lowField"+o]=i.formatValue(t[0]),a["openField"+o]=i.formatValue(t[1]),a["closeField"+o]=i.formatValue(t[2]),a["highField"+o]=i.formatValue(t[3]),i._rangeType="candle-ohlc")}else 0===e?a[s]=i.formatData(t):e>=i.columns().length?a[s]=t:a[s]=i.formatValue(t)}),a.__origRow=t,e.push(a)}),"time"===this.xAxisType()){var a=i.columns()[0];e.sort(function(t,e){return t[a]-e[a]}),this.data(e.map(function(t){var e=t.__origRow;return delete t.__origRow,e}))}return e},l.prototype.updateChartOptions=function(){var e=this;this._chart.type="serial",this._chart.startDuration=this.startDuration(),this._chart.rotate="vertical"===this.orientation(),this._chart.color=this.fontColor(),this._chart.fontSize=this.fontSize(),this._chart.fontFamily=this.fontFamily(),this._chart.categoryAxis={};var a=this.xAxes()[0];switch(this._chart.categoryAxis.position=a.position()?a.position():"bottom",this._chart.categoryAxis.autoGridCount=a.axisAutoGridCount(),this._chart.categoryAxis.gridPosition=a.axisGridPosition(),this._chart.categoryAxis.axisAlpha=a.axisAlpha(),this._chart.categoryAxis.gridAlpha=a.axisGridAlpha(),this._chart.categoryAxis.startOnAxis=a.startOnAxis(),this._chart.categoryAxis.labelRotation=a.axisLabelRotation(),this._chart.categoryAxis.title=a.axisTitle(),this._chart.categoryAxis.axisColor=a.axisBaselineColor(),this._chart.categoryAxis.axisThickness=a.axisLineWidth(),this._chart.categoryAxis.boldPeriodBeginning=a.axisBoldPeriodBeginning(),this._chart.categoryAxis.dashLength=a.axisDashLength(),this._chart.categoryAxis.fillAlpha=a.axisFillAlpha(),this._chart.categoryAxis.fillColor=a.axisFillColor(),this._chart.categoryAxis.fontSize=a.axisFontSize(),this._chart.categoryAxis.color=a.axisFontColor(),this._chart.categoryAxis.titleColor=a.axisTitleFontColor(),this._chart.categoryAxis.titleFontSize=a.axisTitleFontSize(),this._chart.categoryAxis.showFirstLabel=this.showFirstLabel(),this._chart.categoryAxis.showLastLabel=this.showLastLabel(),this._chart.categoryAxis.equalSpacing=this.equalSpacing(),a.axisType()){case"time":this._chart.categoryAxis.parseDates=!0,this._chart.categoryAxis.minPeriod=this.axisMinPeriod()?this.axisMinPeriod():void 0,this._chart.categoryAxis.logarithmic=!1,a.axisTickFormat()?this.dataFormatter=t.time.format(a.axisTickFormat()):a.axisTypeTimePattern()?this.dataFormatter=t.time.format(a.axisTypeTimePattern()):this.dataFormatter=function(t){return t};break;case"log":this._chart.categoryAxis.parseDates=!1,this._chart.categoryAxis.logarithmic=!0,this.dataFormatter=a.axisTickFormat()?t.format(a.axisTickFormat()):function(t){return t};break;case"linear":default:this._chart.categoryAxis.parseDates=!1,this._chart.categoryAxis.logarithmic=!1,this.dataFormatter=a.axisTickFormat()?t.format(a.axisTickFormat()):function(t){return t}}this._chart.categoryAxis.labelFunction=function(t,i,s){switch(a.axisType()){case"time":return e.dataFormatter(a.axisTickFormat()||a.axisTypeTimePattern()?new Date(i):i);default:return e.dataFormatter(t)}};for(var s=0;s<this.yAxes().length;s++){var o=this.yAxes()[s];this._chart.valueAxes[s]||this._chart.valueAxes.push(new i.ValueAxis),this._chart.valueAxes[s].id="v"+s,this._chart.valueAxes[s].position=o.position()?o.position():"left",this._chart.valueAxes[s].title=o.axisTitle(),this._chart.valueAxes[s].titleColor=o.axisTitleFontColor(),this._chart.valueAxes[s].titleFontSize=o.axisTitleFontSize(),this._chart.valueAxes[s].axisThickness=o.axisLineWidth(),this._chart.valueAxes[s].color=o.axisFontColor(),this._chart.valueAxes[s].fontSize=o.axisFontSize(),this._chart.valueAxes[s].axisColor=o.axisBaselineColor(),this._chart.valueAxes[s].axisAlpha=o.axisAlpha(),this._chart.valueAxes[s].fillColor=o.axisFillColor(),this._chart.valueAxes[s].fillAlpha=o.axisFillAlpha(),this._chart.valueAxes[s].gridAlpha=o.axisGridAlpha(),this._chart.valueAxes[s].dashLength=o.axisDashLength(),this._chart.valueAxes[s].boldPeriodBeginning=o.axisBoldPeriodBeginning(),this._chart.valueAxes[s].autoGridCount=o.axisAutoGridCount();var r;switch(o.axisType()){case"time":this._chart.valueAxes[s].type="date",this._chart.valueAxes[s].parseDates=!0,this._chart.valueAxes[s].minPeriod=this.axisMinPeriod()?this.axisMinPeriod():void 0,this._chart.valueAxes[s].logarithmic=!1,r=o.axisTickFormat()?t.time.format(o.axisTickFormat()):o.axisTypeTimePattern()?t.time.format(o.axisTypeTimePattern()):function(t){return t};break;case"log":this._chart.valueAxes[s].parseDates=!1,this._chart.valueAxes[s].logarithmic=!0,this._chart.valueAxes[s].type="numeric",r=o.axisTickFormat()?t.format(o.axisTickFormat()):function(t){return t};break;case"linear":default:this._chart.valueAxes[s].parseDates=!1,this._chart.valueAxes[s].type="numeric",this._chart.valueAxes[s].logarithmic=!1,r=o.axisTickFormat()?t.format(o.axisTickFormat()):function(t){return t}}this._chart.valueAxes[s].labelFunction=function(t,e){return function(i,a,s){switch(t.axisType()){case"time":return e(t.axisTickFormat()||t.axisTypeTimePattern()?new Date(a):a);default:return e(i)}}}(o,r)}this.showScrollbar()?this._chart.chartScrollbar.enabled=!0:this._chart.chartScrollbar.enabled=!1,this.showCursor()?(this._chart.chartCursor.enabled=!0,this._chart.chartCursor.valueLineEnabled=!0,this._chart.chartCursor.valueLineBalloonEnabled=!0,this._chart.chartCursor.categoryBalloonEnabled=!0):(this._chart.chartCursor.enabled=!1,this._chart.chartCursor.valueLineEnabled=!1,this._chart.chartCursor.valueLineBalloonEnabled=!1,this._chart.chartCursor.categoryBalloonEnabled=!1),this._currXAxisTypes=this.xAxes().map(function(t){return t.axisType()}).toString(),this._currYAxisTypes=this.yAxes().map(function(t){return t.axisType()}).toString(),this._currXAxisTypeTimePatterns=this.xAxes().map(function(t){return t.axisTypeTimePattern()}).toString(),this._currYAxisTypeTimePatterns=this.yAxes().map(function(t){return t.axisTypeTimePattern()}).toString(),(this._dataUpdated>this._prevDataUpdated||this._prevYAxisType!==this._currYAxisTypes||this._prevXAxisType!==this._currXAxisTypes||this._prevXAxisTypeTimePattern!==this._currXAxisTypeTimePatterns||this._prevYAxisTypeTimePattern!==this._currYAxisTypeTimePatterns||this.paletteGrouping&&this._prevPaletteGrouping!==this.paletteGrouping()||this._columnsUpdated>this._prevColumnsUpdated)&&(this._chart.dataProvider=this.amFormatData(this.data())),this._chart.dataProvider=this.amFormatData(this.data()),this._prevDataUpdated=this._dataUpdated,this._prevColumnsUpdated=this._columnsUpdated,this._prevXAxisTypes=this._currXAxisTypes,this._prevYAxisTypes=this._currYAxisTypes,this._prevXAxisTypeTimePatterns=this._currXAxisTypeTimePatterns,this._prevYAxisTypeTimePatterns=this._currXAxisTypeTimePatterns,this.paletteGrouping&&(this._prevPaletteGrouping=this.paletteGrouping()),this.amFormatColumns(),a.axisAutoGridCount()===!1&&this.xAxisShowAllLabels()&&(this._chart.categoryAxis.gridCount=this._chart.dataProvider.length);var l,n;return this._chart.colors=[],-1!==e._class.indexOf("amchart_Area")&&(n="Area"),this._chart.dataProvider.forEach(function(t,i){e.columns().filter(function(t,e){return e>0}).forEach(function(t,a){l="By Category"===e.paletteGrouping()?e._palette(i):e._palette(t),e._chart.colors.push(l),e._chart.dataProvider[i]["color"+a]=l,"Area"!==n&&(e._chart.dataProvider[i]["linecolor"+a]=e.lineColor()?e.lineColor():l),void 0===e._colorObj[i]&&(e._colorObj[i]={}),e._colorObj[i][a]={color:l,lineColor:e.lineColor()?e.lineColor():l}})}),this._chart},l.prototype.buildGraphObj=function(e,i){var a=this,s={};s.id="g"+i,-1!==this.y2().indexOf(i)?s.valueAxis="v1":s.valueAxis="v0",s.balloonFunction=function(e){return"line"===e.graph.type?e.category+", "+a.columns()[e.graph.index+1]+": "+t.format(a.tooltipValueFormat())(a.data()[e.index][e.graph.columnIndex+1]):a&&a.tooltipValueFormat?e.category+", "+a.columns()[e.graph.columnIndex+1]+": "+t.format(a.tooltipValueFormat())(a.data()[e.index][e.graph.columnIndex+1]):e.category+", "+a.columns()[e.graph.columnIndex+1]+": "+a.data()[e.index][e.graph.columnIndex+1]},s.lineAlpha=a.lineOpacity(),s.lineColor=a.lineColor(),s.lineThickness=a.lineWidth(),s.dashLength=a.dashedLineStyle(),s.type=e,s.title="";var o=["value","open","close","high","low"];o.forEach(function(t){"undefined"!=typeof a["_"+t+"Field"]&&"undefined"!=typeof a["_"+t+"Field"][i]&&(s[t+"Field"]=a["_"+t+"Field"][i])});try{if(a.useImgPatterns()){var r=JSON.parse(a.imgPatternArr());"undefined"!=typeof r[i]&&(s.pattern=r[i])}else s.pattern=""}catch(l){console.log("e:"),console.log(l)}return s.colorField="color"+i,s.lineColorField="linecolor"+i,s.fillColorsField="fillcolor"+i,s},l.prototype.amFormatColumns=function(t){return this._categoryField=this.columns()[0],this._chart.categoryField=this.columns()[0],this._openField=[],this._closeField=[],this._valueField=this.columns().slice(1),this},l.prototype.enter=function(t,s){if(e.prototype.enter.apply(this,arguments),0===this.xAxes().length&&this.xAxes().push(this._xAxis),0===this.yAxes().length&&this.yAxes().push(this._yAxis),this.y2().length&&1===this.yAxes().length){var r=new o;r.owningWidget=this,this.yAxes().push(r)}var l=this,n={type:"serial",addClassNames:!0,chartScrollbar:{},chartCursor:{enabled:!1,valueLineEnabled:!1,valueLineBalloonEnabled:!1,categoryBalloonEnabled:!1,cursorAlpha:0,valueLineAlpha:.2,oneBalloonOnly:!0,balloonPointerOrientation:"vertical",valueBalloonsEnabled:!1}};"function"==typeof define&&define.amd&&(n.pathToImages=a.toUrl("amcharts-images")),this._chart=i.makeChart(t,n),this._chart.addListener("clickGraphItem",function(t){var e,i,a=t.graph,s=t.item.dataContext;"column"===l._gType?(e=a.fillColorsField,i=a.lineColorField):"line"===l._gType?e=a.colorField:"area"===l._gType&&(e=a.colorField);var o=!1;e&&(null!==s[e]&&void 0!==s[e]?(delete s[e],s[i]=l._colorObj[t.index][t.target.columnIndex].lineColor,"simple"===l.selectionMode()&&null!==l._selected&&(delete l._selected.data[l._selected.field],l._selected.data[l._selected.field2]=l._colorObj[l._selected.dIdx][l._selected.cIdx].lineColor)):(o=!0,s[e]=l.selectionColor(),s[i]=l.selectionColor(),"simple"===l.selectionMode()&&(null!==l._selected&&(delete l._selected.data[l._selected.field],l._selected.data[l._selected.field2]=l._colorObj[l._selected.dIdx][l._selected.cIdx].lineColor),l._selected={field:e,field2:i,data:s,dIdx:t.index,cIdx:t.target.columnIndex},l._selections.push(l._selected))),t.chart.validateData()),l.click(l.rowToObj(l.data()[t.index]),l.columns()[t.target.columnIndex+1],o)})},l.prototype.update=function(t,i){e.prototype.update.apply(this,arguments);var a=this;this.yAxes().forEach(function(t,e){0===e&&(a._yAxis=t),t._owningWidget=a}),this.xAxes().forEach(function(t,e){0===e&&(a._xAxis=t),t._owningWidget=a}),this.backwardsCompatible()?this.switchProperties(!0):this.switchProperties(!1),t.style.width=this.size().width+"px",t.style.height=this.size().height+"px",this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id()))},l.prototype.render=function(t){return e.prototype.render.apply(this,arguments)},l.prototype.data=function(t){return arguments.length&&this._dataUpdated++,e.prototype.data.apply(this,arguments)},l.prototype.columns=function(t){return arguments.length&&this._columnsUpdated++,e.prototype.columns.apply(this,arguments)},l});