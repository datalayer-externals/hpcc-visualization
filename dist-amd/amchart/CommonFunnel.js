!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/HTMLWidget","amcharts-funnel","require","../api/ITooltip"],e):t.amchart_CommonFunnel=e(t.d3,t.common_HTMLWidget,t.AmCharts,t.require,t.api_ITooltip)}(this,function(t,e,a,i,o){function s(){e.call(this),this._tag="div",this._chart={},this._selected=null,this._selections=[],this._dataUpdated=0,this._prevDataUpdated=-1,this._columnsUpdated=0,this._prevColumnsUpdated=-1}return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,s.prototype._class+=" amchart_CommonFunnel",s.prototype["implements"](o.prototype),s.prototype.publish("fontSize",11,"number","Font Size",null,{tags:["Basic","Shared"]}),s.prototype.publish("fontFamily","Verdana","string","Font Name",null,{tags:["Basic","Shared","Shared"]}),s.prototype.publish("fontColor","#000000","html-color","Font Color",null,{tags:["Basic","Shared"]}),s.prototype.publish("flip",!0,"boolean","Flip Chart",null,{tags:["Intermediate"]}),s.prototype.publish("reverseDataSorting",!1,"boolean","Reverse Data Sorting",null,{tags:["Intermediate"]}),s.prototype.publish("labelPosition","center","set","Label Position",["left","right","center"],{tags:["Intermediate"]}),s.prototype.publish("showScrollbar",!1,"boolean","Show Chart Scrollbar",null,{tags:["Intermediate"]}),s.prototype.publish("startDuration",.3,"number","Start Duration (sec)",null,{tags:["Private"]}),s.prototype.publish("Depth3D",0,"number","3D Depth (px)",null,{tags:["Basic"]}),s.prototype.publish("Angle3D",0,"number","3D Angle (Deg)",null,{tags:["Basic"]}),s.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),s.prototype.publish("selectionMode","simple","set","Selection Mode",["simple","multi"],{tags:["Intermediate"]}),s.prototype.publish("selectionColor","#f00","html-color","Font Color",null,{tags:["Basic"]}),s.prototype.updateChartOptions=function(){this._chart.startDuration=this.startDuration(),this._chart.rotate=this.flip(),this._chart.pullOutOnlyOne="simple"===this.selectionMode(),this._chart.color=this.fontColor(),this._chart.colorField="sliceColor",this._chart.fontSize=this.fontSize(),this._chart.fontFamily=this.fontFamily(),this._chart.labelPosition=this.labelPosition(),this.titles=[],this.baloon={},this._chart.titleField=this.columns()[0],this._chart.valueField=this.columns()[1],this._chart.depth3D=this.Depth3D(),this._chart.angle=this.Angle3D();var t=function(t,e){return t[1]>e[1]?1:-1};return this.reverseDataSorting()&&(t=function(t,e){return t[1]<e[1]?1:-1}),this.data().sort(t),(this._dataUpdated>this._prevDataUpdated||this._columnsUpdated>this._prevColumnsUpdated)&&(this._chart.dataProvider=this.formatData(this.data())),this._prevDataUpdated=this._dataUpdated,this._prevColumnsUpdated=this._columnsUpdated,this._chart.colors=this.data().map(function(t){return this._palette(t[0])},this),this.showScrollbar()?this._chart.chartScrollbar.enabled=!0:this._chart.chartScrollbar.enabled=!1,this._chart},s.prototype.formatData=function(t){var e=[],a=this;return t.forEach(function(t){var i={};a.columns().forEach(function(e,a){i[e]=t[a]}),e.push(i)}),e},s.prototype.enter=function(t,o){e.prototype.enter.apply(this,arguments);var s=this,l={type:"funnel",addClassNames:!0,autoResize:!0,autoMargins:!0,chartScrollbar:{}};"function"==typeof define&&define.amd&&(l.pathToImages=i.toUrl("amcharts-images")),this._chart=a.makeChart(t,l),this._chart.addListener("clickSlice",function(t){var e=t.chart.colorField,a=t.dataItem.dataContext;null!==a[e]&&void 0!==a[e]?(delete a[e],"simple"===s.selectionMode()&&(null!==s._selected&&delete s._selected.data[s._selected.field],s._selected=null)):(a[e]=s.selectionColor(),"simple"===s.selectionMode()&&(null!==s._selected&&delete s._selected.data[s._selected.field],s._selected={field:e,data:a,cIdx:1,dIdx:t.dataItem.index},s._selections.push(s._selected))),t.chart.validateData(),s.click(s.rowToObj(s.data()[t.dataItem.index]),s.columns()[1],null!==s._selected)})},s.prototype.update=function(t,a){e.prototype.update.apply(this,arguments),t.style.width=this.size().width+"px",t.style.height=this.size().height+"px",this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this.updateChartOptions(),this._chart.validateNow(),this._chart.validateData()},s.prototype.render=function(t){return e.prototype.render.apply(this,arguments)},s.prototype.postUpdate=function(e,a){var i=this;if("center"!==this.labelPosition()){var o=i._element.select("svg").node().getBoundingClientRect();this.d3LabelSelection=a.selectAll(".amcharts-funnel-item");var s=[],l=[];this.d3LabelSelection.each(function(e,a){var i=t.select(this).node().getBoundingClientRect(),r=i.right;r>o.right&&l.push(o.right-r);var n=i.left;n<o.left&&s.push(n-o.left)});var r=l.length?t.min(l):0,n=s.length?t.min(s):0,h=0;switch(0>r&&(h+=r),0>n&&(h+=n),this.labelPosition()){case"right":this._chart.marginRight=Math.abs(h),this._chart.marginLeft=0;break;case"left":this._chart.marginLeft=Math.abs(h),this._chart.marginRight=0}this._chart.validateNow()}},s.prototype.data=function(t){return arguments.length&&this._dataUpdated++,e.prototype.data.apply(this,arguments)},s});