!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","../api/ITree","../common/Text","../common/FAChar","css!./CirclePacking"],e):t.tree_CirclePacking=e(t.d3,t.common_SVGWidget,t.api_ITree,t.common_Text,t.common_FAChar)}(this,function(t,e,i,n,o){function l(t){e.call(this),i.call(this)}return l.prototype=Object.create(e.prototype),l.prototype.constructor=l,l.prototype._class+=" tree_CirclePacking",l.prototype["implements"](i.prototype),l.prototype.publish("paletteID","default","set","Palette ID",l.prototype._palette["switch"](),{tags:["Basic","Shared"]}),l.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),l.prototype.enter=function(e,i){this.diameter=Math.min(this.width(),this.height()),this.pack=t.layout.pack().size([this.diameter-4,this.diameter-4]).value(function(t){return 1}),this.svg=i.append("g").attr("transform","rotate(30)")},l.prototype.update=function(e,i){var n=this;this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id())),this.svg.selectAll("circle").remove(),this.svg.selectAll("text").remove();var o=this.data(),l=o,r=this.pack.nodes(o);this.circle=this.svg.selectAll("circle").data(r).enter().append("circle").attr("class",function(t){return t.parent?t.children?"node":"node leaf":"node root"}).style("fill",function(t){return n._palette(t.label)}).on("click",function(t){n.click(t)}).on("dblclick",function(e){l!==e&&n.zoom(e),t.event.stopPropagation()}),this.circle.append("title").text(function(t){return t.label}),this.svg.selectAll("text").data(r).enter().append("text").attr("class","label").style("fill-opacity",function(t){return t.parent===o?1:0}).style("display",function(t){return t.parent===o?null:"none"}).text(function(t){return t.label}),this.node=this.svg.selectAll("circle,text"),this.zoomTo([o.x,o.y,2*o.r])},l.prototype.zoom=function(e){var i=this,n=e;this.svg.selectAll("circle").filter(function(t){return t===n});var o=this.svg.selectAll("text").filter(function(t){return t!==n&&"inline"===this.style.display});o.transition().duration(500).style("opacity",0).each("end",function(e){e!==n&&t.select(this).style("display","none").style("opacity",1)});var l=this.svg.transition().duration(1e3).tween("zoom",function(e){var o=t.interpolateZoom(i.view,[n.x,n.y,2*n.r]);return function(t){i.zoomTo(o(t))}});l.selectAll("text").filter(function(t){return t.parent===n||"inline"===this.style.display}).style("fill-opacity",function(t){return t.parent===n?1:0}).each("start",function(t){t.parent===n&&(this.style.display="inline")}).each("end",function(t){t.parent!==n&&(this.style.display="none")})},l.prototype.zoomTo=function(t){var e=this.diameter/t[2];this.view=t,this.node.attr("transform",function(i){return"translate("+(i.x-t[0])*e+","+(i.y-t[1])*e+")rotate(-30)"}),this.circle.attr("r",function(t){return t.r*e})},l});