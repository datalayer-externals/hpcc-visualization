!function(t,e){"function"==typeof define&&define.amd?define(["d3","./XYAxis","../api/INDChart","../api/ITooltip","css!./Column"],e):t.chart_Column=e(t.d3,t.chart_XYAxis,t.api_INDChart,t.api_ITooltip)}(this,function(t,e,a,o){function n(t){e.call(this),a.call(this),o.call(this),this._linearGap=25}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype._class+=" chart_Column",n.prototype["implements"](a.prototype),n.prototype["implements"](o.prototype),n.prototype.publish("paletteID","default","set","Palette ID",n.prototype._palette["switch"](),{tags:["Basic","Shared"]}),n.prototype.publish("useClonedPalette",!1,"boolean","Enable or disable using a cloned palette",null,{tags:["Intermediate","Shared"]}),n.prototype.enter=function(t,a){e.prototype.enter.apply(this,arguments);var o=this;this.tooltipHTML(function(t){switch(o.tooltipStyle()){case"series-table":return o.tooltipFormat({label:t.row[0],arr:o.columns().slice(1).map(function(e,a){return{label:e,color:o._palette(e),value:t.row[a+1]}})});default:var e=t.row[t.idx];return e instanceof Array&&(e=e[1]-e[0]),o.tooltipFormat({label:t.row[0],series:o.columns()[t.idx],value:e})}})},e.prototype.adjustedData=function(){var t=this.data().map(function(t){var e=0;return t.map(function(t,a){if(0===a)return t;if(a>=this.columns().length)return t;var o=this.yAxisStacked()?[e,e+t]:t;return e+=t,o},this)},this);return t},n.prototype.updateChart=function(e,a,o,n,i,r,l){var s=this;this._palette=this._palette["switch"](this.paletteID()),this.useClonedPalette()&&(this._palette=this._palette.cloneNotExists(this.paletteID()+"_"+this.id()));var u=10,c=0;switch(this.xAxisType()){case"ordinal":u=this.domainAxis.d3Scale.rangeBand(),c=-u/2;break;case"linear":case"time":u=Math.max(Math.abs(this.dataPos(2)-this.dataPos(1))*(100-this._linearGap)/100,u),c=-u/2}var p=t.scale.ordinal().domain(s.columns().filter(function(t,e){return e>0})).rangeRoundBands(r?[0,u]:[u,0]),d=this.svgData.selectAll(".dataRow").data(this.adjustedData());d.enter().append("g").attr("class","dataRow"),this.tooltip.direction(r?"n":"e"),d.each(function(e,a){var o=t.select(this),n=o.selectAll("rect").data(e.filter(function(t,e){return e<s.columns().length}).map(function(t,a){return{column:s.columns()[a],row:e,value:t,idx:a}}).filter(function(t,e){return null!==t.value&&t.idx>0}));n.enter().append("rect").attr("class","columnRect").call(s._selection.enter.bind(s._selection)).on("mouseout.tooltip",s.tooltip.hide).on("mousemove.tooltip",s.tooltip.show).on("click",function(t,e){s.click(s.rowToObj(t.row),t.column,s._selection.selected(this))}).on("dblclick",function(t,e){s.dblclick(s.rowToObj(t.row),t.column,s._selection.selected(this))}),r?n.transition().duration(l).attr("x",function(t){return s.dataPos(e[0])+(s.yAxisStacked()?0:p(t.column))+c}).attr("width",s.yAxisStacked()?u:p.rangeBand()).attr("y",function(t){return t.value instanceof Array?s.valuePos(t.value[1]):s.valuePos(t.value)}).attr("height",function(t){return t.value instanceof Array?s.valuePos(t.value[0])-s.valuePos(t.value[1]):i-s.valuePos(t.value)}).style("fill",function(t){return s._palette(t.column)}):n.transition().duration(l).attr("y",function(t){return s.dataPos(e[0])+(s.yAxisStacked()?0:p(t.column))+c}).attr("height",s.yAxisStacked()?u:p.rangeBand()).attr("x",function(t){return t.value instanceof Array?s.valuePos(t.value[0]):0}).attr("width",function(t){return t.value instanceof Array?s.valuePos(t.value[1])-s.valuePos(t.value[0]):s.valuePos(t.value)}).style("fill",function(t){return s._palette(t.column)}),n.exit().transition().duration(l).remove()}),d.exit().transition().duration(l).remove()},n});