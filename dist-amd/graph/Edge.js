!function(t,e){"function"==typeof define&&define.amd?define(["d3","../common/SVGWidget","../common/TextBox","css!./Edge"],e):t.graph_Edge=e(t.d3,t.common_SVGWidget,t.common_TextBox)}(this,function(t,e,r){function o(){e.call(this),this._points=[],this._weight=100,this._strokeDasharray=null,this._hidden=!1,this._textBox=(new r).padding(0)}return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype._class+=" graph_Edge",o.prototype.publish("arcDepth",16,"number","Arc Depth",null,{tags:["Basic"]}),o.prototype.publish("showArc",!0,"boolean","Show/Hide Arc",null,{tags:["Basic"]}),o.prototype.publish("tooltip","","string","Tooltip",null,{tags:["Private"]}),o.prototype.publish("sourceMarker","circle","set","Source Marker",["circle"],{optional:!0}),o.prototype.publish("targetMarker","arrow","set","Source Marker",["arrow","circle"],{optional:!0}),o.prototype.publish("strokeDasharray",null,"string","Stroke Dash Array",null,{optional:!0}),o.prototype.publish("strokeColor",null,"html-color","Stroke Color",null,{optional:!0}),o.prototype.sourceVertex=function(t){return arguments.length?(this._sourceVertex=t,this):this._sourceVertex},o.prototype.targetVertex=function(t){return arguments.length?(this._targetVertex=t,this):this._targetVertex},o.prototype.weight=function(t){return arguments.length?(this._weight=t,this):this._weight},o.prototype.points=function(t,e,r){return arguments.length?(this._points=t,this._elementPath&&this.update(null,this._element,e,r),this):this._points},o.prototype.hidden=function(t){return arguments.length?(this._hidden=t,this):this._hidden},o.prototype.text=function(t){return arguments.length?(this._textBox.text(t),this):this._textBox.text()},o.prototype.enter=function(t,r){e.prototype.enter.apply(this,arguments),this._elementPath=r.append("path"),this._tooltipElement=this._elementPath.append("title"),this._textBox.text()&&this._textBox.target(t).tooltip(this.tooltip()).render()},o.prototype.update=function(r,o,i,s){e.prototype.update.apply(this,arguments);var n=this;this.svgMarkerGlitch&&!s&&o.transition().duration((i?i:0)+100).each("start",function(t){n._pushMarkers(o,t)}).each("end",function(t){n._popMarkers(o,t)});var h=n._calculateEdgePoints(this._sourceVertex,this._targetVertex,this._points),a="";if(this._points.length||i,0){var p=h[2].x-h[0].x,l=h[2].y-h[0].y,u=2*Math.sqrt(p*p+l*l);a="M"+h[0].x+","+h[0].y+"A"+u+","+u+" 0 0,1 "+h[2].x+","+h[2].y}else a=t.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("bundle").tension(.75)(h);var c=this._elementPath;i&&(c=c.transition().duration(i)),c.attr("opacity",this._hidden?0:1).attr("marker-start",this.svgMarkerGlitch&&s||!this.sourceMarker_exists()?null:"url(#"+this._graphID+"_"+this.sourceMarker()+"Foot)").attr("marker-end",this.svgMarkerGlitch&&s||!this.targetMarker_exists()?null:"url(#"+this._graphID+"_"+this.targetMarker()+"Head)").attr("stroke",this.strokeColor_exists()?this.strokeColor():null).attr("stroke-dasharray",this.strokeDasharray_exists()?this.strokeDasharray():null).attr("d",a),this._tooltipElement.text(this.tooltip()),this._textBox.text()&&this._textBox.tooltip(this.tooltip()).move(this._findMidPoint(h),i)},o.prototype._findMidPoint=function(t){var e=t.length/2;if(t.length%2)return t[Math.floor(e)];if(t.length){var r=t[e-1],o=t[e];return{x:(r.x+o.x)/2,y:(r.y+o.y)/2}}return{x:0,y:0}},o.prototype._calculateEdgePoints=function(t,e,r){if(!t||!e)return[{x:0,y:0},{x:0,y:0}];var o=r?r.slice():[],i=0===o.length?e.pos():o[0],s=0===o.length?t.pos():o[o.length-1];if(o.unshift(t.intersection(t._pos,i)),o.push(e.intersection(e._pos,s)),o[0]||(o[0]=t._pos),o[o.length-1]||(o[o.length-1]=e._pos),2===o.length&&o[0]&&o[1]){var n=o[0].x-o[1].x,h=o[0].y-o[1].y,a=Math.sqrt(n*n+h*h);if(a)if(this.showArc()){var p=(o[0].x+o[1].x)/2-h*this.arcDepth()/100,l=(o[0].y+o[1].y)/2+n*this.arcDepth()/100;o=[{x:o[0].x,y:o[0].y},{x:p,y:l},{x:o[1].x,y:o[1].y}]}else o=[{x:o[0].x,y:o[0].y},{x:o[1].x,y:o[1].y}]}return o},o});